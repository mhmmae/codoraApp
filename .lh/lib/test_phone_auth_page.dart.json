{
    "sourceFile": "lib/test_phone_auth_page.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1753097375564,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1753097375564,
            "name": "Commit-0",
            "content": "import 'package:flutter/material.dart';\nimport 'package:get/get.dart';\nimport 'package:codora/الكود الخاص بتطبيق العميل /Services/phone_auth_service.dart';\n\nclass TestPhoneAuthPage extends StatefulWidget {\n  const TestPhoneAuthPage({super.key});\n\n  @override\n  _TestPhoneAuthPageState createState() => _TestPhoneAuthPageState();\n}\n\nclass _TestPhoneAuthPageState extends State<TestPhoneAuthPage> {\n  final TextEditingController phoneController = TextEditingController();\n  final TextEditingController codeController = TextEditingController();\n  final PhoneAuthService phoneAuthService = Get.find<PhoneAuthService>();\n\n  String statusMessage = 'جاهز للاختبار';\n  bool isLoading = false;\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: Text('🧪 اختبار مصادقة الهاتف'),\n        backgroundColor: Colors.blue,\n      ),\n      body: Padding(\n        padding: EdgeInsets.all(16.0),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.start,\n          children: [\n            // معلومات النظام\n            Card(\n              child: Padding(\n                padding: EdgeInsets.all(16.0),\n                child: Column(\n                  crossAxisAlignment: CrossAxisAlignment.start,\n                  children: [\n                    Text(\n                      '📊 معلومات النظام',\n                      style: TextStyle(\n                        fontSize: 18,\n                        fontWeight: FontWeight.bold,\n                      ),\n                    ),\n                    SizedBox(height: 8),\n                    Text('🏗️ Project ID: codora-app1'),\n                    Text('📱 Package: com.homy.codora'),\n                    Text(\n                      '🔑 SHA-1: 68:AE:1B:D8:91:FA:07:3B:73:AE:E3:A7:6C:24:BF:68:EC:0E:36:36',\n                    ),\n                    SizedBox(height: 8),\n                    Obx(\n                      () => Text(\n                        '📊 حالة الخدمة: ${phoneAuthService.isLoading ? \"قيد المعالجة\" : \"جاهز\"}',\n                      ),\n                    ),\n                    Obx(\n                      () => Text(\n                        '📱 رقم الهاتف: ${phoneAuthService.phoneNumber}',\n                      ),\n                    ),\n                    Obx(\n                      () => Text(\n                        '🔑 معرف التحقق: ${phoneAuthService.verificationId}',\n                      ),\n                    ),\n                  ],\n                ),\n              ),\n            ),\n\n            SizedBox(height: 16),\n\n            // إدخال رقم الهاتف\n            Card(\n              child: Padding(\n                padding: EdgeInsets.all(16.0),\n                child: Column(\n                  children: [\n                    Text(\n                      '📱 إرسال رمز التحقق',\n                      style: TextStyle(\n                        fontSize: 18,\n                        fontWeight: FontWeight.bold,\n                      ),\n                    ),\n                    SizedBox(height: 16),\n                    TextField(\n                      controller: phoneController,\n                      keyboardType: TextInputType.phone,\n                      decoration: InputDecoration(\n                        labelText: 'رقم الهاتف (مع رمز الدولة)',\n                        hintText: '+966512345678',\n                        border: OutlineInputBorder(),\n                        prefixIcon: Icon(Icons.phone),\n                      ),\n                    ),\n                    SizedBox(height: 16),\n                    SizedBox(\n                      width: double.infinity,\n                      child: ElevatedButton(\n                        onPressed:\n                            isLoading ? null : () => sendVerificationCode(),\n                        style: ElevatedButton.styleFrom(\n                          padding: EdgeInsets.symmetric(vertical: 16),\n                        ),\n                        child:\n                            isLoading\n                                ? CircularProgressIndicator(color: Colors.white)\n                                : Text('إرسال رمز التحقق'),\n                      ),\n                    ),\n                  ],\n                ),\n              ),\n            ),\n\n            SizedBox(height: 16),\n\n            // التحقق من الرمز\n            Card(\n              child: Padding(\n                padding: EdgeInsets.all(16.0),\n                child: Column(\n                  children: [\n                    Text(\n                      '🔑 التحقق من الرمز',\n                      style: TextStyle(\n                        fontSize: 18,\n                        fontWeight: FontWeight.bold,\n                      ),\n                    ),\n                    SizedBox(height: 16),\n                    TextField(\n                      controller: codeController,\n                      keyboardType: TextInputType.number,\n                      maxLength: 6,\n                      decoration: InputDecoration(\n                        labelText: 'رمز التحقق',\n                        hintText: '123456',\n                        border: OutlineInputBorder(),\n                        prefixIcon: Icon(Icons.lock),\n                      ),\n                    ),\n                    SizedBox(height: 16),\n                    SizedBox(\n                      width: double.infinity,\n                      child: ElevatedButton(\n                        onPressed: isLoading ? null : () => verifyCode(),\n                        style: ElevatedButton.styleFrom(\n                          padding: EdgeInsets.symmetric(vertical: 16),\n                          backgroundColor: Colors.green,\n                        ),\n                        child: Text('تحقق من الرمز'),\n                      ),\n                    ),\n                  ],\n                ),\n              ),\n            ),\n\n            SizedBox(height: 16),\n\n            // حالة الرسائل\n            Expanded(\n              child: Card(\n                child: Padding(\n                  padding: EdgeInsets.all(16.0),\n                  child: Column(\n                    crossAxisAlignment: CrossAxisAlignment.start,\n                    children: [\n                      Text(\n                        '📋 سجل الحالة',\n                        style: TextStyle(\n                          fontSize: 18,\n                          fontWeight: FontWeight.bold,\n                        ),\n                      ),\n                      SizedBox(height: 8),\n                      Expanded(\n                        child: Container(\n                          width: double.infinity,\n                          padding: EdgeInsets.all(12),\n                          decoration: BoxDecoration(\n                            color: Colors.grey[100],\n                            borderRadius: BorderRadius.circular(8),\n                            border: Border.all(color: Colors.grey[300]!),\n                          ),\n                          child: SingleChildScrollView(\n                            child: Text(\n                              statusMessage,\n                              style: TextStyle(fontFamily: 'monospace'),\n                            ),\n                          ),\n                        ),\n                      ),\n                    ],\n                  ),\n                ),\n              ),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n\n  void sendVerificationCode() async {\n    if (phoneController.text.trim().isEmpty) {\n      updateStatus('❌ خطأ: يرجى إدخال رقم الهاتف');\n      return;\n    }\n\n    setState(() {\n      isLoading = true;\n    });\n\n    updateStatus(\n      '🚀 بدء إرسال رمز التحقق...\\n📱 الرقم: ${phoneController.text}',\n    );\n\n    try {\n      final result = await phoneAuthService.sendVerificationCode(\n        phoneController.text.trim(),\n      );\n\n      if (result.isSuccess) {\n        updateStatus(\n          '✅ تم إرسال الرمز بنجاح!\\n🔑 معرف التحقق: ${result.verificationId}',\n        );\n      } else {\n        updateStatus('❌ فشل الإرسال: ${result.error}');\n      }\n    } catch (error) {\n      updateStatus('💥 خطأ غير متوقع: ${error.toString()}');\n      print('💥 خطأ في sendVerificationCode: $error');\n    } finally {\n      setState(() {\n        isLoading = false;\n      });\n    }\n  }\n\n  void verifyCode() async {\n    if (codeController.text.trim().isEmpty) {\n      updateStatus('❌ خطأ: يرجى إدخال رمز التحقق');\n      return;\n    }\n\n    if (phoneAuthService.verificationId.isEmpty) {\n      updateStatus('❌ خطأ: لا يوجد معرف تحقق. يرجى إرسال رمز التحقق أولاً');\n      return;\n    }\n\n    setState(() {\n      isLoading = true;\n    });\n\n    updateStatus('🔍 التحقق من الرمز...\\n🔑 الرمز: ${codeController.text}');\n\n    try {\n      final result = await phoneAuthService.verifyCode(\n        codeController.text.trim(),\n      );\n\n      if (result.isSuccess) {\n        updateStatus(\n          '🎉 تم التحقق بنجاح!\\n👤 المستخدم: ${result.user?.uid ?? \"غير معروف\"}',\n        );\n      } else {\n        updateStatus('❌ فشل التحقق: ${result.error}');\n      }\n    } catch (error) {\n      updateStatus('💥 خطأ غير متوقع في التحقق: ${error.toString()}');\n      print('💥 خطأ في verifyCode: $error');\n    } finally {\n      setState(() {\n        isLoading = false;\n      });\n    }\n  }\n\n  void updateStatus(String message) {\n    setState(() {\n      final timestamp = DateTime.now().toString().substring(11, 19);\n      statusMessage = '[$timestamp] $message\\n\\n$statusMessage';\n    });\n  }\n\n  @override\n  void dispose() {\n    phoneController.dispose();\n    codeController.dispose();\n    super.dispose();\n  }\n}\n"
        }
    ]
}