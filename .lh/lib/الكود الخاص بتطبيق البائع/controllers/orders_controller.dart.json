{
    "sourceFile": "lib/Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø§Ø¦Ø¹/controllers/orders_controller.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1752751503157,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1752751503157,
            "name": "Commit-0",
            "content": "import 'package:cloud_firestore/cloud_firestore.dart';\nimport 'package:firebase_auth/firebase_auth.dart';\nimport 'package:flutter/material.dart';\nimport 'package:get/get.dart';\nimport 'dart:async';\nimport '../../XXX/xxx_firebase.dart';\n\n/// ØªØ¹Ø¯Ø§Ø¯ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ù„Ø¨\nenum OrderStatus {\n  pending, // Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù‚Ø¨ÙˆÙ„\n  accepted, // ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„ ÙˆØ¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±\n  readyForPickup, // Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ù‚Ø¨Ù„ Ø¹Ø§Ù…Ù„ Ø§Ù„ØªÙˆØµÙŠÙ„\n  pickedUp, // ØªÙ… Ø§Ø³ØªÙ„Ø§Ù…Ù‡ Ù…Ù† Ù‚Ø¨Ù„ Ø¹Ø§Ù…Ù„ Ø§Ù„ØªÙˆØµÙŠÙ„\n  delivered, // ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…\n  cancelled, // ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡\n}\n\n/// Ù…ØªØ­ÙƒÙ… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ù„Ø¨Ø§Ø¦Ø¹\n/// ÙŠØ¯ÙŠØ± Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©\nclass OrdersController extends GetxController {\n  // Ø­Ø§Ù„Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©\n  final RxInt newOrdersCount = 0.obs;\n\n  // Ø­Ø§Ù„Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©\n  final RxInt acceptedOrdersCount = 0.obs;\n\n  // Ø­Ø§Ù„Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…\n  final RxInt readyOrdersCount = 0.obs;\n\n  // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„\n  final RxBool isLoading = false.obs;\n\n  // Ù‚Ø§Ø¦Ù…Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª\n  final RxList<QueryDocumentSnapshot> allOrdersList =\n      <QueryDocumentSnapshot>[].obs;\n\n  // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©\n  final RxList<QueryDocumentSnapshot> newOrdersList =\n      <QueryDocumentSnapshot>[].obs;\n\n  // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©\n  final RxList<QueryDocumentSnapshot> acceptedOrdersList =\n      <QueryDocumentSnapshot>[].obs;\n\n  // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…\n  final RxList<QueryDocumentSnapshot> readyOrdersList =\n      <QueryDocumentSnapshot>[].obs;\n\n  // Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ\n  StreamSubscription<QuerySnapshot>? _ordersStreamSubscription;\n\n  // Ù…Ø¹Ø±Ù Ø§Ù„Ø¨Ø§Ø¦Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ\n  String? get currentSellerId => FirebaseAuth.instance.currentUser?.uid;\n\n  @override\n  void onInit() {\n    super.onInit();\n    _startListeningToOrders();\n  }\n\n  @override\n  void onClose() {\n    _ordersStreamSubscription?.cancel();\n    super.onClose();\n  }\n\n  /// Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ\n  void _startListeningToOrders() {\n    if (currentSellerId == null) return;\n\n    _ordersStreamSubscription = FirebaseFirestore.instance\n        .collection(FirebaseX.ordersCollection)\n        .where('appName', isEqualTo: FirebaseX.appName)\n        .where('uidAdd', isEqualTo: currentSellerId)\n        .snapshots()\n        .listen(\n          (QuerySnapshot snapshot) {\n            allOrdersList.value = snapshot.docs;\n            _categorizeOrders(snapshot.docs);\n\n            debugPrint(\n              \"ğŸ“‹ [OrdersController] ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: ${allOrdersList.length}\",\n            );\n            debugPrint(\"   - Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©: ${newOrdersCount.value}\");\n            debugPrint(\"   - Ø·Ù„Ø¨Ø§Øª Ù…Ù‚Ø¨ÙˆÙ„Ø©: ${acceptedOrdersCount.value}\");\n            debugPrint(\"   - Ø·Ù„Ø¨Ø§Øª Ø¬Ø§Ù‡Ø²Ø©: ${readyOrdersCount.value}\");\n          },\n          onError: (error) {\n            debugPrint(\"âŒ [OrdersController] Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: $error\");\n          },\n        );\n  }\n\n  /// ØªØµÙ†ÙŠÙ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø­Ø³Ø¨ Ø­Ø§Ù„ØªÙ‡Ø§\n  void _categorizeOrders(List<QueryDocumentSnapshot> orders) {\n    final newOrders = <QueryDocumentSnapshot>[];\n    final acceptedOrders = <QueryDocumentSnapshot>[];\n    final readyOrders = <QueryDocumentSnapshot>[];\n\n    for (var order in orders) {\n      final data = order.data() as Map<String, dynamic>;\n      final orderStatus = _getOrderStatus(data);\n\n      switch (orderStatus) {\n        case OrderStatus.pending:\n          newOrders.add(order);\n          break;\n        case OrderStatus.accepted:\n          acceptedOrders.add(order);\n          break;\n        case OrderStatus.readyForPickup:\n          readyOrders.add(order);\n          break;\n        default:\n          // Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© Ø£Ùˆ Ø§Ù„Ù…Ù„ØºØ§Ø© Ù„Ø§ ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©\n          break;\n      }\n    }\n\n    newOrdersList.value = newOrders;\n    acceptedOrdersList.value = acceptedOrders;\n    readyOrdersList.value = readyOrders;\n\n    newOrdersCount.value = newOrders.length;\n    acceptedOrdersCount.value = acceptedOrders.length;\n    readyOrdersCount.value = readyOrders.length;\n  }\n\n  /// ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª\n  OrderStatus _getOrderStatus(Map<String, dynamic> orderData) {\n    final isAccepted = orderData['RequestAccept'] ?? false;\n    final orderStatus = orderData['orderStatus'] as String?;\n\n    if (!isAccepted) {\n      return OrderStatus.pending;\n    }\n\n    switch (orderStatus) {\n      case 'accepted':\n        return OrderStatus.accepted;\n      case 'readyForPickup':\n        return OrderStatus.readyForPickup;\n      case 'pickedUp':\n        return OrderStatus.pickedUp;\n      case 'delivered':\n        return OrderStatus.delivered;\n      case 'cancelled':\n        return OrderStatus.cancelled;\n      default:\n        return OrderStatus.accepted; // Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø© Ø¨Ø¯ÙˆÙ† Ø­Ø§Ù„Ø©\n    }\n  }\n\n  /// Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙŠØ¯ÙˆÙŠØ§Ù‹\n  Future<void> refreshOrders() async {\n    if (currentSellerId == null) return;\n\n    isLoading.value = true;\n\n    try {\n      final QuerySnapshot snapshot =\n          await FirebaseFirestore.instance\n              .collection(FirebaseX.ordersCollection)\n              .where('appName', isEqualTo: FirebaseX.appName)\n              .where('uidAdd', isEqualTo: currentSellerId)\n              .get();\n\n      allOrdersList.value = snapshot.docs;\n      _categorizeOrders(snapshot.docs);\n\n      debugPrint(\n        \"ğŸ”„ [OrdersController] ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙŠØ¯ÙˆÙŠØ§Ù‹: ${allOrdersList.length}\",\n      );\n    } catch (e) {\n      debugPrint(\"âŒ [OrdersController] Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨Ø§Øª: $e\");\n    } finally {\n      isLoading.value = false;\n    }\n  }\n\n  /// Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø·Ù„Ø¨ Ù…Ø¹ÙŠÙ†\n  Future<Map<String, dynamic>?> getOrderDetails(String orderId) async {\n    try {\n      final DocumentSnapshot orderDoc =\n          await FirebaseFirestore.instance\n              .collection(FirebaseX.ordersCollection)\n              .doc(orderId)\n              .get();\n\n      if (orderDoc.exists) {\n        return orderDoc.data() as Map<String, dynamic>?;\n      }\n      return null;\n    } catch (e) {\n      debugPrint(\"âŒ [OrdersController] Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨: $e\");\n      return null;\n    }\n  }\n\n  /// Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯\n  Future<void> acceptOrder(String orderId) async {\n    try {\n      await FirebaseFirestore.instance\n          .collection(FirebaseX.ordersCollection)\n          .doc(orderId)\n          .update({\n            'RequestAccept': true,\n            'orderStatus': 'accepted',\n            'acceptedAt': FieldValue.serverTimestamp(),\n            'updatedAt': FieldValue.serverTimestamp(),\n          });\n\n      Get.snackbar(\n        'âœ… ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨',\n        'ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„Ø¨Ø¯Ø¡ ÙÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',\n        backgroundColor: Get.theme.colorScheme.primary.withOpacity(0.1),\n        colorText: Get.theme.colorScheme.primary,\n        duration: Duration(seconds: 3),\n      );\n\n      debugPrint(\"âœ… [OrdersController] ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨ $orderId\");\n    } catch (e) {\n      debugPrint(\"âŒ [OrdersController] Ø®Ø·Ø£ ÙÙŠ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨: $e\");\n      Get.snackbar(\n        'âŒ Ø®Ø·Ø£',\n        'ÙØ´Ù„ ÙÙŠ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰',\n        backgroundColor: Get.theme.colorScheme.error.withOpacity(0.1),\n        colorText: Get.theme.colorScheme.error,\n      );\n      rethrow;\n    }\n  }\n\n  /// Ø±ÙØ¶ Ø·Ù„Ø¨\n  Future<void> rejectOrder(String orderId) async {\n    try {\n      await FirebaseFirestore.instance\n          .collection(FirebaseX.ordersCollection)\n          .doc(orderId)\n          .update({\n            'RequestAccept': false,\n            'orderStatus': 'cancelled',\n            'rejectedAt': FieldValue.serverTimestamp(),\n            'updatedAt': FieldValue.serverTimestamp(),\n          });\n\n      Get.snackbar(\n        'âŒ ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨',\n        'ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­',\n        backgroundColor: Get.theme.colorScheme.error.withOpacity(0.1),\n        colorText: Get.theme.colorScheme.error,\n        duration: Duration(seconds: 3),\n      );\n\n      debugPrint(\"âŒ [OrdersController] ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨ $orderId\");\n    } catch (e) {\n      debugPrint(\"âŒ [OrdersController] Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨: $e\");\n      rethrow;\n    }\n  }\n\n  /// ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙƒØ¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…\n  Future<void> markOrderReady(String orderId) async {\n    try {\n      await FirebaseFirestore.instance\n          .collection(FirebaseX.ordersCollection)\n          .doc(orderId)\n          .update({\n            'orderStatus': 'readyForPickup',\n            'readyAt': FieldValue.serverTimestamp(),\n            'updatedAt': FieldValue.serverTimestamp(),\n          });\n\n      Get.snackbar(\n        'ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨ Ø¬Ø§Ù‡Ø²!',\n        'ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙƒØ¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ù‚Ø¨Ù„ Ø¹Ø§Ù…Ù„ Ø§Ù„ØªÙˆØµÙŠÙ„',\n        backgroundColor: Get.theme.colorScheme.tertiary.withOpacity(0.1),\n        colorText: Get.theme.colorScheme.tertiary,\n        duration: Duration(seconds: 3),\n      );\n\n      debugPrint(\n        \"ğŸ“¦ [OrdersController] ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ $orderId ÙƒØ¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…\",\n      );\n    } catch (e) {\n      debugPrint(\"âŒ [OrdersController] Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙƒØ¬Ø§Ù‡Ø²: $e\");\n      Get.snackbar(\n        'âŒ Ø®Ø·Ø£',\n        'ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰',\n        backgroundColor: Get.theme.colorScheme.error.withOpacity(0.1),\n        colorText: Get.theme.colorScheme.error,\n      );\n      rethrow;\n    }\n  }\n\n  /// ØªØ£ÙƒÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ù‚Ø¨Ù„ Ø¹Ø§Ù…Ù„ Ø§Ù„ØªÙˆØµÙŠÙ„\n  Future<void> confirmPickup(String orderId) async {\n    try {\n      await FirebaseFirestore.instance\n          .collection(FirebaseX.ordersCollection)\n          .doc(orderId)\n          .update({\n            'orderStatus': 'pickedUp',\n            'pickedUpAt': FieldValue.serverTimestamp(),\n            'updatedAt': FieldValue.serverTimestamp(),\n          });\n\n      Get.snackbar(\n        'ğŸšš ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…',\n        'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ù‚Ø¨Ù„ Ø¹Ø§Ù…Ù„ Ø§Ù„ØªÙˆØµÙŠÙ„',\n        backgroundColor: Get.theme.colorScheme.secondary.withOpacity(0.1),\n        colorText: Get.theme.colorScheme.secondary,\n        duration: Duration(seconds: 3),\n      );\n\n      debugPrint(\n        \"ğŸšš [OrdersController] ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ $orderId Ù…Ù† Ù‚Ø¨Ù„ Ø¹Ø§Ù…Ù„ Ø§Ù„ØªÙˆØµÙŠÙ„\",\n      );\n    } catch (e) {\n      debugPrint(\"âŒ [OrdersController] Ø®Ø·Ø£ ÙÙŠ ØªØ£ÙƒÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨: $e\");\n      rethrow;\n    }\n  }\n\n  /// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙˆØµÙ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨\n  String getOrderStatusText(OrderStatus status) {\n    switch (status) {\n      case OrderStatus.pending:\n        return 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù‚Ø¨ÙˆÙ„';\n      case OrderStatus.accepted:\n        return 'Ù…Ù‚Ø¨ÙˆÙ„ - Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±';\n      case OrderStatus.readyForPickup:\n        return 'Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…';\n      case OrderStatus.pickedUp:\n        return 'ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…';\n      case OrderStatus.delivered:\n        return 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…';\n      case OrderStatus.cancelled:\n        return 'Ù…Ù„ØºÙ‰';\n    }\n  }\n\n  /// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨\n  String getOrderStatusIcon(OrderStatus status) {\n    switch (status) {\n      case OrderStatus.pending:\n        return 'â³';\n      case OrderStatus.accepted:\n        return 'âœ…';\n      case OrderStatus.readyForPickup:\n        return 'ğŸ“¦';\n      case OrderStatus.pickedUp:\n        return 'ğŸšš';\n      case OrderStatus.delivered:\n        return 'âœ…';\n      case OrderStatus.cancelled:\n        return 'âŒ';\n    }\n  }\n}\n"
        }
    ]
}