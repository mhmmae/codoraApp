{
    "sourceFile": "lib/الكود الخاص بتطبيق البائع/ui/pages/order_confirmation_page.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1752486156044,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1752486156044,
            "name": "Commit-0",
            "content": "import 'package:flutter/material.dart';\nimport 'package:flutter_screenutil/flutter_screenutil.dart';\nimport 'package:get/get.dart';\nimport 'package:cached_network_image/cached_network_image.dart';\nimport 'package:intl/intl.dart';\nimport '../controllers/order_confirmation_controller.dart';\n\nclass OrderConfirmationPage extends StatelessWidget {\n  const OrderConfirmationPage({super.key});\n\n  /// تنسيق الأسعار بفواصل الآلاف\n  String formatPrice(double price) {\n    final formatter = NumberFormat('#,###', 'en_US');\n    return formatter.format(price.round());\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    Get.put(OrderConfirmationController());\n    \n    return Scaffold(\n      backgroundColor: const Color(0xFFF8FAFC),\n      appBar: _buildAppBar(),\n      body: GetBuilder<OrderConfirmationController>(\n        builder: (controller) {\n          if (controller.isLoading) {\n            return const Center(child: CircularProgressIndicator());\n          }\n          \n          return SingleChildScrollView(\n            padding: EdgeInsets.all(20.w),\n            child: Column(\n              crossAxisAlignment: CrossAxisAlignment.start,\n              children: [\n                _buildBuyerInfoSection(controller),\n                SizedBox(height: 20.h),\n                _buildOrderSummary(controller),\n                SizedBox(height: 20.h),\n                _buildDeliveryInfo(controller),\n                SizedBox(height: 20.h),\n                _buildPaymentSummary(controller),\n                SizedBox(height: 30.h),\n                _buildConfirmButton(controller),\n              ],\n            ),\n          );\n        },\n      ),\n    );\n  }\n  \n  /// بناء قسم معلومات المشتري والصور\n  Widget _buildBuyerInfoSection(OrderConfirmationController controller) {\n    return Container(\n      padding: EdgeInsets.all(16.w),\n      decoration: BoxDecoration(\n        color: Colors.white,\n        borderRadius: BorderRadius.circular(12.r),\n        boxShadow: [\n          BoxShadow(\n            color: Colors.black.withOpacity(0.05),\n            spreadRadius: 0,\n            blurRadius: 10.r,\n            offset: Offset(0, 2.h),\n          ),\n        ],\n      ),\n      child: Column(\n        crossAxisAlignment: CrossAxisAlignment.start,\n        children: [\n          Row(\n            children: [\n              Icon(\n                Icons.person_outline,\n                color: const Color(0xFF6366F1),\n                size: 24.sp,\n              ),\n              SizedBox(width: 8.w),\n              Text(\n                'معلومات المشتري',\n                style: TextStyle(\n                  fontSize: 18.sp,\n                  fontWeight: FontWeight.bold,\n                  color: const Color(0xFF1F2937),\n                ),\n              ),\n            ],\n          ),\n          SizedBox(height: 16.h),\n          \n          if (controller.buyerInfo != null) ...[\n            // صورة صاحب المتجر ومعلوماته\n            Container(\n              padding: EdgeInsets.all(12.w),\n              decoration: BoxDecoration(\n                color: const Color(0xFFF8FAFC),\n                borderRadius: BorderRadius.circular(8.r),\n              ),\n              child: Row(\n                children: [                    // صورة صاحب المتجر\n                    Container(\n                      width: 60.w,\n                      height: 60.w,\n                      decoration: BoxDecoration(\n                        borderRadius: BorderRadius.circular(30.r),\n                        border: Border.all(\n                          color: const Color(0xFF6366F1).withOpacity(0.3),\n                          width: 2,\n                        ),\n                      ),\n                      child: ClipRRect(\n                        borderRadius: BorderRadius.circular(28.r),\n                        child: controller.buyerInfo!['sellerProfileImageUrl'] != null\n                            ? CachedNetworkImage(\n                                imageUrl: controller.buyerInfo!['sellerProfileImageUrl']!,\n                                fit: BoxFit.cover,\n                                placeholder: (context, url) => Container(\n                                  color: const Color(0xFFF3F4F6),\n                                  child: Icon(\n                                    Icons.person,\n                                    color: const Color(0xFF6366F1),\n                                    size: 30.sp,\n                                  ),\n                                ),\n                                errorWidget: (context, url, error) => Container(\n                                  color: const Color(0xFFF3F4F6),\n                                  child: Icon(\n                                    Icons.person,\n                                    color: const Color(0xFF6366F1),\n                                    size: 30.sp,\n                                  ),\n                                ),\n                              )\n                            : Container(\n                                color: const Color(0xFFF3F4F6),\n                                child: Icon(\n                                  Icons.person,\n                                  color: const Color(0xFF6366F1),\n                                  size: 30.sp,\n                                ),\n                              ),\n                      ),\n                    ),\n                    SizedBox(width: 12.w),\n                    Expanded(\n                      child: Column(\n                        crossAxisAlignment: CrossAxisAlignment.start,\n                        children: [\n                          Text(\n                            controller.buyerInfo!['sellerName'] ?? 'غير محدد',\n                            style: TextStyle(\n                              fontSize: 16.sp,\n                              fontWeight: FontWeight.bold,\n                              color: const Color(0xFF1F2937),\n                            ),\n                          ),\n                          SizedBox(height: 4.h),\n                          Text(\n                            controller.buyerInfo!['shopPhoneNumber'] ?? 'غير محدد',\n                            style: TextStyle(\n                              fontSize: 14.sp,\n                              color: const Color(0xFF6B7280),\n                            ),\n                          ),\n                        ],\n                      ),\n                    ),\n                ],\n              ),\n            ),\n            SizedBox(height: 12.h),\n            \n            // صورة المتجر ومعلوماته\n            Container(\n              padding: EdgeInsets.all(12.w),\n              decoration: BoxDecoration(\n                color: const Color(0xFFF8FAFC),\n                borderRadius: BorderRadius.circular(8.r),\n              ),\n              child: Row(\n                children: [\n                  // صورة المتجر\n                  Container(\n                    width: 50.w,\n                    height: 50.w,\n                    decoration: BoxDecoration(\n                      borderRadius: BorderRadius.circular(8.r),\n                      border: Border.all(\n                        color: const Color(0xFF6366F1).withOpacity(0.2),\n                        width: 1,\n                      ),\n                    ),\n                    child: ClipRRect(\n                      borderRadius: BorderRadius.circular(7.r),\n                      child: controller.buyerInfo!['shopFrontImageUrl'] != null\n                          ? CachedNetworkImage(\n                              imageUrl: controller.buyerInfo!['shopFrontImageUrl']!,\n                              fit: BoxFit.cover,\n                              placeholder: (context, url) => Container(\n                                color: const Color(0xFFF3F4F6),\n                                child: Icon(\n                                  Icons.store_rounded,\n                                  color: const Color(0xFF6366F1),\n                                  size: 25.sp,\n                                ),\n                              ),\n                              errorWidget: (context, url, error) => Container(\n                                color: const Color(0xFFF3F4F6),\n                                child: Icon(\n                                  Icons.store_rounded,\n                                  color: const Color(0xFF6366F1),\n                                  size: 25.sp,\n                                ),\n                              ),\n                            )\n                          : Container(\n                              color: const Color(0xFFF3F4F6),\n                              child: Icon(\n                                Icons.store_rounded,\n                                color: const Color(0xFF6366F1),\n                                size: 25.sp,\n                              ),\n                            ),\n                    ),\n                  ),\n                  SizedBox(width: 12.w),\n                  Expanded(\n                    child: Column(\n                      crossAxisAlignment: CrossAxisAlignment.start,\n                      children: [\n                        Text(\n                          controller.buyerInfo!['shopName'] ?? 'غير محدد',\n                          style: TextStyle(\n                            fontSize: 14.sp,\n                            fontWeight: FontWeight.w600,\n                            color: const Color(0xFF1F2937),\n                          ),\n                        ),\n                        SizedBox(height: 2.h),\n                        Text(\n                          controller.buyerInfo!['shopCategory'] ?? 'غير محدد',\n                          style: TextStyle(\n                            fontSize: 12.sp,\n                            color: const Color(0xFF6B7280),\n                          ),\n                        ),\n                      ],\n                    ),\n                  ),\n                ],\n              ),\n            ),\n            \n            SizedBox(height: 12.h),\n            \n            // معلومات إضافية للمشتري\n            if (controller.buyerInfo!['shopAddressText'] != null && controller.buyerInfo!['shopAddressText'].toString().isNotEmpty) ...[\n              Container(\n                padding: EdgeInsets.symmetric(horizontal: 12.w, vertical: 8.h),\n                decoration: BoxDecoration(\n                  color: const Color(0xFFF8FAFC),\n                  borderRadius: BorderRadius.circular(6.r),\n                ),\n                child: Row(\n                  children: [\n                    Icon(\n                      Icons.location_on_outlined,\n                      color: const Color(0xFF6366F1),\n                      size: 16.sp,\n                    ),\n                    SizedBox(width: 8.w),\n                    Expanded(\n                      child: Text(\n                        'عنوان المتجر: ${controller.buyerInfo!['shopAddressText']}',\n                        style: TextStyle(\n                          fontSize: 12.sp,\n                          color: const Color(0xFF6B7280),\n                        ),\n                        maxLines: 2,\n                        overflow: TextOverflow.ellipsis,\n                      ),\n                    ),\n                  ],\n                ),\n              ),\n              SizedBox(height: 6.h),\n            ],\n            \n            if (controller.buyerInfo!['email'] != null && controller.buyerInfo!['email'].toString().isNotEmpty) ...[\n              Container(\n                padding: EdgeInsets.symmetric(horizontal: 12.w, vertical: 8.h),\n                decoration: BoxDecoration(\n                  color: const Color(0xFFF8FAFC),\n                  borderRadius: BorderRadius.circular(6.r),\n                ),\n                child: Row(\n                  children: [\n                    Icon(\n                      Icons.email_outlined,\n                      color: const Color(0xFF6366F1),\n                      size: 16.sp,\n                    ),\n                    SizedBox(width: 8.w),\n                    Expanded(\n                      child: Text(\n                        'البريد الإلكتروني: ${controller.buyerInfo!['email']}',\n                        style: TextStyle(\n                          fontSize: 12.sp,\n                          color: const Color(0xFF6B7280),\n                        ),\n                      ),\n                    ),\n                  ],\n                ),\n              ),\n              SizedBox(height: 6.h),\n            ],\n            \n            if (controller.buyerInfo!['shopDescription'] != null && controller.buyerInfo!['shopDescription'].toString().isNotEmpty) ...[\n              Container(\n                padding: EdgeInsets.symmetric(horizontal: 12.w, vertical: 8.h),\n                decoration: BoxDecoration(\n                  color: const Color(0xFFF8FAFC),\n                  borderRadius: BorderRadius.circular(6.r),\n                ),\n                child: Row(\n                  crossAxisAlignment: CrossAxisAlignment.start,\n                  children: [\n                    Icon(\n                      Icons.description_outlined,\n                      color: const Color(0xFF6366F1),\n                      size: 16.sp,\n                    ),\n                    SizedBox(width: 8.w),\n                    Expanded(\n                      child: Text(\n                        'وصف المتجر: ${controller.buyerInfo!['shopDescription']}',\n                        style: TextStyle(\n                          fontSize: 12.sp,\n                          color: const Color(0xFF6B7280),\n                        ),\n                        maxLines: 2,\n                        overflow: TextOverflow.ellipsis,\n                      ),\n                    ),\n                  ],\n                ),\n              ),\n              SizedBox(height: 6.h),\n            ],\n            \n            if (controller.buyerInfo!['sellerType'] != null && controller.buyerInfo!['sellerType'].toString().isNotEmpty) ...[\n              Container(\n                padding: EdgeInsets.symmetric(horizontal: 12.w, vertical: 8.h),\n                decoration: BoxDecoration(\n                  color: const Color(0xFFF8FAFC),\n                  borderRadius: BorderRadius.circular(6.r),\n                ),\n                child: Row(\n                  children: [\n                    Icon(\n                      Icons.business_outlined,\n                      color: const Color(0xFF6366F1),\n                      size: 16.sp,\n                    ),\n                    SizedBox(width: 8.w),\n                    Text(\n                      'نوع البائع: ${controller.buyerInfo!['sellerType']}',\n                      style: TextStyle(\n                        fontSize: 12.sp,\n                        color: const Color(0xFF6B7280),\n                      ),\n                    ),\n                  ],\n                ),\n              ),\n              SizedBox(height: 6.h),\n            ],\n          ] else ...[\n            Container(\n              padding: EdgeInsets.all(12.w),\n              decoration: BoxDecoration(\n                color: const Color(0xFFF8FAFC),\n                borderRadius: BorderRadius.circular(8.r),\n              ),\n              child: Row(\n                children: [\n                  Icon(\n                    Icons.info_outline,\n                    color: const Color(0xFF6B7280),\n                    size: 20.sp,\n                  ),\n                  SizedBox(width: 8.w),\n                  Text(\n                    'لا توجد معلومات مشتري متاحة',\n                    style: TextStyle(\n                      fontSize: 14.sp,\n                      color: const Color(0xFF6B7280),\n                    ),\n                  ),\n                ],\n              ),\n            ),\n          ],\n        ],\n      ),\n    );\n  }\n  \n  PreferredSizeWidget _buildAppBar() {\n    return AppBar(\n      backgroundColor: Colors.white,\n      elevation: 0,\n      centerTitle: true,\n      title: Text(\n        'تأكيد الطلب',\n        style: TextStyle(\n          fontSize: 20.sp,\n          fontWeight: FontWeight.bold,\n          color: const Color(0xFF1F2937),\n        ),\n      ),\n      leading: IconButton(\n        onPressed: () => Get.back(),\n        icon: Icon(\n          Icons.arrow_back_ios_rounded,\n          color: const Color(0xFF6366F1),\n          size: 24.sp,\n        ),\n      ),\n    );\n  }\n  \n  Widget _buildOrderSummary(OrderConfirmationController controller) {\n    return Container(\n      padding: EdgeInsets.all(16.w),\n      decoration: BoxDecoration(\n        color: Colors.white,\n        borderRadius: BorderRadius.circular(12.r),\n        boxShadow: [\n          BoxShadow(\n            color: Colors.black.withOpacity(0.05),\n            spreadRadius: 0,\n            blurRadius: 10.r,\n            offset: Offset(0, 2.h),\n          ),\n        ],\n      ),\n      child: Column(\n        crossAxisAlignment: CrossAxisAlignment.start,\n        children: [\n          Row(\n            children: [\n              Icon(\n                Icons.shopping_bag_outlined,\n                color: const Color(0xFF6366F1),\n                size: 24.sp,\n              ),\n              SizedBox(width: 8.w),\n              Text(\n                'ملخص الطلب',\n                style: TextStyle(\n                  fontSize: 18.sp,\n                  fontWeight: FontWeight.bold,\n                  color: const Color(0xFF1F2937),\n                ),\n              ),\n            ],\n          ),\n          SizedBox(height: 16.h),\n          \n          // المنتجات\n          ...controller.cartItems.map((item) => _buildOrderItem(item)),\n        ],\n      ),\n    );\n  }\n  \n  Widget _buildOrderItem(dynamic item) {\n    return Container(\n      margin: EdgeInsets.only(bottom: 12.h),\n      padding: EdgeInsets.all(12.w),\n      decoration: BoxDecoration(\n        color: const Color(0xFFF8FAFC),\n        borderRadius: BorderRadius.circular(8.r),\n      ),\n      child: Row(\n        children: [\n          Container(\n            width: 50.w,\n            height: 50.w,\n            decoration: BoxDecoration(\n              borderRadius: BorderRadius.circular(6.r),\n              border: Border.all(\n                color: const Color(0xFF6366F1).withOpacity(0.2),\n                width: 1,\n              ),\n            ),\n            child: ClipRRect(\n              borderRadius: BorderRadius.circular(5.r),\n              child: item.productImage.isNotEmpty\n                  ? CachedNetworkImage(\n                      imageUrl: item.productImage,\n                      fit: BoxFit.cover,\n                      placeholder: (context, url) => Container(\n                        color: const Color(0xFFF3F4F6),\n                        child: Icon(\n                          Icons.image_outlined,\n                          color: const Color(0xFF9CA3AF),\n                          size: 20.sp,\n                        ),\n                      ),\n                      errorWidget: (context, url, error) => Container(\n                        color: const Color(0xFFF3F4F6),\n                        child: Icon(\n                          Icons.image_outlined,\n                          color: const Color(0xFF9CA3AF),\n                          size: 20.sp,\n                        ),\n                      ),\n                    )\n                  : Container(\n                      color: const Color(0xFFF3F4F6),\n                      child: Icon(\n                        Icons.image_outlined,\n                        color: const Color(0xFF9CA3AF),\n                        size: 20.sp,\n                      ),\n                    ),\n            ),\n          ),\n          SizedBox(width: 12.w),\n          Expanded(\n            child: Column(\n              crossAxisAlignment: CrossAxisAlignment.start,\n              children: [\n                Text(\n                  item.productName,\n                  style: TextStyle(\n                    fontSize: 14.sp,\n                    fontWeight: FontWeight.w600,\n                    color: const Color(0xFF1F2937),\n                  ),\n                  maxLines: 1,\n                  overflow: TextOverflow.ellipsis,\n                ),\n                SizedBox(height: 4.h),\n                Row(\n                  children: [\n                    Text(\n                      '${formatPrice(item.productPrice)} د.ع',\n                      style: TextStyle(\n                        fontSize: 12.sp,\n                        color: const Color(0xFF6B7280),\n                      ),\n                    ),\n                    Text(\n                      ' × ${item.quantity}',\n                      style: TextStyle(\n                        fontSize: 12.sp,\n                        color: const Color(0xFF6B7280),\n                      ),\n                    ),\n                  ],\n                ),\n              ],\n            ),\n          ),\n          Text(\n            '${formatPrice(item.totalPrice)} د.ع',\n            style: TextStyle(\n              fontSize: 14.sp,\n              fontWeight: FontWeight.bold,\n              color: const Color(0xFF059669),\n            ),\n          ),\n        ],\n      ),\n    );\n  }\n  \n  Widget _buildDeliveryInfo(OrderConfirmationController controller) {\n    return Container(\n      padding: EdgeInsets.all(16.w),\n      decoration: BoxDecoration(\n        color: Colors.white,\n        borderRadius: BorderRadius.circular(12.r),\n        boxShadow: [\n          BoxShadow(\n            color: Colors.black.withOpacity(0.05),\n            spreadRadius: 0,\n            blurRadius: 10.r,\n            offset: Offset(0, 2.h),\n          ),\n        ],\n      ),\n      child: Column(\n        crossAxisAlignment: CrossAxisAlignment.start,\n        children: [\n          Row(\n            children: [\n              Icon(\n                Icons.location_on_outlined,\n                color: const Color(0xFF6366F1),\n                size: 24.sp,\n              ),\n              SizedBox(width: 8.w),\n              Text(\n                'معلومات التسليم',\n                style: TextStyle(\n                  fontSize: 18.sp,\n                  fontWeight: FontWeight.bold,\n                  color: const Color(0xFF1F2937),\n                ),\n              ),\n            ],\n          ),\n          SizedBox(height: 16.h),\n          \n          // العنوان\n          Container(\n            padding: EdgeInsets.all(12.w),\n            decoration: BoxDecoration(\n              color: const Color(0xFFF8FAFC),\n              borderRadius: BorderRadius.circular(8.r),\n            ),\n            child: Column(\n              crossAxisAlignment: CrossAxisAlignment.start,\n              children: [\n                Text(\n                  'عنوان التسليم:',\n                  style: TextStyle(\n                    fontSize: 12.sp,\n                    fontWeight: FontWeight.w600,\n                    color: const Color(0xFF6B7280),\n                  ),\n                ),\n                SizedBox(height: 4.h),\n                Text(\n                  controller.deliveryAddress,\n                  style: TextStyle(\n                    fontSize: 14.sp,\n                    color: const Color(0xFF1F2937),\n                  ),\n                ),\n              ],\n            ),\n          ),\n        ],\n      ),\n    );\n  }\n  \n  Widget _buildPaymentSummary(OrderConfirmationController controller) {\n    return Container(\n      padding: EdgeInsets.all(16.w),\n      decoration: BoxDecoration(\n        color: Colors.white,\n        borderRadius: BorderRadius.circular(12.r),\n        boxShadow: [\n          BoxShadow(\n            color: Colors.black.withOpacity(0.05),\n            spreadRadius: 0,\n            blurRadius: 10.r,\n            offset: Offset(0, 2.h),\n          ),\n        ],\n      ),\n      child: Column(\n        crossAxisAlignment: CrossAxisAlignment.start,\n        children: [\n          Row(\n            children: [\n              Icon(\n                Icons.receipt_outlined,\n                color: const Color(0xFF6366F1),\n                size: 24.sp,\n              ),\n              SizedBox(width: 8.w),\n              Text(\n                'ملخص الدفع',\n                style: TextStyle(\n                  fontSize: 18.sp,\n                  fontWeight: FontWeight.bold,\n                  color: const Color(0xFF1F2937),\n                ),\n              ),\n            ],\n          ),\n          SizedBox(height: 16.h),\n          \n          _buildPaymentRow('المجموع الفرعي:', '${formatPrice(controller.subtotal)} د.ع'),\n          _buildPaymentRow('رسوم التوصيل:', controller.deliveryFee > 0 ? '${formatPrice(controller.deliveryFee)} د.ع' : 'مجاني'),\n          Divider(height: 20.h, color: const Color(0xFFE5E7EB)),\n          _buildPaymentRow(\n            'المجموع الكلي:', \n            '${formatPrice(controller.total)} د.ع',\n            isTotal: true,\n          ),\n        ],\n      ),\n    );\n  }\n  \n  Widget _buildPaymentRow(String label, String value, {bool isTotal = false}) {\n    return Padding(\n      padding: EdgeInsets.only(bottom: 8.h),\n      child: Row(\n        mainAxisAlignment: MainAxisAlignment.spaceBetween,\n        children: [\n          Text(\n            label,\n            style: TextStyle(\n              fontSize: isTotal ? 16.sp : 14.sp,\n              fontWeight: isTotal ? FontWeight.bold : FontWeight.normal,\n              color: const Color(0xFF1F2937),\n            ),\n          ),\n          Text(\n            value,\n            style: TextStyle(\n              fontSize: isTotal ? 18.sp : 14.sp,\n              fontWeight: FontWeight.bold,\n              color: isTotal ? const Color(0xFF059669) : const Color(0xFF1F2937),\n            ),\n          ),\n        ],\n      ),\n    );\n  }\n  \n  Widget _buildConfirmButton(OrderConfirmationController controller) {\n    return SizedBox(\n      width: double.infinity,\n      height: 50.h,\n      child: ElevatedButton(\n        onPressed: controller.isProcessing ? null : controller.confirmOrder,\n        style: ElevatedButton.styleFrom(\n          backgroundColor: const Color(0xFF6366F1),\n          disabledBackgroundColor: const Color(0xFF9CA3AF),\n          shape: RoundedRectangleBorder(\n            borderRadius: BorderRadius.circular(25.r),\n          ),\n        ),\n        child: controller.isProcessing\n            ? SizedBox(\n                width: 20.w,\n                height: 20.w,\n                child: const CircularProgressIndicator(\n                  strokeWidth: 2,\n                  valueColor: AlwaysStoppedAnimation<Color>(Colors.white),\n                ),\n              )\n            : Text(\n                'تأكيد الطلب',\n                style: TextStyle(\n                  fontSize: 16.sp,\n                  fontWeight: FontWeight.bold,\n                  color: Colors.white,\n                ),\n              ),\n      ),\n    );\n  }\n}"
        }
    ]
}