{
    "sourceFile": "lib/Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…ÙŠÙ„ /HomePage/class/FavoritesScreen.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1752945959883,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752949592546,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1187,9 +1187,9 @@\n           }\n \n           // Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ù„Ù„ØµÙˆØ±Ø© Ø¨Ø´ÙƒÙ„ Ø£ÙƒØ«Ø± ØªÙ†Ø¸ÙŠÙ…Ø§Ù‹\n           if (item.imageUrl?.isNotEmpty == true) {\n-            shareText.writeln('   ï¿½ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©: ${item.imageUrl}');\n+            shareText.writeln('   \udd17 Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©: ${item.imageUrl}');\n           }\n \n           shareText.writeln('   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');\n           shareText.writeln('');\n"
                }
            ],
            "date": 1752945959883,
            "name": "Commit-0",
            "content": "import 'package:cloud_firestore/cloud_firestore.dart';\nimport 'package:flutter/material.dart';\nimport 'package:get/get.dart';\nimport 'package:cached_network_image/cached_network_image.dart';\nimport 'package:shimmer/shimmer.dart';\nimport 'package:flutter_screenutil/flutter_screenutil.dart';\nimport 'package:flutter/services.dart';\n\n// Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø´Ø§Ø´Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬\nimport '../../../Model/model_item.dart';\nimport '../../../XXX/xxx_firebase.dart';\nimport 'DetailsOfItemScreen.dart';\n// (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©/Ø§Ù„Ø¥Ø²Ø§Ù„Ø© Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª Ø¹Ø±Ø¶Ù‡ Ù‡Ù†Ø§\nimport 'FavoriteController.dart';\n\nclass FavoritesScreen extends StatelessWidget {\n  const FavoritesScreen({super.key});\n\n  @override\n  Widget build(BuildContext context) {\n    // Ø­Ù‚Ù† Ø£Ùˆ Ø¥ÙŠØ¬Ø§Ø¯ Ù…ØªØ­ÙƒÙ… Ø§Ù„Ù…ÙØ¶Ù„Ø©\n    final FavoriteController favoriteCtrl = Get.put(FavoriteController());\n    final theme = Theme.of(context);\n\n    // Ù…ØªØ­ÙƒÙ…Ø§Øª Ù„Ù„ØªÙØ§Ø¹Ù„\n    final RxBool isGridView = false.obs;\n    final RxString searchQuery = ''.obs;\n    final RxString sortBy = 'recent'.obs; // recent, name, price\n    final RxBool isAscending = true.obs;\n\n    return Scaffold(\n      backgroundColor: theme.scaffoldBackgroundColor,\n      body: CustomScrollView(\n        slivers: [\n          // AppBar Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ©\n          SliverAppBar(\n            expandedHeight: 200.h,\n            floating: false,\n            pinned: true,\n            elevation: 0,\n            backgroundColor: theme.primaryColor,\n            foregroundColor: Colors.white,\n            systemOverlayStyle: SystemUiOverlayStyle.light,\n            flexibleSpace: FlexibleSpaceBar(\n              title: AnimatedDefaultTextStyle(\n                duration: const Duration(milliseconds: 300),\n                style: TextStyle(\n                  color: Colors.white,\n                  fontSize: 20.sp,\n                  fontWeight: FontWeight.bold,\n                  shadows: [\n                    Shadow(\n                      color: Colors.black.withValues(alpha: 0.3),\n                      offset: const Offset(0, 1),\n                      blurRadius: 3,\n                    ),\n                  ],\n                ),\n                child: const Text('Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©'),\n              ),\n              background: Container(\n                decoration: BoxDecoration(\n                  gradient: LinearGradient(\n                    begin: Alignment.topLeft,\n                    end: Alignment.bottomRight,\n                    colors: [\n                      theme.primaryColor,\n                      theme.primaryColor.withValues(alpha: 0.8),\n                      theme.primaryColor.withValues(alpha: 0.6),\n                    ],\n                  ),\n                ),\n                child: Stack(\n                  children: [\n                    // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©\n                    Positioned(\n                      top: -50.h,\n                      right: -50.w,\n                      child: AnimatedContainer(\n                        duration: const Duration(seconds: 3),\n                        width: 150.w,\n                        height: 150.h,\n                        decoration: BoxDecoration(\n                          shape: BoxShape.circle,\n                          color: Colors.white.withValues(alpha: 0.1),\n                        ),\n                      ),\n                    ),\n                    Positioned(\n                      bottom: -30.h,\n                      left: -30.w,\n                      child: AnimatedContainer(\n                        duration: const Duration(seconds: 4),\n                        width: 100.w,\n                        height: 100.h,\n                        decoration: BoxDecoration(\n                          shape: BoxShape.circle,\n                          color: Colors.white.withValues(alpha: 0.05),\n                        ),\n                      ),\n                    ),\n                    // Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©\n                    Center(\n                      child: Column(\n                        mainAxisAlignment: MainAxisAlignment.center,\n                        children: [\n                          SizedBox(height: 30.h),\n                          TweenAnimationBuilder<double>(\n                            duration: const Duration(milliseconds: 1000),\n                            tween: Tween(begin: 0.0, end: 1.0),\n                            builder: (context, value, child) {\n                              return Transform.scale(\n                                scale: 0.5 + (0.5 * value),\n                                child: Icon(\n                                  Icons.favorite_rounded,\n                                  size: 60.sp,\n                                  color: Colors.white.withValues(alpha: 0.9),\n                                ),\n                              );\n                            },\n                          ),\n                          SizedBox(height: 10.h),\n                          Text(\n                            'Ù…Ù†ØªØ¬Ø§ØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©',\n                            style: TextStyle(\n                              color: Colors.white.withValues(alpha: 0.9),\n                              fontSize: 16.sp,\n                              fontWeight: FontWeight.w500,\n                            ),\n                          ),\n                        ],\n                      ),\n                    ),\n                  ],\n                ),\n              ),\n            ),\n            actions: [\n              // Ø²Ø± Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…ÙØ¶Ù„Ø©\n              StreamBuilder<QuerySnapshot<Map<String, dynamic>>>(\n                stream: favoriteCtrl.getFavoritesStream(),\n                builder: (context, snapshot) {\n                  final hasItems = (snapshot.data?.docs.length ?? 0) > 0;\n                  if (!hasItems) return const SizedBox.shrink();\n\n                  return IconButton(\n                    icon: Icon(\n                      Icons.share_rounded,\n                      color: Colors.white.withValues(alpha: 0.9),\n                    ),\n                    onPressed: () => _shareFavorites(context, favoriteCtrl),\n                    tooltip: 'Ù…Ø´Ø§Ø±ÙƒØ© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©',\n                  );\n                },\n              ),\n              // Ø²Ø± Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙØ¶Ù„Ø©\n              StreamBuilder<QuerySnapshot<Map<String, dynamic>>>(\n                stream: favoriteCtrl.getFavoritesStream(),\n                builder: (context, snapshot) {\n                  final hasItems = (snapshot.data?.docs.length ?? 0) > 0;\n                  if (!hasItems) return const SizedBox.shrink();\n\n                  return IconButton(\n                    icon: Icon(\n                      Icons.clear_all_rounded,\n                      color: Colors.white.withValues(alpha: 0.9),\n                    ),\n                    onPressed: () => _showClearAllDialog(context, favoriteCtrl),\n                    tooltip: 'Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙØ¶Ù„Ø©',\n                  );\n                },\n              ),\n              // Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ (Ø´Ø¨ÙƒØ©/Ù‚Ø§Ø¦Ù…Ø©)\n              Obx(\n                () => IconButton(\n                  icon: AnimatedSwitcher(\n                    duration: const Duration(milliseconds: 300),\n                    child: Icon(\n                      isGridView.value\n                          ? Icons.view_list_rounded\n                          : Icons.grid_view_rounded,\n                      key: ValueKey(isGridView.value),\n                      color: Colors.white,\n                    ),\n                  ),\n                  onPressed: () => isGridView.toggle(),\n                  tooltip: isGridView.value ? 'Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©' : 'Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø¨ÙƒØ©',\n                ),\n              ),\n              SizedBox(width: 8.w),\n            ],\n          ),\n\n          // Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„Ø§ØªØ±\n          SliverToBoxAdapter(\n            child: Container(\n              margin: EdgeInsets.all(16.w),\n              child: Column(\n                children: [\n                  // Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù…\n                  Container(\n                    decoration: BoxDecoration(\n                      color: theme.cardColor,\n                      borderRadius: BorderRadius.circular(15.r),\n                      boxShadow: [\n                        BoxShadow(\n                          color: Colors.black.withValues(alpha: 0.05),\n                          blurRadius: 10.r,\n                          offset: Offset(0, 2.h),\n                        ),\n                      ],\n                    ),\n                    child: TextField(\n                      onChanged: (value) => searchQuery.value = value,\n                      decoration: InputDecoration(\n                        hintText: 'Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø©...',\n                        prefixIcon: Icon(\n                          Icons.search_rounded,\n                          color: theme.primaryColor,\n                          size: 24.sp,\n                        ),\n                        suffixIcon: Obx(\n                          () =>\n                              searchQuery.value.isNotEmpty\n                                  ? IconButton(\n                                    icon: Icon(\n                                      Icons.clear_rounded,\n                                      color: Colors.grey,\n                                    ),\n                                    onPressed: () => searchQuery.value = '',\n                                  )\n                                  : const SizedBox.shrink(),\n                        ),\n                        border: InputBorder.none,\n                        contentPadding: EdgeInsets.symmetric(\n                          horizontal: 16.w,\n                          vertical: 16.h,\n                        ),\n                        hintStyle: TextStyle(\n                          color: Colors.grey[500],\n                          fontSize: 14.sp,\n                        ),\n                      ),\n                    ),\n                  ),\n\n                  SizedBox(height: 12.h),\n\n                  // Ø´Ø±ÙŠØ· Ø§Ù„ÙÙ„Ø§ØªØ± ÙˆØ§Ù„ØªØ±ØªÙŠØ¨\n                  Row(\n                    children: [\n                      // Ø²Ø± Ø§Ù„ØªØ±ØªÙŠØ¨\n                      Expanded(\n                        child: Container(\n                          decoration: BoxDecoration(\n                            color: theme.cardColor,\n                            borderRadius: BorderRadius.circular(12.r),\n                            border: Border.all(\n                              color: theme.primaryColor.withValues(alpha: 0.2),\n                            ),\n                          ),\n                          child: Obx(\n                            () => DropdownButtonHideUnderline(\n                              child: DropdownButton<String>(\n                                value: sortBy.value,\n                                isExpanded: true,\n                                icon: Icon(\n                                  Icons.keyboard_arrow_down_rounded,\n                                  color: theme.primaryColor,\n                                ),\n                                padding: EdgeInsets.symmetric(horizontal: 12.w),\n                                items: [\n                                  DropdownMenuItem(\n                                    value: 'recent',\n                                    child: Row(\n                                      children: [\n                                        Icon(\n                                          Icons.access_time_rounded,\n                                          size: 16.sp,\n                                        ),\n                                        SizedBox(width: 8.w),\n                                        Text('Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹'),\n                                      ],\n                                    ),\n                                  ),\n                                  DropdownMenuItem(\n                                    value: 'name',\n                                    child: Row(\n                                      children: [\n                                        Icon(\n                                          Icons.sort_by_alpha_rounded,\n                                          size: 16.sp,\n                                        ),\n                                        SizedBox(width: 8.w),\n                                        Text('Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³Ù…'),\n                                      ],\n                                    ),\n                                  ),\n                                  DropdownMenuItem(\n                                    value: 'price',\n                                    child: Row(\n                                      children: [\n                                        Icon(\n                                          Icons.attach_money_rounded,\n                                          size: 16.sp,\n                                        ),\n                                        SizedBox(width: 8.w),\n                                        Text('Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±'),\n                                      ],\n                                    ),\n                                  ),\n                                ],\n                                onChanged: (value) => sortBy.value = value!,\n                              ),\n                            ),\n                          ),\n                        ),\n                      ),\n\n                      SizedBox(width: 8.w),\n\n                      // Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨ (ØªØµØ§Ø¹Ø¯ÙŠ/ØªÙ†Ø§Ø²Ù„ÙŠ)\n                      Obx(\n                        () => Container(\n                          decoration: BoxDecoration(\n                            color: theme.cardColor,\n                            borderRadius: BorderRadius.circular(12.r),\n                            border: Border.all(\n                              color: theme.primaryColor.withValues(alpha: 0.2),\n                            ),\n                          ),\n                          child: IconButton(\n                            icon: AnimatedRotation(\n                              turns: isAscending.value ? 0 : 0.5,\n                              duration: const Duration(milliseconds: 300),\n                              child: Icon(\n                                Icons.sort_rounded,\n                                color: theme.primaryColor,\n                              ),\n                            ),\n                            onPressed: () => isAscending.toggle(),\n                            tooltip: isAscending.value ? 'ØªØµØ§Ø¹Ø¯ÙŠ' : 'ØªÙ†Ø§Ø²Ù„ÙŠ',\n                          ),\n                        ),\n                      ),\n                    ],\n                  ),\n                ],\n              ),\n            ),\n          ),\n\n          // Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ\n          StreamBuilder<QuerySnapshot<Map<String, dynamic>>>(\n            stream: favoriteCtrl.getFavoritesStream(),\n            builder: (context, favSnapshot) {\n              if (favSnapshot.connectionState == ConnectionState.waiting) {\n                return _buildLoadingSlivers(context, isGridView);\n              }\n\n              if (favSnapshot.hasError) {\n                return _buildErrorSliver(\n                  context,\n                  'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙØ¶Ù„Ø©',\n                );\n              }\n\n              final favoriteProductIds =\n                  favSnapshot.data?.docs.map((doc) => doc.id).toList() ?? [];\n\n              if (favoriteProductIds.isEmpty) {\n                return _buildEmptySliver(context);\n              }\n\n              return StreamBuilder<QuerySnapshot<Map<String, dynamic>>>(\n                stream:\n                    FirebaseFirestore.instance\n                        .collection(FirebaseX.itemsCollection)\n                        .where(\n                          FieldPath.documentId,\n                          whereIn: favoriteProductIds,\n                        )\n                        .snapshots(),\n                builder: (context, productSnapshot) {\n                  if (productSnapshot.connectionState ==\n                      ConnectionState.waiting) {\n                    return _buildLoadingSlivers(context, isGridView);\n                  }\n\n                  if (productSnapshot.hasError) {\n                    return _buildErrorSliver(\n                      context,\n                      'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',\n                    );\n                  }\n\n                  var productDocs = productSnapshot.data?.docs ?? [];\n\n                  if (productDocs.isEmpty) {\n                    return _buildEmptySliver(context);\n                  }\n\n                  // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØ±ØªÙŠØ¨\n                  return Obx(() {\n                    var filteredDocs = productDocs;\n\n                    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø­Ø«\n                    if (searchQuery.value.isNotEmpty) {\n                      filteredDocs =\n                          productDocs.where((doc) {\n                            try {\n                              final item = ItemModel.fromMap(\n                                doc.data(),\n                                doc.id,\n                              );\n                              return item.name.toLowerCase().contains(\n                                searchQuery.value.toLowerCase(),\n                              );\n                            } catch (e) {\n                              return false;\n                            }\n                          }).toList();\n                    }\n\n                    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±ØªÙŠØ¨\n                    filteredDocs.sort((a, b) {\n                      try {\n                        final itemA = ItemModel.fromMap(a.data(), a.id);\n                        final itemB = ItemModel.fromMap(b.data(), b.id);\n\n                        int comparison = 0;\n                        switch (sortBy.value) {\n                          case 'name':\n                            comparison = itemA.name.compareTo(itemB.name);\n                            break;\n                          case 'price':\n                            comparison = itemA.price.compareTo(itemB.price);\n                            break;\n                          case 'recent':\n                          default:\n                            // Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ Ø­Ø³Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ© (ÙŠØ­ØªØ§Ø¬ ØªØ®Ø²ÙŠÙ† timestamp)\n                            comparison = 0;\n                            break;\n                        }\n\n                        return isAscending.value ? comparison : -comparison;\n                      } catch (e) {\n                        return 0;\n                      }\n                    });\n\n                    if (filteredDocs.isEmpty) {\n                      return _buildNoResultsSliver(context);\n                    }\n\n                    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¹ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª\n                    return SliverMainAxisGroup(\n                      slivers: [\n                        // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø©\n                        SliverToBoxAdapter(\n                          child: _buildFavoritesStats(\n                            context,\n                            filteredDocs.length,\n                            productDocs.length,\n                          ),\n                        ),\n                        // Ø§Ù„Ù†ØªØ§Ø¦Ø¬\n                        isGridView.value\n                            ? _buildGridView(\n                              context,\n                              filteredDocs,\n                              favoriteCtrl,\n                              theme,\n                            )\n                            : _buildListView(\n                              context,\n                              filteredDocs,\n                              favoriteCtrl,\n                              theme,\n                            ),\n                      ],\n                    );\n                  });\n                },\n              );\n            },\n          ),\n\n          // Ù…Ø³Ø§Ø­Ø© Ø¥Ø¶Ø§ÙÙŠØ© ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©\n          SliverToBoxAdapter(child: SizedBox(height: 20.h)),\n        ],\n      ),\n    );\n  }\n\n  // Ø¨Ù†Ø§Ø¡ Slivers Ù„Ù„ØªØ­Ù…ÙŠÙ„\n  Widget _buildLoadingSlivers(BuildContext context, RxBool isGridView) {\n    return Obx(\n      () =>\n          isGridView.value\n              ? _buildLoadingGrid(context)\n              : _buildLoadingList(context),\n    );\n  }\n\n  // Ø¨Ù†Ø§Ø¡ Ø´Ø¨ÙƒØ© Ø§Ù„ØªØ­Ù…ÙŠÙ„\n  Widget _buildLoadingGrid(BuildContext context) {\n    return SliverPadding(\n      padding: EdgeInsets.all(16.w),\n      sliver: SliverGrid(\n        gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(\n          crossAxisCount: 2,\n          childAspectRatio: 0.7,\n          crossAxisSpacing: 12.w,\n          mainAxisSpacing: 12.h,\n        ),\n        delegate: SliverChildBuilderDelegate(\n          (context, index) => _buildShimmerCard(context, isGrid: true),\n          childCount: 6,\n        ),\n      ),\n    );\n  }\n\n  // Ø¨Ù†Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„\n  Widget _buildLoadingList(BuildContext context) {\n    return SliverPadding(\n      padding: EdgeInsets.all(16.w),\n      sliver: SliverList(\n        delegate: SliverChildBuilderDelegate(\n          (context, index) => _buildShimmerCard(context, isGrid: false),\n          childCount: 5,\n        ),\n      ),\n    );\n  }\n\n  // ÙƒØ§Ø±Ø¯ Ø§Ù„Ø´ÙŠÙ…Ø±\n  Widget _buildShimmerCard(BuildContext context, {required bool isGrid}) {\n    return Shimmer.fromColors(\n      baseColor: Colors.grey[300]!,\n      highlightColor: Colors.grey[100]!,\n      child: Container(\n        margin: EdgeInsets.only(bottom: 12.h),\n        decoration: BoxDecoration(\n          color: Colors.white,\n          borderRadius: BorderRadius.circular(15.r),\n        ),\n        child:\n            isGrid\n                ? Column(\n                  crossAxisAlignment: CrossAxisAlignment.start,\n                  children: [\n                    Expanded(\n                      flex: 3,\n                      child: Container(\n                        decoration: BoxDecoration(\n                          color: Colors.white,\n                          borderRadius: BorderRadius.vertical(\n                            top: Radius.circular(15.r),\n                          ),\n                        ),\n                      ),\n                    ),\n                    Expanded(\n                      flex: 2,\n                      child: Padding(\n                        padding: EdgeInsets.all(12.w),\n                        child: Column(\n                          crossAxisAlignment: CrossAxisAlignment.start,\n                          children: [\n                            Container(height: 16.h, color: Colors.white),\n                            SizedBox(height: 8.h),\n                            Container(\n                              height: 12.h,\n                              width: 80.w,\n                              color: Colors.white,\n                            ),\n                          ],\n                        ),\n                      ),\n                    ),\n                  ],\n                )\n                : SizedBox(\n                  height: 100.h,\n                  child: Row(\n                    children: [\n                      Container(\n                        width: 100.w,\n                        height: 100.h,\n                        decoration: BoxDecoration(\n                          color: Colors.white,\n                          borderRadius: BorderRadius.horizontal(\n                            right: Radius.circular(15.r),\n                          ),\n                        ),\n                      ),\n                      Expanded(\n                        child: Padding(\n                          padding: EdgeInsets.all(12.w),\n                          child: Column(\n                            crossAxisAlignment: CrossAxisAlignment.start,\n                            mainAxisAlignment: MainAxisAlignment.center,\n                            children: [\n                              Container(height: 16.h, color: Colors.white),\n                              SizedBox(height: 8.h),\n                              Container(\n                                height: 12.h,\n                                width: 60.w,\n                                color: Colors.white,\n                              ),\n                            ],\n                          ),\n                        ),\n                      ),\n                    ],\n                  ),\n                ),\n      ),\n    );\n  }\n\n  // Ø¨Ù†Ø§Ø¡ Sliver Ù„Ù„Ø®Ø·Ø£\n  Widget _buildErrorSliver(BuildContext context, String message) {\n    final theme = Theme.of(context);\n    return SliverFillRemaining(\n      child: Center(\n        child: Column(\n          mainAxisAlignment: MainAxisAlignment.center,\n          children: [\n            Icon(\n              Icons.error_outline_rounded,\n              size: 80.sp,\n              color: Colors.red[300],\n            ),\n            SizedBox(height: 20.h),\n            Text(\n              message,\n              style: TextStyle(\n                fontSize: 18.sp,\n                fontWeight: FontWeight.w600,\n                color: Colors.red[700],\n              ),\n              textAlign: TextAlign.center,\n            ),\n            SizedBox(height: 20.h),\n            ElevatedButton.icon(\n              onPressed: () => Get.back(),\n              icon: Icon(Icons.refresh_rounded),\n              label: Text('Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©'),\n              style: ElevatedButton.styleFrom(\n                backgroundColor: theme.primaryColor,\n                foregroundColor: Colors.white,\n                padding: EdgeInsets.symmetric(horizontal: 24.w, vertical: 12.h),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(25.r),\n                ),\n              ),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n\n  // Ø¨Ù†Ø§Ø¡ Sliver Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±ØºØ©\n  Widget _buildEmptySliver(BuildContext context) {\n    final theme = Theme.of(context);\n    return SliverFillRemaining(\n      child: Center(\n        child: Column(\n          mainAxisAlignment: MainAxisAlignment.center,\n          children: [\n            TweenAnimationBuilder<double>(\n              duration: const Duration(milliseconds: 1500),\n              tween: Tween(begin: 0.0, end: 1.0),\n              builder: (context, value, child) {\n                return Transform.scale(\n                  scale: 0.5 + (0.5 * value),\n                  child: Icon(\n                    Icons.favorite_border_rounded,\n                    size: 120.sp,\n                    color: Colors.grey[400],\n                  ),\n                );\n              },\n            ),\n            SizedBox(height: 24.h),\n            Text(\n              'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙØ§Ø±ØºØ©',\n              style: TextStyle(\n                fontSize: 24.sp,\n                fontWeight: FontWeight.bold,\n                color: Colors.grey[600],\n              ),\n            ),\n            SizedBox(height: 16.h),\n            Padding(\n              padding: EdgeInsets.symmetric(horizontal: 40.w),\n              child: Text(\n                'Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙŠ ØªØ¹Ø¬Ø¨Ùƒ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©',\n                textAlign: TextAlign.center,\n                style: TextStyle(\n                  fontSize: 16.sp,\n                  color: Colors.grey[500],\n                  height: 1.5,\n                ),\n              ),\n            ),\n            SizedBox(height: 32.h),\n            ElevatedButton.icon(\n              onPressed: () => Get.back(),\n              icon: Icon(Icons.shopping_bag_outlined),\n              label: Text('ØªØµÙØ­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª'),\n              style: ElevatedButton.styleFrom(\n                backgroundColor: theme.primaryColor,\n                foregroundColor: Colors.white,\n                padding: EdgeInsets.symmetric(horizontal: 32.w, vertical: 16.h),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(25.r),\n                ),\n                elevation: 4,\n              ),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n\n  // Ø¨Ù†Ø§Ø¡ Sliver Ù„Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù†ØªØ§Ø¦Ø¬\n  Widget _buildNoResultsSliver(BuildContext context) {\n    return SliverFillRemaining(\n      child: Center(\n        child: Column(\n          mainAxisAlignment: MainAxisAlignment.center,\n          children: [\n            Icon(\n              Icons.search_off_rounded,\n              size: 80.sp,\n              color: Colors.grey[400],\n            ),\n            SizedBox(height: 20.h),\n            Text(\n              'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬',\n              style: TextStyle(\n                fontSize: 20.sp,\n                fontWeight: FontWeight.bold,\n                color: Colors.grey[600],\n              ),\n            ),\n            SizedBox(height: 12.h),\n            Text(\n              'Ù„Ù… Ù†Ø¬Ø¯ Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø¨Ø­Ø«Ùƒ',\n              style: TextStyle(fontSize: 14.sp, color: Colors.grey[500]),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n\n  // Ø¨Ù†Ø§Ø¡ Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø¨ÙƒØ©\n  Widget _buildGridView(\n    BuildContext context,\n    List<QueryDocumentSnapshot<Map<String, dynamic>>> docs,\n    FavoriteController favoriteCtrl,\n    ThemeData theme,\n  ) {\n    return SliverPadding(\n      padding: EdgeInsets.all(16.w),\n      sliver: SliverGrid(\n        gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(\n          crossAxisCount: 2,\n          childAspectRatio: 0.7,\n          crossAxisSpacing: 12.w,\n          mainAxisSpacing: 12.h,\n        ),\n        delegate: SliverChildBuilderDelegate((context, index) {\n          try {\n            final item = ItemModel.fromMap(docs[index].data(), docs[index].id);\n            return _buildGridItem(context, item, favoriteCtrl, theme);\n          } catch (e) {\n            return _buildErrorCard(context);\n          }\n        }, childCount: docs.length),\n      ),\n    );\n  }\n\n  // Ø¨Ù†Ø§Ø¡ Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©\n  Widget _buildListView(\n    BuildContext context,\n    List<QueryDocumentSnapshot<Map<String, dynamic>>> docs,\n    FavoriteController favoriteCtrl,\n    ThemeData theme,\n  ) {\n    return SliverPadding(\n      padding: EdgeInsets.all(16.w),\n      sliver: SliverList(\n        delegate: SliverChildBuilderDelegate((context, index) {\n          try {\n            final item = ItemModel.fromMap(docs[index].data(), docs[index].id);\n            return _buildListItem(context, item, favoriteCtrl, theme);\n          } catch (e) {\n            return _buildErrorCard(context);\n          }\n        }, childCount: docs.length),\n      ),\n    );\n  }\n\n  // Ø¨Ù†Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„Ø´Ø¨ÙƒØ©\n  Widget _buildGridItem(\n    BuildContext context,\n    ItemModel item,\n    FavoriteController favoriteCtrl,\n    ThemeData theme,\n  ) {\n    return Container(\n      decoration: BoxDecoration(\n        color: theme.cardColor,\n        borderRadius: BorderRadius.circular(20.r),\n        boxShadow: [\n          BoxShadow(\n            color: Colors.black.withValues(alpha: 0.08),\n            blurRadius: 15.r,\n            offset: Offset(0, 4.h),\n          ),\n        ],\n      ),\n      child: Material(\n        color: Colors.transparent,\n        child: InkWell(\n          borderRadius: BorderRadius.circular(20.r),\n          onTap: () => Get.to(() => DetailsOfItemScreen(item: item)),\n          child: Column(\n            crossAxisAlignment: CrossAxisAlignment.start,\n            children: [\n              // Ø§Ù„ØµÙˆØ±Ø©\n              Expanded(\n                flex: 3,\n                child: Stack(\n                  children: [\n                    ClipRRect(\n                      borderRadius: BorderRadius.vertical(\n                        top: Radius.circular(20.r),\n                      ),\n                      child: CachedNetworkImage(\n                        imageUrl: item.imageUrl ?? '',\n                        width: double.infinity,\n                        height: double.infinity,\n                        fit: BoxFit.cover,\n                        placeholder:\n                            (c, u) => Container(\n                              color: Colors.grey[200],\n                              child: Center(\n                                child: Icon(\n                                  Icons.image_outlined,\n                                  color: Colors.grey[400],\n                                  size: 40.sp,\n                                ),\n                              ),\n                            ),\n                        errorWidget:\n                            (c, u, e) => Container(\n                              color: Colors.grey[100],\n                              child: Center(\n                                child: Icon(\n                                  Icons.broken_image_outlined,\n                                  color: Colors.grey[400],\n                                  size: 40.sp,\n                                ),\n                              ),\n                            ),\n                      ),\n                    ),\n                    // Ø²Ø± Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ©\n                    Positioned(\n                      top: 8.h,\n                      left: 8.w,\n                      child: Container(\n                        decoration: BoxDecoration(\n                          color: Colors.white,\n                          shape: BoxShape.circle,\n                          boxShadow: [\n                            BoxShadow(\n                              color: Colors.black.withValues(alpha: 0.1),\n                              blurRadius: 8.r,\n                            ),\n                          ],\n                        ),\n                        child: IconButton(\n                          icon: Icon(\n                            Icons.favorite_rounded,\n                            color: Colors.red[400],\n                            size: 20.sp,\n                          ),\n                          onPressed:\n                              () => favoriteCtrl.toggleFavorite(item.id, true),\n                          padding: EdgeInsets.zero,\n                          constraints: BoxConstraints(\n                            minWidth: 32.w,\n                            minHeight: 32.h,\n                          ),\n                        ),\n                      ),\n                    ),\n                  ],\n                ),\n              ),\n              // Ø§Ù„Ù…Ø­ØªÙˆÙ‰\n              Expanded(\n                flex: 2,\n                child: Padding(\n                  padding: EdgeInsets.all(12.w),\n                  child: Column(\n                    crossAxisAlignment: CrossAxisAlignment.start,\n                    mainAxisAlignment: MainAxisAlignment.spaceBetween,\n                    children: [\n                      Text(\n                        item.name,\n                        style: TextStyle(\n                          fontSize: 14.sp,\n                          fontWeight: FontWeight.w600,\n                          color: theme.textTheme.titleMedium?.color,\n                        ),\n                        maxLines: 2,\n                        overflow: TextOverflow.ellipsis,\n                      ),\n                      Row(\n                        mainAxisAlignment: MainAxisAlignment.spaceBetween,\n                        children: [\n                          Text(\n                            '${item.price} Ø±ÙŠØ§Ù„',\n                            style: TextStyle(\n                              fontSize: 16.sp,\n                              fontWeight: FontWeight.bold,\n                              color: theme.primaryColor,\n                            ),\n                          ),\n                          Icon(\n                            Icons.arrow_forward_ios_rounded,\n                            size: 16.sp,\n                            color: Colors.grey[400],\n                          ),\n                        ],\n                      ),\n                    ],\n                  ),\n                ),\n              ),\n            ],\n          ),\n        ),\n      ),\n    );\n  }\n\n  // Ø¨Ù†Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©\n  Widget _buildListItem(\n    BuildContext context,\n    ItemModel item,\n    FavoriteController favoriteCtrl,\n    ThemeData theme,\n  ) {\n    return Container(\n      margin: EdgeInsets.only(bottom: 12.h),\n      decoration: BoxDecoration(\n        color: theme.cardColor,\n        borderRadius: BorderRadius.circular(20.r),\n        boxShadow: [\n          BoxShadow(\n            color: Colors.black.withValues(alpha: 0.06),\n            blurRadius: 12.r,\n            offset: Offset(0, 3.h),\n          ),\n        ],\n      ),\n      child: Material(\n        color: Colors.transparent,\n        child: InkWell(\n          borderRadius: BorderRadius.circular(20.r),\n          onTap: () => Get.to(() => DetailsOfItemScreen(item: item)),\n          child: Padding(\n            padding: EdgeInsets.all(16.w),\n            child: Row(\n              children: [\n                // Ø§Ù„ØµÙˆØ±Ø©\n                ClipRRect(\n                  borderRadius: BorderRadius.circular(12.r),\n                  child: CachedNetworkImage(\n                    imageUrl: item.imageUrl ?? '',\n                    width: 80.w,\n                    height: 80.h,\n                    fit: BoxFit.cover,\n                    placeholder:\n                        (c, u) => Container(\n                          color: Colors.grey[200],\n                          child: Center(\n                            child: Icon(\n                              Icons.image_outlined,\n                              color: Colors.grey[400],\n                              size: 30.sp,\n                            ),\n                          ),\n                        ),\n                    errorWidget:\n                        (c, u, e) => Container(\n                          color: Colors.grey[100],\n                          child: Center(\n                            child: Icon(\n                              Icons.broken_image_outlined,\n                              color: Colors.grey[400],\n                              size: 30.sp,\n                            ),\n                          ),\n                        ),\n                  ),\n                ),\n                SizedBox(width: 16.w),\n                // Ø§Ù„Ù…Ø­ØªÙˆÙ‰\n                Expanded(\n                  child: Column(\n                    crossAxisAlignment: CrossAxisAlignment.start,\n                    children: [\n                      Text(\n                        item.name,\n                        style: TextStyle(\n                          fontSize: 16.sp,\n                          fontWeight: FontWeight.w600,\n                          color: theme.textTheme.titleMedium?.color,\n                        ),\n                        maxLines: 2,\n                        overflow: TextOverflow.ellipsis,\n                      ),\n                      SizedBox(height: 8.h),\n                      Text(\n                        '${item.price} Ø±ÙŠØ§Ù„',\n                        style: TextStyle(\n                          fontSize: 18.sp,\n                          fontWeight: FontWeight.bold,\n                          color: theme.primaryColor,\n                        ),\n                      ),\n                    ],\n                  ),\n                ),\n                // Ø²Ø± Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙˆØ§Ù„Ø³Ù‡Ù…\n                Column(\n                  children: [\n                    Container(\n                      decoration: BoxDecoration(\n                        color: Colors.red[50],\n                        shape: BoxShape.circle,\n                      ),\n                      child: IconButton(\n                        icon: Icon(\n                          Icons.favorite_rounded,\n                          color: Colors.red[400],\n                          size: 24.sp,\n                        ),\n                        onPressed:\n                            () => favoriteCtrl.toggleFavorite(item.id, true),\n                      ),\n                    ),\n                    SizedBox(height: 8.h),\n                    Icon(\n                      Icons.arrow_forward_ios_rounded,\n                      size: 16.sp,\n                      color: Colors.grey[400],\n                    ),\n                  ],\n                ),\n              ],\n            ),\n          ),\n        ),\n      ),\n    );\n  }\n\n  // Ø¨Ù†Ø§Ø¡ ÙƒØ§Ø±Ø¯ Ø§Ù„Ø®Ø·Ø£\n  Widget _buildErrorCard(BuildContext context) {\n    return Container(\n      margin: EdgeInsets.only(bottom: 12.h),\n      padding: EdgeInsets.all(16.w),\n      decoration: BoxDecoration(\n        color: Colors.red[50],\n        borderRadius: BorderRadius.circular(12.r),\n        border: Border.all(color: Colors.red[200]!),\n      ),\n      child: Row(\n        children: [\n          Icon(Icons.error_outline, color: Colors.red[400]),\n          SizedBox(width: 12.w),\n          Text(\n            'Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬',\n            style: TextStyle(color: Colors.red[700]),\n          ),\n        ],\n      ),\n    );\n  }\n\n  // Ù…Ø´Ø§Ø±ÙƒØ© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©\n  void _shareFavorites(\n    BuildContext context,\n    FavoriteController favoriteCtrl,\n  ) async {\n    try {\n      // Ø¹Ø±Ø¶ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„\n      Get.dialog(\n        Center(\n          child: Container(\n            padding: EdgeInsets.all(24.w),\n            decoration: BoxDecoration(\n              color: Colors.white,\n              borderRadius: BorderRadius.circular(16.r),\n              boxShadow: [\n                BoxShadow(\n                  color: Colors.black.withValues(alpha: 0.1),\n                  blurRadius: 10.r,\n                ),\n              ],\n            ),\n            child: Column(\n              mainAxisSize: MainAxisSize.min,\n              children: [\n                CircularProgressIndicator(),\n                SizedBox(height: 16.h),\n                Text(\n                  'Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©...',\n                  style: TextStyle(\n                    fontSize: 16.sp,\n                    fontWeight: FontWeight.w600,\n                  ),\n                ),\n              ],\n            ),\n          ),\n        ),\n        barrierDismissible: false,\n      );\n\n      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙØ¶Ù„Ø©\n      final favoritesSnapshot = await favoriteCtrl.getFavoritesStream().first;\n      final favoriteIds = favoritesSnapshot.docs.map((doc) => doc.id).toList();\n\n      if (favoriteIds.isEmpty) {\n        Get.back();\n        Get.snackbar(\n          'ØªÙ†Ø¨ÙŠÙ‡',\n          'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙØ§Ø±ØºØ©',\n          snackPosition: SnackPosition.BOTTOM,\n          backgroundColor: Colors.orange[600],\n          colorText: Colors.white,\n        );\n        return;\n      }\n\n      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª\n      final productsSnapshot =\n          await FirebaseFirestore.instance\n              .collection(FirebaseX.itemsCollection)\n              .where(FieldPath.documentId, whereIn: favoriteIds)\n              .get();\n\n      // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù†Øµ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©\n      final StringBuffer shareText = StringBuffer();\n      shareText.writeln('ğŸ›ï¸ Ù‚Ø§Ø¦Ù…Ø© Ù…Ù†ØªØ¬Ø§ØªÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø©');\n      shareText.writeln('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');\n      shareText.writeln('');\n\n      int counter = 1;\n      for (var doc in productsSnapshot.docs) {\n        try {\n          final item = ItemModel.fromMap(doc.data(), doc.id);\n          shareText.writeln('${counter++}. ${item.name}');\n          shareText.writeln('   ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${item.price} Ø±ÙŠØ§Ù„');\n          if (item.imageUrl?.isNotEmpty == true) {\n            shareText.writeln('   ğŸ–¼ï¸ Ø§Ù„ØµÙˆØ±Ø©: ${item.imageUrl}');\n          }\n          shareText.writeln('');\n        } catch (e) {\n          // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙŠ Ø¨Ù‡Ø§ Ø®Ø·Ø£\n        }\n      }\n\n      shareText.writeln(\n        'ğŸ“± ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ ${FirebaseX.appName}',\n      );\n      shareText.writeln('ğŸ›’ Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¢Ù† ÙˆØ§Ø³ØªÙ…ØªØ¹ Ø¨ØªØ¬Ø±Ø¨Ø© ØªØ³ÙˆÙ‚ Ù…Ù…ÙŠØ²Ø©!');\n\n      // Ø¥ØºÙ„Ø§Ù‚ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„\n      Get.back();\n\n      // Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù†Øµ\n      // ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© share_plus package ÙÙŠ pubspec.yaml\n      // await Share.share(shareText.toString(), subject: 'Ù‚Ø§Ø¦Ù…Ø© Ù…Ù†ØªØ¬Ø§ØªÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø©');\n\n      // Ù„Ø­ÙŠÙ† Ø¥Ø¶Ø§ÙØ© share packageØŒ Ø³Ù†Ø¹Ø±Ø¶ Ø§Ù„Ù†Øµ ÙÙŠ dialog\n      _showShareDialog(context, shareText.toString());\n    } catch (e) {\n      // Ø¥ØºÙ„Ø§Ù‚ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£\n      if (Get.isDialogOpen ?? false) Get.back();\n\n      Get.snackbar(\n        'Ø®Ø·Ø£',\n        'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ¬Ù‡ÙŠØ² Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø© Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©',\n        snackPosition: SnackPosition.BOTTOM,\n        backgroundColor: Colors.red[600],\n        colorText: Colors.white,\n      );\n    }\n  }\n\n  // Ø¹Ø±Ø¶ dialog Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù†Øµ\n  void _showShareDialog(BuildContext context, String shareText) {\n    final theme = Theme.of(context);\n    showDialog(\n      context: context,\n      builder:\n          (context) => AlertDialog(\n            shape: RoundedRectangleBorder(\n              borderRadius: BorderRadius.circular(20.r),\n            ),\n            title: Row(\n              children: [\n                Icon(\n                  Icons.share_rounded,\n                  color: theme.primaryColor,\n                  size: 28.sp,\n                ),\n                SizedBox(width: 12.w),\n                Expanded(\n                  child: Text(\n                    'Ù…Ø´Ø§Ø±ÙƒØ© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©',\n                    style: TextStyle(\n                      fontSize: 18.sp,\n                      fontWeight: FontWeight.bold,\n                      color: theme.textTheme.titleLarge?.color,\n                    ),\n                  ),\n                ),\n              ],\n            ),\n            content: Container(\n              width: double.maxFinite,\n              height: 400.h,\n              child: SingleChildScrollView(\n                child: SelectableText(\n                  shareText,\n                  style: TextStyle(\n                    fontSize: 14.sp,\n                    height: 1.4,\n                    color: theme.textTheme.bodyMedium?.color,\n                  ),\n                ),\n              ),\n            ),\n            actions: [\n              TextButton(\n                onPressed: () => Navigator.of(context).pop(),\n                style: TextButton.styleFrom(foregroundColor: Colors.grey[600]),\n                child: Text('Ø¥ØºÙ„Ø§Ù‚'),\n              ),\n              ElevatedButton.icon(\n                onPressed: () {\n                  // Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ù„Ù„Ø­Ø§ÙØ¸Ø©\n                  Clipboard.setData(ClipboardData(text: shareText));\n                  Navigator.of(context).pop();\n                  Get.snackbar(\n                    'ØªÙ… Ø§Ù„Ù†Ø³Ø®',\n                    'ØªÙ… Ù†Ø³Ø® Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©',\n                    snackPosition: SnackPosition.BOTTOM,\n                    backgroundColor: Colors.green[600],\n                    colorText: Colors.white,\n                    icon: Icon(Icons.copy, color: Colors.white),\n                    margin: EdgeInsets.all(16.w),\n                    borderRadius: 12.r,\n                  );\n                },\n                icon: Icon(Icons.copy),\n                label: Text('Ù†Ø³Ø®'),\n                style: ElevatedButton.styleFrom(\n                  backgroundColor: theme.primaryColor,\n                  foregroundColor: Colors.white,\n                  shape: RoundedRectangleBorder(\n                    borderRadius: BorderRadius.circular(12.r),\n                  ),\n                ),\n              ),\n            ],\n          ),\n    );\n  }\n\n  // Ø¹Ø±Ø¶ Ø­ÙˆØ§Ø± ØªØ£ÙƒÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙØ¶Ù„Ø©\n  void _showClearAllDialog(\n    BuildContext context,\n    FavoriteController favoriteCtrl,\n  ) {\n    final theme = Theme.of(context);\n    showDialog(\n      context: context,\n      builder:\n          (context) => AlertDialog(\n            shape: RoundedRectangleBorder(\n              borderRadius: BorderRadius.circular(20.r),\n            ),\n            title: Row(\n              children: [\n                Icon(\n                  Icons.warning_amber_rounded,\n                  color: Colors.orange[600],\n                  size: 28.sp,\n                ),\n                SizedBox(width: 12.w),\n                Text(\n                  'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø³Ø­',\n                  style: TextStyle(\n                    fontSize: 18.sp,\n                    fontWeight: FontWeight.bold,\n                    color: theme.textTheme.titleLarge?.color,\n                  ),\n                ),\n              ],\n            ),\n            content: Column(\n              mainAxisSize: MainAxisSize.min,\n              crossAxisAlignment: CrossAxisAlignment.start,\n              children: [\n                Text(\n                  'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©ØŸ',\n                  style: TextStyle(\n                    fontSize: 16.sp,\n                    color: theme.textTheme.bodyMedium?.color,\n                    height: 1.4,\n                  ),\n                ),\n                SizedBox(height: 16.h),\n                Container(\n                  padding: EdgeInsets.all(12.w),\n                  decoration: BoxDecoration(\n                    color: Colors.red[50],\n                    borderRadius: BorderRadius.circular(12.r),\n                    border: Border.all(color: Colors.red[200]!),\n                  ),\n                  child: Row(\n                    children: [\n                      Icon(\n                        Icons.info_outline,\n                        color: Colors.red[600],\n                        size: 20.sp,\n                      ),\n                      SizedBox(width: 8.w),\n                      Expanded(\n                        child: Text(\n                          'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡',\n                          style: TextStyle(\n                            color: Colors.red[700],\n                            fontSize: 14.sp,\n                            fontWeight: FontWeight.w500,\n                          ),\n                        ),\n                      ),\n                    ],\n                  ),\n                ),\n              ],\n            ),\n            actions: [\n              // Ø²Ø± Ø§Ù„Ø¥Ù„ØºØ§Ø¡\n              TextButton(\n                onPressed: () => Navigator.of(context).pop(),\n                style: TextButton.styleFrom(\n                  foregroundColor: Colors.grey[600],\n                  padding: EdgeInsets.symmetric(\n                    horizontal: 20.w,\n                    vertical: 12.h,\n                  ),\n                  shape: RoundedRectangleBorder(\n                    borderRadius: BorderRadius.circular(12.r),\n                  ),\n                ),\n                child: Text(\n                  'Ø¥Ù„ØºØ§Ø¡',\n                  style: TextStyle(\n                    fontSize: 14.sp,\n                    fontWeight: FontWeight.w600,\n                  ),\n                ),\n              ),\n              // Ø²Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯\n              ElevatedButton(\n                onPressed: () {\n                  Navigator.of(context).pop();\n                  _clearAllFavorites(favoriteCtrl);\n                },\n                style: ElevatedButton.styleFrom(\n                  backgroundColor: Colors.red[600],\n                  foregroundColor: Colors.white,\n                  padding: EdgeInsets.symmetric(\n                    horizontal: 20.w,\n                    vertical: 12.h,\n                  ),\n                  shape: RoundedRectangleBorder(\n                    borderRadius: BorderRadius.circular(12.r),\n                  ),\n                  elevation: 2,\n                ),\n                child: Text(\n                  'Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„',\n                  style: TextStyle(\n                    fontSize: 14.sp,\n                    fontWeight: FontWeight.bold,\n                  ),\n                ),\n              ),\n            ],\n          ),\n    );\n  }\n\n  // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙØ¶Ù„Ø©\n  void _clearAllFavorites(FavoriteController favoriteCtrl) async {\n    try {\n      // Ø¹Ø±Ø¶ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„\n      Get.dialog(\n        Center(\n          child: Container(\n            padding: EdgeInsets.all(24.w),\n            decoration: BoxDecoration(\n              color: Colors.white,\n              borderRadius: BorderRadius.circular(16.r),\n              boxShadow: [\n                BoxShadow(\n                  color: Colors.black.withValues(alpha: 0.1),\n                  blurRadius: 10.r,\n                ),\n              ],\n            ),\n            child: Column(\n              mainAxisSize: MainAxisSize.min,\n              children: [\n                CircularProgressIndicator(),\n                SizedBox(height: 16.h),\n                Text(\n                  'Ø¬Ø§Ø±ÙŠ Ù…Ø³Ø­ Ø§Ù„Ù…ÙØ¶Ù„Ø©...',\n                  style: TextStyle(\n                    fontSize: 16.sp,\n                    fontWeight: FontWeight.w600,\n                  ),\n                ),\n              ],\n            ),\n          ),\n        ),\n        barrierDismissible: false,\n      );\n\n      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙØ¶Ù„Ø©\n      final favoritesStream = favoriteCtrl.getFavoritesStream();\n      final snapshot = await favoritesStream.first;\n      final favoriteIds = snapshot.docs.map((doc) => doc.id).toList();\n\n      // Ù…Ø³Ø­ ÙƒÙ„ Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©\n      for (String productId in favoriteIds) {\n        await favoriteCtrl.toggleFavorite(productId, true);\n      }\n\n      // Ø¥ØºÙ„Ø§Ù‚ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„\n      Get.back();\n\n      // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­\n      Get.snackbar(\n        'ØªÙ… Ø¨Ù†Ø¬Ø§Ø­',\n        'ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©',\n        snackPosition: SnackPosition.BOTTOM,\n        backgroundColor: Colors.green[600],\n        colorText: Colors.white,\n        icon: Icon(Icons.check_circle, color: Colors.white),\n        margin: EdgeInsets.all(16.w),\n        borderRadius: 12.r,\n        duration: const Duration(seconds: 3),\n      );\n    } catch (e) {\n      // Ø¥ØºÙ„Ø§Ù‚ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£\n      if (Get.isDialogOpen ?? false) Get.back();\n\n      // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£\n      Get.snackbar(\n        'Ø®Ø·Ø£',\n        'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø³Ø­ Ø§Ù„Ù…ÙØ¶Ù„Ø©: $e',\n        snackPosition: SnackPosition.BOTTOM,\n        backgroundColor: Colors.red[600],\n        colorText: Colors.white,\n        icon: Icon(Icons.error, color: Colors.white),\n        margin: EdgeInsets.all(16.w),\n        borderRadius: 12.r,\n        duration: const Duration(seconds: 4),\n      );\n    }\n  }\n\n  // Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø©\n  Widget _buildFavoritesStats(\n    BuildContext context,\n    int filteredCount,\n    int totalCount,\n  ) {\n    final theme = Theme.of(context);\n    return Container(\n      margin: EdgeInsets.symmetric(horizontal: 16.w, vertical: 8.h),\n      padding: EdgeInsets.symmetric(horizontal: 16.w, vertical: 12.h),\n      decoration: BoxDecoration(\n        gradient: LinearGradient(\n          colors: [\n            theme.primaryColor.withValues(alpha: 0.1),\n            theme.primaryColor.withValues(alpha: 0.05),\n          ],\n          begin: Alignment.topLeft,\n          end: Alignment.bottomRight,\n        ),\n        borderRadius: BorderRadius.circular(15.r),\n        border: Border.all(color: theme.primaryColor.withValues(alpha: 0.2)),\n        boxShadow: [\n          BoxShadow(\n            color: theme.primaryColor.withValues(alpha: 0.1),\n            blurRadius: 8.r,\n            offset: Offset(0, 2.h),\n          ),\n        ],\n      ),\n      child: Row(\n        children: [\n          Container(\n            padding: EdgeInsets.all(8.w),\n            decoration: BoxDecoration(\n              color: theme.primaryColor.withValues(alpha: 0.2),\n              borderRadius: BorderRadius.circular(10.r),\n            ),\n            child: Icon(\n              Icons.favorite_rounded,\n              color: theme.primaryColor,\n              size: 20.sp,\n            ),\n          ),\n          SizedBox(width: 12.w),\n          Expanded(\n            child: Column(\n              crossAxisAlignment: CrossAxisAlignment.start,\n              children: [\n                Text(\n                  'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø©: $totalCount Ù…Ù†ØªØ¬',\n                  style: TextStyle(\n                    color: theme.primaryColor,\n                    fontSize: 14.sp,\n                    fontWeight: FontWeight.w600,\n                  ),\n                ),\n                if (filteredCount != totalCount) ...[\n                  SizedBox(height: 2.h),\n                  Text(\n                    'Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©: $filteredCount Ù…Ù†ØªØ¬',\n                    style: TextStyle(\n                      color: theme.primaryColor.withValues(alpha: 0.7),\n                      fontSize: 12.sp,\n                      fontWeight: FontWeight.w500,\n                    ),\n                  ),\n                ],\n              ],\n            ),\n          ),\n          if (filteredCount != totalCount)\n            Container(\n              padding: EdgeInsets.symmetric(horizontal: 8.w, vertical: 4.h),\n              decoration: BoxDecoration(\n                color: theme.primaryColor,\n                borderRadius: BorderRadius.circular(12.r),\n              ),\n              child: Text(\n                'Ù…ÙÙÙ„ØªØ±',\n                style: TextStyle(\n                  color: Colors.white,\n                  fontSize: 10.sp,\n                  fontWeight: FontWeight.bold,\n                ),\n              ),\n            ),\n        ],\n      ),\n    );\n  }\n}\n"
        }
    ]
}