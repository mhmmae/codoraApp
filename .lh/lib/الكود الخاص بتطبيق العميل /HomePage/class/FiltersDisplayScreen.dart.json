{
    "sourceFile": "lib/الكود الخاص بتطبيق العميل /HomePage/class/FiltersDisplayScreen.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1753068346583,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1753068346583,
            "name": "Commit-0",
            "content": "import 'package:cached_network_image/cached_network_image.dart';\nimport 'package:flutter/material.dart';\nimport 'package:get/get.dart';\nimport 'package:shimmer/shimmer.dart';\nimport 'package:flutter_screenutil/flutter_screenutil.dart';\n\nimport '../controllers/filters_display_controller.dart';\nimport 'FilteredProductsScreen.dart';\n\n/// صفحة عرض جميع الفلاتر المتاحة بشكل مسطح\nclass FiltersDisplayScreen extends StatelessWidget {\n  const FiltersDisplayScreen({super.key});\n\n  @override\n  Widget build(BuildContext context) {\n    final controller = Get.put(FiltersDisplayController());\n    final theme = Theme.of(context);\n\n    return Scaffold(\n      backgroundColor: theme.scaffoldBackgroundColor,\n      appBar: AppBar(\n        title: const Text('جميع الفلاتر'),\n        backgroundColor: theme.appBarTheme.backgroundColor,\n        foregroundColor: theme.appBarTheme.foregroundColor,\n        elevation: 0,\n        actions: [\n          // زر إعادة التحميل\n          IconButton(\n            onPressed: () => controller.refreshFilters(),\n            icon: const Icon(Icons.refresh_rounded),\n            tooltip: 'إعادة تحميل',\n          ),\n        ],\n      ),\n      body: Obx(() {\n        if (controller.isLoading.value) {\n          return _buildLoadingGrid(context);\n        }\n\n        if (controller.allFilters.isEmpty) {\n          return _buildEmptyState(context, theme);\n        }\n\n        return RefreshIndicator(\n          onRefresh: () => controller.refreshFilters(),\n          child: Padding(\n            padding: EdgeInsets.symmetric(horizontal: 16.w, vertical: 8.h),\n            child: Column(\n              crossAxisAlignment: CrossAxisAlignment.start,\n              children: [\n                // عداد الفلاتر\n                Container(\n                  padding: EdgeInsets.symmetric(\n                    horizontal: 16.w,\n                    vertical: 12.h,\n                  ),\n                  margin: EdgeInsets.only(bottom: 16.h),\n                  decoration: BoxDecoration(\n                    color: theme.primaryColor.withOpacity(0.1),\n                    borderRadius: BorderRadius.circular(12.r),\n                    border: Border.all(\n                      color: theme.primaryColor.withOpacity(0.2),\n                      width: 1.w,\n                    ),\n                  ),\n                  child: Row(\n                    children: [\n                      Icon(\n                        Icons.tune_rounded,\n                        color: theme.primaryColor,\n                        size: 24.sp,\n                      ),\n                      SizedBox(width: 12.w),\n                      Text(\n                        'إجمالي الفلاتر المتاحة: ${controller.allFilters.length}',\n                        style: TextStyle(\n                          fontSize: 16.sp,\n                          fontWeight: FontWeight.w600,\n                          color: theme.primaryColor,\n                        ),\n                      ),\n                    ],\n                  ),\n                ),\n\n                // شبكة الفلاتر\n                Expanded(\n                  child: GridView.builder(\n                    gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(\n                      crossAxisCount: 2,\n                      childAspectRatio: 0.85,\n                      crossAxisSpacing: 12.w,\n                      mainAxisSpacing: 12.h,\n                    ),\n                    itemCount: controller.allFilters.length,\n                    itemBuilder: (context, index) {\n                      final filter = controller.allFilters[index];\n                      return _buildFilterCard(context, filter, theme);\n                    },\n                  ),\n                ),\n              ],\n            ),\n          ),\n        );\n      }),\n    );\n  }\n\n  /// بناء بطاقة الفلتر\n  Widget _buildFilterCard(\n    BuildContext context,\n    FilterItemModel filter,\n    ThemeData theme,\n  ) {\n    return Card(\n      elevation: 3,\n      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(16.r)),\n      clipBehavior: Clip.antiAlias,\n      child: InkWell(\n        onTap: () => _navigateToFilteredProducts(filter),\n        borderRadius: BorderRadius.circular(16.r),\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.stretch,\n          children: [\n            // منطقة الصورة\n            Expanded(\n              flex: 3,\n              child: Stack(\n                fit: StackFit.expand,\n                children: [\n                  // الصورة\n                  _buildFilterImage(filter),\n\n                  // شريط نوع الفلتر\n                  Positioned(\n                    top: 8.h,\n                    right: 8.w,\n                    child: Container(\n                      padding: EdgeInsets.symmetric(\n                        horizontal: 8.w,\n                        vertical: 4.h,\n                      ),\n                      decoration: BoxDecoration(\n                        color: filter.type.color.withOpacity(0.9),\n                        borderRadius: BorderRadius.circular(8.r),\n                        boxShadow: [\n                          BoxShadow(\n                            color: Colors.black.withOpacity(0.2),\n                            blurRadius: 4.r,\n                            offset: Offset(0, 2.h),\n                          ),\n                        ],\n                      ),\n                      child: Row(\n                        mainAxisSize: MainAxisSize.min,\n                        children: [\n                          Icon(\n                            filter.type.icon,\n                            color: Colors.white,\n                            size: 14.sp,\n                          ),\n                          SizedBox(width: 4.w),\n                          Text(\n                            filter.type.displayName,\n                            style: TextStyle(\n                              color: Colors.white,\n                              fontSize: 10.sp,\n                              fontWeight: FontWeight.bold,\n                            ),\n                          ),\n                        ],\n                      ),\n                    ),\n                  ),\n                ],\n              ),\n            ),\n\n            // منطقة النص\n            Expanded(\n              flex: 2,\n              child: Padding(\n                padding: EdgeInsets.all(12.w),\n                child: Column(\n                  crossAxisAlignment: CrossAxisAlignment.start,\n                  mainAxisAlignment: MainAxisAlignment.center,\n                  children: [\n                    // العنوان الرئيسي\n                    Text(\n                      filter.title,\n                      style: TextStyle(\n                        fontSize: 14.sp,\n                        fontWeight: FontWeight.bold,\n                        color: theme.textTheme.titleMedium?.color,\n                      ),\n                      maxLines: 1,\n                      overflow: TextOverflow.ellipsis,\n                    ),\n                    SizedBox(height: 4.h),\n\n                    // العنوان الفرعي\n                    Text(\n                      filter.subtitle,\n                      style: TextStyle(\n                        fontSize: 12.sp,\n                        color: theme.textTheme.bodySmall?.color?.withOpacity(\n                          0.7,\n                        ),\n                        fontWeight: FontWeight.w500,\n                      ),\n                      maxLines: 1,\n                      overflow: TextOverflow.ellipsis,\n                    ),\n\n                    // اسم الوالد إن وجد\n                    if (filter.parentName != null) ...[\n                      SizedBox(height: 2.h),\n                      Text(\n                        filter.parentName!,\n                        style: TextStyle(\n                          fontSize: 10.sp,\n                          color: filter.type.color,\n                          fontWeight: FontWeight.w600,\n                        ),\n                        maxLines: 1,\n                        overflow: TextOverflow.ellipsis,\n                      ),\n                    ],\n                  ],\n                ),\n              ),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n\n  /// بناء صورة الفلتر\n  Widget _buildFilterImage(FilterItemModel filter) {\n    return filter.imageUrl != null && filter.imageUrl!.isNotEmpty\n        ? CachedNetworkImage(\n          imageUrl: filter.imageUrl!,\n          fit: BoxFit.cover,\n          placeholder: (context, url) => _buildImagePlaceholder(filter),\n          errorWidget: (context, url, error) => _buildImagePlaceholder(filter),\n        )\n        : _buildImagePlaceholder(filter);\n  }\n\n  /// بناء placeholder للصورة\n  Widget _buildImagePlaceholder(FilterItemModel filter) {\n    return Container(\n      decoration: BoxDecoration(\n        gradient: LinearGradient(\n          colors: [\n            filter.type.color.withOpacity(0.2),\n            filter.type.color.withOpacity(0.1),\n          ],\n          begin: Alignment.topLeft,\n          end: Alignment.bottomRight,\n        ),\n      ),\n      child: Center(\n        child: Icon(\n          filter.type.icon,\n          size: 48.sp,\n          color: filter.type.color.withOpacity(0.6),\n        ),\n      ),\n    );\n  }\n\n  /// الانتقال إلى صفحة المنتجات المفلترة\n  void _navigateToFilteredProducts(FilterItemModel filter) {\n    Get.to(\n      () => FilteredProductsScreen(\n        filterKey: filter.filterKey,\n        filterTitle: filter.title,\n        filterSubtitle: filter.subtitle,\n        filterType: filter.type,\n      ),\n      transition: Transition.rightToLeft,\n      duration: const Duration(milliseconds: 300),\n    );\n  }\n\n  /// بناء شبكة التحميل\n  Widget _buildLoadingGrid(BuildContext context) {\n    return Padding(\n      padding: EdgeInsets.symmetric(horizontal: 16.w, vertical: 8.h),\n      child: Column(\n        children: [\n          // placeholder للعداد\n          Container(\n            height: 48.h,\n            margin: EdgeInsets.only(bottom: 16.h),\n            decoration: BoxDecoration(\n              color: Colors.grey[200],\n              borderRadius: BorderRadius.circular(12.r),\n            ),\n          ),\n\n          // شبكة placeholder\n          Expanded(\n            child: Shimmer.fromColors(\n              baseColor: Colors.grey[300]!,\n              highlightColor: Colors.grey[100]!,\n              child: GridView.builder(\n                gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(\n                  crossAxisCount: 2,\n                  childAspectRatio: 0.85,\n                  crossAxisSpacing: 12.w,\n                  mainAxisSpacing: 12.h,\n                ),\n                itemCount: 8,\n                itemBuilder: (context, index) => _buildLoadingCard(),\n              ),\n            ),\n          ),\n        ],\n      ),\n    );\n  }\n\n  /// بناء بطاقة تحميل\n  Widget _buildLoadingCard() {\n    return Card(\n      elevation: 3,\n      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(16.r)),\n      child: Column(\n        children: [\n          Expanded(\n            flex: 3,\n            child: Container(\n              decoration: BoxDecoration(\n                color: Colors.white,\n                borderRadius: BorderRadius.vertical(top: Radius.circular(16.r)),\n              ),\n            ),\n          ),\n          Expanded(\n            flex: 2,\n            child: Padding(\n              padding: EdgeInsets.all(12.w),\n              child: Column(\n                crossAxisAlignment: CrossAxisAlignment.start,\n                children: [\n                  Container(height: 16.h, color: Colors.white),\n                  SizedBox(height: 8.h),\n                  Container(height: 12.h, width: 100.w, color: Colors.white),\n                ],\n              ),\n            ),\n          ),\n        ],\n      ),\n    );\n  }\n\n  /// بناء حالة فارغة\n  Widget _buildEmptyState(BuildContext context, ThemeData theme) {\n    return Center(\n      child: Padding(\n        padding: EdgeInsets.all(32.w),\n        child: Column(\n          mainAxisAlignment: MainAxisAlignment.center,\n          children: [\n            Icon(\n              Icons.filter_alt_off_outlined,\n              size: 80.sp,\n              color: Colors.grey[400],\n            ),\n            SizedBox(height: 24.h),\n            Text(\n              'لا توجد فلاتر متاحة',\n              style: TextStyle(\n                fontSize: 20.sp,\n                fontWeight: FontWeight.bold,\n                color: Colors.grey[600],\n              ),\n            ),\n            SizedBox(height: 12.h),\n            Text(\n              'تأكد من وجود أقسام وشركات مفعلة في النظام',\n              style: TextStyle(fontSize: 16.sp, color: Colors.grey[500]),\n              textAlign: TextAlign.center,\n            ),\n            SizedBox(height: 32.h),\n            ElevatedButton.icon(\n              onPressed:\n                  () => Get.find<FiltersDisplayController>().refreshFilters(),\n              icon: const Icon(Icons.refresh_rounded),\n              label: const Text('إعادة المحاولة'),\n              style: ElevatedButton.styleFrom(\n                backgroundColor: theme.primaryColor,\n                foregroundColor: Colors.white,\n                padding: EdgeInsets.symmetric(horizontal: 24.w, vertical: 12.h),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(12.r),\n                ),\n              ),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n"
        }
    ]
}