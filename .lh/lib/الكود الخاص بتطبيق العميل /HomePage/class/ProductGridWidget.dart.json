{
    "sourceFile": "lib/Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…ÙŠÙ„ /HomePage/class/ProductGridWidget.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1753065306912,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1753093449449,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -145,30 +145,25 @@\n         debugPrint(\"ğŸ¯ ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©\");\n         query = query.where('itemCondition', isEqualTo: 'original');\n       } else if (currentFilterKey.startsWith('main_') ||\n           currentFilterKey.startsWith('sub_')) {\n-        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø­Ø³Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯\n+        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø­Ø³Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ - Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ù…ÙØ§ØªÙŠØ­\n         try {\n-          final filterController = Get.find<EnhancedCategoryFilterController>();\n-\n-          // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„ÙƒÙˆÙ†ØªØ±ÙˆÙ„Ø±\n-          final mainCategoryId = filterController.selectedMainCategoryId.value;\n-          final subCategoryId = filterController.selectedSubCategoryId.value;\n-\n           debugPrint(\"ğŸ¯ ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø³Ù†:\");\n-          debugPrint(\"   - Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: '$mainCategoryId'\");\n-          debugPrint(\"   - Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ: '$subCategoryId'\");\n           debugPrint(\"   - Ù…ÙØªØ§Ø­ Ø§Ù„ÙÙ„ØªØ±: '$currentFilterKey'\");\n \n-          // ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ Ø£ÙˆÙ„Ø§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ ÙˆØºÙŠØ± ÙØ§Ø±Øº\n-          if (subCategoryId.isNotEmpty && subCategoryId != 'all') {\n+          if (currentFilterKey.startsWith('sub_')) {\n+            // ÙÙ„ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ\n+            final subCategoryId = currentFilterKey.replaceFirst('sub_', '');\n+            debugPrint(\"   - Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ: '$subCategoryId'\");\n             query = query.where('subCategoryId', isEqualTo: subCategoryId);\n             debugPrint(\"âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ: '$subCategoryId'\");\n-          } else if (mainCategoryId.isNotEmpty && mainCategoryId != 'all') {\n+          } else if (currentFilterKey.startsWith('main_')) {\n+            // ÙÙ„ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ\n+            final mainCategoryId = currentFilterKey.replaceFirst('main_', '');\n+            debugPrint(\"   - Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: '$mainCategoryId'\");\n             query = query.where('mainCategoryId', isEqualTo: mainCategoryId);\n             debugPrint(\"âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: '$mainCategoryId'\");\n-          } else {\n-            debugPrint(\"âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø±ÙØ§Øª Ø£Ù‚Ø³Ø§Ù… ØµØ§Ù„Ø­Ø© Ù„Ù„ÙÙ„ØªØ±Ø©\");\n           }\n         } catch (e) {\n           debugPrint(\"âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø­Ø³Ù†: $e\");\n         }\n@@ -557,10 +552,11 @@\n   }\n \n   // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ÙˆÙ† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©\n   Color _getQualityColor(int? grade) {\n-    if (grade == null)\n+    if (grade == null) {\n       return Colors.grey.shade400; // Ù„ÙˆÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¥Ø°Ø§ Ù„Ù… ØªØªÙˆÙØ± Ø§Ù„Ø¯Ø±Ø¬Ø©\n+    }\n     if (grade >= 1 && grade <= 4) {\n       return Colors.green.shade600; // Ø£Ø®Ø¶Ø± Ù„Ù„Ø¯Ø±Ø¬Ø§Øª 1-4\n     } else if (grade >= 5 && grade <= 7) {\n       return Colors.amber.shade700; // Ø£ØµÙØ±/Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ù„Ù„Ø¯Ø±Ø¬Ø§Øª 5-7\n@@ -1029,10 +1025,11 @@\n           Get.to(() => DetailsOfItemScreen(item: item));\n         },\n         // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· (Ù„Ø£Ø³ÙÙ„ Ø£Ùˆ Ù…Ø·ÙˆÙ„Ø§Ù‹) Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ù…Ù†\n         onTapDown: (details) {\n-          if (_isAdmin)\n+          if (_isAdmin) {\n             _showAdminContextMenu(context, details, item, controller);\n+          }\n         },\n         onLongPress: () {\n           if (_isAdmin) {\n             final center = Offset(wi / 2, hi / 2);\n@@ -1361,9 +1358,9 @@\n     String formattedInteger = '';\n     for (int i = integerPart.length - 1; i >= 0; i--) {\n       formattedInteger = integerPart[i] + formattedInteger;\n       if ((integerPart.length - i) % 3 == 0 && i != 0) {\n-        formattedInteger = ',' + formattedInteger;\n+        formattedInteger = ',$formattedInteger';\n       }\n     }\n \n     return formattedInteger + decimalPart;\n"
                },
                {
                    "date": 1753149650100,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -350,9 +350,9 @@\n           mainAxisSize: MainAxisSize.min, // Ù„ØªØ¬Ù†Ø¨ Ø£Ø®Ø° Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© ÙƒØ§Ù…Ù„Ø©\n           children: [\n             Text(\"Ù…Ù†ØªØ¬: ${item.name}\", style: const TextStyle(fontSize: 16)),\n             const SizedBox(height: 5),\n-            Text(\"Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ: $oldPrice ${FirebaseX.currency}\"),\n+            Text(\"Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ: $oldPrice Ø¯.Ø¹.\"),\n             const Divider(height: 20),\n \n             // --- Ø­Ù‚Ù„ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¹Ø±Ø¶ (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ) ---\n             TextFormField(\n"
                },
                {
                    "date": 1753157006813,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -318,9 +318,9 @@\n   void _showAddOfferDialog(BuildContext context, ItemModel item) {\n     // Ù…ØªØ­ÙƒÙ…Ø§Øª Ù…Ø­Ù„ÙŠØ© Ù„Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©\n     final TextEditingController offerPriceController = TextEditingController();\n     // Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙŠÙ…ÙƒÙ† Ø£Ø®Ø°Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬\n-    final double oldPrice = item.price;\n+    final double oldPrice = item.suggestedRetailPrice ?? item.price;\n     final TextEditingController rateController =\n         TextEditingController(); // Ø§Ø®ØªÙŠØ§Ø±ÙŠ\n     final Rxn<DateTime> expiryDate = Rxn<DateTime>(\n       null,\n@@ -1231,9 +1231,11 @@\n                     // Ø§Ù„Ø³Ø¹Ø± ÙˆØ£Ø²Ø±Ø§Ø± +/-\n                     // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø© (price ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† int)\n                     BoxAddAndRemove(\n                       uidItem: item.id,\n-                      price: item.price, // <-- ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø³Ø¹Ø± (int)\n+                      price:\n+                          item.suggestedRetailPrice ??\n+                          item.price, // <-- Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ù‚ØªØ±Ø­ Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¹Ø§Ø¯ÙŠ\n                       name: item.name, // <-- ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø§Ø³Ù…\n                       isOffer: false,\n                       uidAdd: item.uidAdd, // Ù„ÙŠØ³ Ø¹Ø±Ø¶Ù‹Ø§ Ù‡Ù†Ø§\n                     ),\n@@ -1255,9 +1257,12 @@\n     required bool isEditingName,\n   }) {\n     // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ØªØ­ÙƒÙ… Ø§Ù„Ù†ØµÙŠ Ø¨Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©\n     final editController = TextEditingController(\n-      text: isEditingName ? item.name : item.price.toString(),\n+      text:\n+          isEditingName\n+              ? item.name\n+              : (item.suggestedRetailPrice ?? item.price).toString(),\n     );\n     final String title =\n         isEditingName ? \"ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬\" : \"ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬\";\n     final String label = isEditingName ? \"Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯\" : \"Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯\";\n"
                }
            ],
            "date": 1753065306912,
            "name": "Commit-0",
            "content": "import 'package:cached_network_image/cached_network_image.dart';\nimport 'package:cloud_firestore/cloud_firestore.dart';\nimport 'package:firebase_auth/firebase_auth.dart';\nimport 'package:flutter/material.dart';\nimport 'package:flutter/services.dart';\nimport 'package:get/get.dart';\nimport 'package:intl/intl.dart';\nimport 'package:shimmer/shimmer.dart';\nimport 'package:uuid/uuid.dart';\n\nimport '../../../Model/model_item.dart';\nimport '../../../Model/model_offer_item.dart';\nimport '../../../XXX/xxx_firebase.dart';\nimport '../Get-Controllar/GetSerchController.dart';\nimport '../Get-Controllar/GetStreamBuildBoxOfItem.dart';\nimport '../controllers/barcode_filter_controller.dart';\nimport '../controllers/brand_filter_controller.dart';\nimport '../controllers/enhanced_category_filter_controller.dart';\nimport 'BoxAddAndRemove.dart';\nimport 'DetailsOfItemScreen.dart';\nimport 'FavoriteController.dart';\n\nclass ProductGridWidgetOption extends StatefulWidget {\n  final String? selectedSubtypeKey;\n  final SortOption? sortOption; // <-- Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„ØªØ±ØªÙŠØ¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)\n\n  // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù€ Constructor Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„ØªØ±ØªÙŠØ¨\n  const ProductGridWidgetOption({\n    super.key,\n    this.selectedSubtypeKey,\n    this.sortOption, // Ø§Ø¬Ø¹Ù„Ù‡ Ø§Ø®ØªÙŠØ§Ø±ÙŠÙ‹Ø§ Ø£Ùˆ Ø§Ù‚Ø±Ø£Ù‡ Ù…Ù† Ø§Ù„Ù…ØªØ­ÙƒÙ… Ø¯Ø§Ø®Ù„ÙŠÙ‹Ø§\n  });\n\n  @override\n  State<ProductGridWidgetOption> createState() =>\n      _ProductGridWidgetOptionState();\n}\n\nclass _ProductGridWidgetOptionState extends State<ProductGridWidgetOption> {\n  final String allItemsFilterKey = 'all_items';\n  final bool _isAdmin =\n      FirebaseAuth.instance.currentUser?.email == FirebaseX.EmailOfWnerApp;\n\n  // --- Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù€ Stream Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ± ÙˆØ§Ù„ØªØ±ØªÙŠØ¨ ---\n  Stream<QuerySnapshot<Map<String, dynamic>>> _buildProductStream() {\n    return _buildProductStreamWithRetry();\n  }\n\n  // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù…Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ÙÙŠ Ø­Ø§Ù„Ø© Ø®Ø·Ø£ Ø§Ù„ÙÙ‡Ø±Ø³\n  Stream<QuerySnapshot<Map<String, dynamic>>> _buildProductStreamWithRetry({\n    bool skipSort = false,\n  }) {\n    // ---!!! 1. Ù‚Ø±Ø§Ø¡Ø© Ø®ÙŠØ§Ø± Ø§Ù„ØªØ±ØªÙŠØ¨ ÙˆØ§Ù„ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ† !!!---\n    // Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ­ÙƒÙ…Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Get.find\n    final searchController = Get.find<GetSearchController>();\n    final brandController = Get.put(BrandFilterController());\n\n    // ØªØ¬Ø±Ø¨Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø£ÙˆÙ„Ø§Ù‹ØŒ ÙˆÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯Ù‡ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…\n    String currentFilterKey = allItemsFilterKey;\n\n    try {\n      final filterController = Get.find<EnhancedCategoryFilterController>();\n      currentFilterKey = filterController.getFilterKey();\n      debugPrint(\"ğŸ” Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„ÙÙ„Ø§ØªØ±: $currentFilterKey\");\n    } catch (e) {\n      debugPrint(\"ğŸ” Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ ØºÙŠØ± Ù…ØªØ§Ø­ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¨Ø³Ø·\");\n      try {\n        final categoryFilterController =\n            Get.find<EnhancedCategoryFilterController>();\n        currentFilterKey = categoryFilterController.getFilterKey();\n        debugPrint(\"ğŸ” Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙ„ØªØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¨Ø³Ø·: $currentFilterKey\");\n      } catch (e2) {\n        debugPrint(\"ğŸ” Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¨Ø³Ø· Ø£ÙŠØ¶Ø§Ù‹ ØºÙŠØ± Ù…ØªØ§Ø­ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ\");\n      }\n    }\n\n    final currentSortOption = searchController.currentSortOption.value;\n\n    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ù… Ø¨Ø±Ø§Ù†Ø¯ Ø£Ù… ÙØ¦Ø§Øª Ø¹Ø§Ø¯ÙŠØ©)\n    final barcodeController = Get.put(BarcodeFilterController());\n\n    if (barcodeController.hasActiveFilter) {\n      currentFilterKey = barcodeController.getFilterKey();\n    } else if (brandController.isBrandModeActive.value) {\n      currentFilterKey = brandController.getFilterKey();\n    } else {\n      currentFilterKey = widget.selectedSubtypeKey ?? currentFilterKey;\n    }\n\n    debugPrint(\n      \"ğŸ” [ProductGridWidget _buildProductStream] Applying Sort: ${currentSortOption.label}, Filter: $currentFilterKey\",\n    );\n    debugPrint(\"ğŸ” ÙÙ„ØªØ± Ø§Ù„Ù†ÙˆØ¹: $currentFilterKey\");\n    debugPrint(\n      \"ğŸ” Ù†ÙˆØ¹ Ø§Ù„Ù†Ø¸Ø§Ù…: ${currentFilterKey.contains('_') && currentFilterKey != 'all_items' ? 'Ù†Ø¸Ø§Ù… Ø¬Ø¯ÙŠØ¯ (ID-based)' : 'Ù†Ø¸Ø§Ù… Ù‚Ø¯ÙŠÙ… (typeItem)'}\",\n    );\n    debugPrint(\"ğŸ” appName: ${FirebaseX.appName}\");\n    debugPrint(\"ğŸ” itemsCollection: ${FirebaseX.itemsCollection}\");\n    if (currentFilterKey.contains('_') && currentFilterKey != 'all_items') {\n      final parts = currentFilterKey.split('_');\n      debugPrint(\"ğŸ” Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„ÙÙ„ØªØ±: ${parts.join(' | ')}\");\n    }\n\n    // ---!!! 2. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ±Ø© !!!---\n    Query<Map<String, dynamic>> query = FirebaseFirestore.instance\n        .collection(FirebaseX.itemsCollection)\n        .where('appName', isEqualTo: FirebaseX.appName);\n\n    // ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ù†ÙˆØ¹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø­Ø¯Ø¯Ù‹Ø§\n    // Ø¯Ø¹Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ… (typeItem) ÙˆØ§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ (mainCategoryId/subCategoryId) ÙˆÙ†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯ ÙˆÙ†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯\n    debugPrint(\n      \"ğŸ” Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ÙÙ„Ø§ØªØ±: currentFilterKey='$currentFilterKey' vs allItemsFilterKey='$allItemsFilterKey'\",\n    );\n    if (currentFilterKey != allItemsFilterKey) {\n      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„ÙÙ„ØªØ±\n      if (currentFilterKey.startsWith('barcode_')) {\n        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯\n        final barcodeValue = currentFilterKey.replaceFirst('barcode_', '');\n        debugPrint(\"ğŸ¯ ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: productBarcode=$barcodeValue\");\n        query = query.where('productBarcode', isEqualTo: barcodeValue);\n      } else if (currentFilterKey.startsWith('original_product_')) {\n        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ù…Ù†ØªØ¬ Ø£ØµÙ„ÙŠ Ù…Ø­Ø¯Ø¯\n        final productId = currentFilterKey.replaceFirst(\n          'original_product_',\n          '',\n        );\n        debugPrint(\"ğŸ¯ ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø£ØµÙ„ÙŠ: originalProductId=$productId\");\n        query = query\n            .where('itemCondition', isEqualTo: 'original')\n            .where('originalProductId', isEqualTo: productId);\n      } else if (currentFilterKey.startsWith('original_company_')) {\n        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø´Ø±ÙƒØ© Ø£ØµÙ„ÙŠØ© Ù…Ø­Ø¯Ø¯Ø©\n        final companyId = currentFilterKey.replaceFirst(\n          'original_company_',\n          '',\n        );\n        debugPrint(\n          \"ğŸ¯ ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ø£ØµÙ„ÙŠØ©: originalCompanyId=$companyId\",\n        );\n        query = query\n            .where('itemCondition', isEqualTo: 'original')\n            .where('originalCompanyId', isEqualTo: companyId);\n      } else if (currentFilterKey == 'original_brands') {\n        // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©\n        debugPrint(\"ğŸ¯ ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©\");\n        query = query.where('itemCondition', isEqualTo: 'original');\n      } else if (currentFilterKey.startsWith('main_') ||\n          currentFilterKey.startsWith('sub_')) {\n        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø­Ø³Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯\n        try {\n          final filterController = Get.find<EnhancedCategoryFilterController>();\n\n          // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„ÙƒÙˆÙ†ØªØ±ÙˆÙ„Ø±\n          final mainCategoryId = filterController.selectedMainCategoryId.value;\n          final subCategoryId = filterController.selectedSubCategoryId.value;\n\n          debugPrint(\"ğŸ¯ ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø³Ù†:\");\n          debugPrint(\"   - Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: '$mainCategoryId'\");\n          debugPrint(\"   - Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ: '$subCategoryId'\");\n          debugPrint(\"   - Ù…ÙØªØ§Ø­ Ø§Ù„ÙÙ„ØªØ±: '$currentFilterKey'\");\n\n          // ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ Ø£ÙˆÙ„Ø§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ ÙˆØºÙŠØ± ÙØ§Ø±Øº\n          if (subCategoryId.isNotEmpty && subCategoryId != 'all') {\n            query = query.where('subCategoryId', isEqualTo: subCategoryId);\n            debugPrint(\"âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ: '$subCategoryId'\");\n          } else if (mainCategoryId.isNotEmpty && mainCategoryId != 'all') {\n            query = query.where('mainCategoryId', isEqualTo: mainCategoryId);\n            debugPrint(\"âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: '$mainCategoryId'\");\n          } else {\n            debugPrint(\"âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø±ÙØ§Øª Ø£Ù‚Ø³Ø§Ù… ØµØ§Ù„Ø­Ø© Ù„Ù„ÙÙ„ØªØ±Ø©\");\n          }\n        } catch (e) {\n          debugPrint(\"âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø­Ø³Ù†: $e\");\n        }\n      } else {\n        // Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…: typeItem\n        debugPrint(\"ğŸ¯ ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…: typeItem=$currentFilterKey\");\n        query = query.where('typeItem', isEqualTo: currentFilterKey);\n      }\n    } else {\n      debugPrint(\"ğŸ¯ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙ„Ø§ØªØ± Ù…Ø­Ø¯Ø¯Ø© - Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª\");\n    }\n\n    // ---!!! 3. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ !!!---\n    if (!skipSort) {\n      // ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø¹Ù‚Ø¯ Ø¹Ù†Ø¯Ù…Ø§ Ù†Ø·Ø¨Ù‚ ÙÙ„Ø§ØªØ± Ø£Ù‚Ø³Ø§Ù… Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ÙÙ‡Ø§Ø±Ø³\n      bool hasSpecificCategoryFilter =\n          currentFilterKey.startsWith('main_') ||\n          currentFilterKey.startsWith('sub_') ||\n          currentFilterKey.startsWith('barcode_') ||\n          currentFilterKey.startsWith('original_');\n\n      if (!hasSpecificCategoryFilter && currentFilterKey == allItemsFilterKey) {\n        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±ØªÙŠØ¨ ÙÙ‚Ø· Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©\n        debugPrint(\n          \"--> ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±ØªÙŠØ¨: ${currentSortOption.field}, descending: ${currentSortOption.descending}\",\n        );\n        try {\n          query = query.orderBy(\n            currentSortOption.field,\n            descending: currentSortOption.descending,\n          );\n          debugPrint(\"âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¨Ù†Ø¬Ø§Ø­\");\n        } catch (e) {\n          debugPrint(\"âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±ØªÙŠØ¨: $e\");\n        }\n      } else {\n        debugPrint(\"--> ØªØ®Ø·ÙŠ Ø§Ù„ØªØ±ØªÙŠØ¨ Ù„Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ÙÙ‡Ø§Ø±Ø³\");\n      }\n    } else {\n      debugPrint(\"--> ØªØ®Ø·ÙŠ Ø§Ù„ØªØ±ØªÙŠØ¨ ØªÙ…Ø§Ù…Ø§Ù‹ (Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø©)\");\n    }\n\n    // ØªØ·Ø¨ÙŠÙ‚ limit ÙˆØ¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù€ Stream\n    final finalQuery = query.limit(50);\n    debugPrint(\"ğŸ” Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙ†ÙÙŠØ° Ù…Ø¹ Ø­Ø¯ Ø£Ù‚ØµÙ‰ 50 Ù…Ù†ØªØ¬\");\n    debugPrint(\"ğŸ“Š Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©:\");\n    debugPrint(\n      \"   - Ø§Ù„ØªØ±ØªÙŠØ¨: ${currentSortOption.field} (${currentSortOption.descending ? 'ØªÙ†Ø§Ø²Ù„ÙŠ' : 'ØªØµØ§Ø¹Ø¯ÙŠ'})\",\n    );\n    debugPrint(\"   - Ø§Ù„ÙÙ„ØªØ±: $currentFilterKey\");\n    debugPrint(\"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\");\n\n    return finalQuery.snapshots();\n  }\n\n  // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ù‚ Ù„Ù„Ø£Ø¯Ù…Ù† (Ù…Ø«Ø§Ù„ Ù…Ø¨Ø³Ø·)\n  // --- 1. Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ù‚ Ù„Ù„Ø£Ø¯Ù…Ù† ---\n  Future<void> _showAdminContextMenu(\n    BuildContext context,\n    TapDownDetails details,\n    ItemModel item,\n    GetStreamBuildBoxOfItemController controller,\n  ) async {\n    if (!_isAdmin) return;\n\n    final RenderBox overlay =\n        Overlay.of(context).context.findRenderObject() as RenderBox;\n    final RelativeRect position = RelativeRect.fromRect(\n      details.globalPosition & const Size(40, 40), // Ù…Ù†Ø·Ù‚Ø© ØµØºÙŠØ±Ø© Ø­ÙˆÙ„ Ù†Ù‚Ø·Ø© Ø§Ù„Ù†Ù‚Ø±\n      Offset.zero & overlay.size,\n    );\n\n    final String? selectedValue = await showMenu<String>(\n      context: context,\n      position: position,\n      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(10.0)),\n      elevation: 8.0,\n      items: <PopupMenuEntry<String>>[\n        PopupMenuItem<String>(\n          value: 'edit_name',\n          child: const ListTile(\n            leading: Icon(Icons.edit_outlined, size: 20),\n            title: Text('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…'),\n            dense: true,\n            contentPadding: EdgeInsets.zero, // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ\n          ),\n        ),\n        PopupMenuItem<String>(\n          value: 'edit_price',\n          child: const ListTile(\n            leading: Icon(Icons.price_change_outlined, size: 20),\n            title: Text('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø±'),\n            dense: true,\n            contentPadding: EdgeInsets.zero,\n          ),\n        ),\n        PopupMenuItem<String>(\n          value: 'add_as_offer',\n          child: ListTile(\n            leading: Icon(Icons.local_offer_outlined, color: Colors.blue[700]),\n            title: Text(\n              'Ø¥Ø¶Ø§ÙØ© ÙƒØ¹Ø±Ø¶',\n              style: TextStyle(color: Colors.blue[700]),\n            ), // <<-- ØªØ¹Ø±ÙŠØ¨\n            dense: true,\n            contentPadding: EdgeInsets.zero,\n          ),\n        ),\n        const PopupMenuDivider(),\n        PopupMenuItem<String>(\n          value: 'delete',\n          child: ListTile(\n            leading: Icon(\n              Icons.delete_outline,\n              color: Colors.red[700],\n              size: 20,\n            ),\n            title: Text('Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬', style: TextStyle(color: Colors.red[700])),\n            dense: true,\n            contentPadding: EdgeInsets.zero,\n          ),\n        ),\n      ],\n    );\n\n    // ---!!! Ù‡Ù†Ø§ ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¯Ù…Ù† !!!---\n    switch (selectedValue) {\n      case 'edit_name':\n        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ù…Ø±Ø¨Ø¹ Ø­ÙˆØ§Ø± ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…\n        _showEditDialog(context, controller, item, isEditingName: true);\n        break;\n      case 'edit_price':\n        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ù…Ø±Ø¨Ø¹ Ø­ÙˆØ§Ø± ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø±\n        _showEditDialog(context, controller, item, isEditingName: false);\n        break;\n      case 'add_as_offer':\n        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ù…Ø±Ø¨Ø¹ Ø­ÙˆØ§Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø±Ø¶\n        _showAddOfferDialog(context, item);\n        break;\n      case 'delete':\n        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ù…Ø±Ø¨Ø¹ Ø­ÙˆØ§Ø± ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù\n        _showDeleteConfirmationDialog(context, item.id);\n        break;\n      default:\n        debugPrint(\"Admin context menu dismissed.\");\n        break;\n    }\n    // ---------------------------------------------------------\n  }\n\n  // ---!!! (Ø¬Ø¯ÙŠØ¯) Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ù…Ø±Ø¨Ø¹ Ø­ÙˆØ§Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø±Ø¶ !!!---\n  void _showAddOfferDialog(BuildContext context, ItemModel item) {\n    // Ù…ØªØ­ÙƒÙ…Ø§Øª Ù…Ø­Ù„ÙŠØ© Ù„Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©\n    final TextEditingController offerPriceController = TextEditingController();\n    // Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙŠÙ…ÙƒÙ† Ø£Ø®Ø°Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬\n    final double oldPrice = item.price;\n    final TextEditingController rateController =\n        TextEditingController(); // Ø§Ø®ØªÙŠØ§Ø±ÙŠ\n    final Rxn<DateTime> expiryDate = Rxn<DateTime>(\n      null,\n    ); // Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (ØªÙØ§Ø¹Ù„ÙŠ)\n\n    // Ù„Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹\n    void calculateRate() {\n      final int? newPrice = int.tryParse(offerPriceController.text.trim());\n      if (newPrice != null && oldPrice > 0 && newPrice < oldPrice) {\n        final double discount = ((oldPrice - newPrice) / oldPrice) * 100;\n        rateController.text = discount.toStringAsFixed(0); // Ù†Ø³Ø¨Ø© ØµØ­ÙŠØ­Ø©\n      } else {\n        rateController.text = ''; // Ù…Ø³Ø­ Ø§Ù„Ù†Ø³Ø¨Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø¹Ø± ØºÙŠØ± ØµØ§Ù„Ø­\n      }\n    }\n\n    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø³Ø¨Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ø¹Ø±\n    offerPriceController.addListener(calculateRate);\n\n    Get.defaultDialog(\n      title: \"Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ ÙƒØ¹Ø±Ø¶\",\n      titleStyle: const TextStyle(fontWeight: FontWeight.bold),\n      contentPadding: const EdgeInsets.symmetric(horizontal: 20, vertical: 10),\n      // Ø¬Ø¹Ù„ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø­ÙˆØ§Ø± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ…Ø±ÙŠØ±\n      content: SingleChildScrollView(\n        child: Column(\n          mainAxisSize: MainAxisSize.min, // Ù„ØªØ¬Ù†Ø¨ Ø£Ø®Ø° Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© ÙƒØ§Ù…Ù„Ø©\n          children: [\n            Text(\"Ù…Ù†ØªØ¬: ${item.name}\", style: const TextStyle(fontSize: 16)),\n            const SizedBox(height: 5),\n            Text(\"Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ: $oldPrice ${FirebaseX.currency}\"),\n            const Divider(height: 20),\n\n            // --- Ø­Ù‚Ù„ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¹Ø±Ø¶ (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ) ---\n            TextFormField(\n              controller: offerPriceController,\n              decoration: InputDecoration(\n                labelText: \"Ø³Ø¹Ø± Ø§Ù„Ø¹Ø±Ø¶ *\",\n                hintText: \"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…\",\n                prefixIcon: Icon(Icons.local_offer_outlined, size: 18),\n                border: OutlineInputBorder(\n                  borderRadius: BorderRadius.circular(10),\n                ),\n              ),\n              keyboardType: TextInputType.number,\n              inputFormatters: [\n                FilteringTextInputFormatter.digitsOnly,\n              ], // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·\n              validator: (value) {\n                if (value == null || value.trim().isEmpty) {\n                  return 'Ø³Ø¹Ø± Ø§Ù„Ø¹Ø±Ø¶ Ù…Ø·Ù„ÙˆØ¨';\n                }\n                final int? price = int.tryParse(value.trim());\n                if (price == null || price <= 0) {\n                  return 'Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø±Ø§Ù‹ ØµØ­ÙŠØ­Ø§Ù‹ Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±';\n                }\n                if (price >= oldPrice) {\n                  return 'Ø³Ø¹Ø± Ø§Ù„Ø¹Ø±Ø¶ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ';\n                } // ØªØ­Ù‚Ù‚ Ø¥Ø¶Ø§ÙÙŠ\n                return null;\n              },\n            ),\n            const SizedBox(height: 10),\n\n            // --- Ø­Ù‚Ù„ Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ ÙˆÙŠØªÙ… Ø­Ø³Ø§Ø¨Ù‡) ---\n            TextFormField(\n              controller: rateController,\n              decoration: InputDecoration(\n                labelText: \"Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… (%)\",\n                prefixIcon: Icon(Icons.percent, size: 18),\n                border: OutlineInputBorder(\n                  borderRadius: BorderRadius.circular(10),\n                ),\n                enabled: false, // Ø§Ø¬Ø¹Ù„Ù‡ ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ØŒ ÙÙ‚Ø· Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©\n              ),\n              keyboardType: TextInputType.number,\n            ),\n            const SizedBox(height: 15),\n\n            // --- (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø­Ù‚Ù„ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ ---\n            Obx(\n              () => ListTile(\n                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Obx Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ®\n                leading: const Icon(Icons.calendar_today_outlined),\n                title: Text(\n                  expiryDate.value == null\n                      ? \"ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¹Ø±Ø¶ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)\"\n                      : \"ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ: ${DateFormat('yyyy/MM/dd').format(expiryDate.value!)}\",\n                ),\n                trailing:\n                    expiryDate.value != null\n                        ? IconButton(\n                          icon: Icon(Icons.clear, size: 20),\n                          onPressed:\n                              () => expiryDate.value = null, // Ù…Ø³Ø­ Ø§Ù„ØªØ§Ø±ÙŠØ®\n                        )\n                        : null,\n                onTap: () async {\n                  DateTime? pickedDate = await showDatePicker(\n                    context: context,\n                    initialDate:\n                        expiryDate.value ??\n                        DateTime.now().add(\n                          const Duration(days: 7),\n                        ), // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¨Ø¹Ø¯ Ø£Ø³Ø¨ÙˆØ¹\n                    firstDate: DateTime.now(), // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® ÙÙŠ Ø§Ù„Ù…Ø§Ø¶ÙŠ\n                    lastDate: DateTime.now().add(\n                      const Duration(days: 365 * 2),\n                    ), // Ø³Ù†ØªÙŠÙ† ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰ Ù…Ø«Ù„Ø§Ù‹\n                  );\n                  if (pickedDate != null) {\n                    expiryDate.value = pickedDate;\n                  }\n                },\n              ),\n            ),\n            // ---------------------------------------\n          ],\n        ),\n      ),\n      confirm: ElevatedButton(\n        style: ElevatedButton.styleFrom(backgroundColor: Colors.blue[700]),\n        onPressed: () {\n          // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø³Ø¹Ø± Ø§Ù„Ø¹Ø±Ø¶\n          final int? newPrice = int.tryParse(offerPriceController.text.trim());\n          if (newPrice == null || newPrice <= 0 || newPrice >= oldPrice) {\n            // ÙŠÙ…ÙƒÙ†Ùƒ Ø¹Ø±Ø¶ Snackbar Ø£Ùˆ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø®Ø·Ø£ Ù‡Ù†Ø§\n            Get.snackbar(\n              \"Ø®Ø·Ø£\",\n              \"Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± Ø¹Ø±Ø¶ ØµØ­ÙŠØ­ Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ.\",\n              snackPosition: SnackPosition.BOTTOM,\n              backgroundColor: Colors.orange,\n            );\n            return;\n          }\n          // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©\n          final offerData = {\n            'newPrice': newPrice,\n            'oldPrice': oldPrice,\n            'rate':\n                int.tryParse(rateController.text.trim()) ??\n                0, // Ø§Ø³ØªØ®Ø¯Ù… 0 Ø¥Ø°Ø§ ÙƒØ§Ù† ÙØ§Ø±ØºØ§Ù‹\n            'expiryDate': expiryDate.value,\n          };\n\n          Get.back(); // Ø£ØºÙ„Ù‚ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø­ÙˆØ§Ø±\n          _saveAsOffer(item, offerData); // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸\n        },\n        child: const Text(\"Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ø±Ø¶\"), // <<-- ØªØ¹Ø±ÙŠØ¨\n      ),\n      cancel: TextButton(\n        onPressed: () => Get.back(),\n        child: const Text(\"Ø¥Ù„ØºØ§Ø¡\"), // <<-- ØªØ¹Ø±ÙŠØ¨\n      ),\n      radius: 15,\n    );\n\n    // Ø§Ù„ØªØ®Ù„Øµ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙ…Ø¹ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø­ÙˆØ§Ø±\n    // (ÙŠÙ…ÙƒÙ† ÙˆØ¶Ø¹Ù‡ ÙÙŠ onClose Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø­ÙˆØ§Ø± Ø¥Ø°Ø§ ÙƒØ§Ù† Get.dialog ÙŠØ¯Ø¹Ù… Ø°Ù„Ùƒ)\n    // Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… GetxController Ù„Ù„Ø­ÙˆØ§Ø± Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ­ÙƒÙ…Ø§Øª Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„\n  }\n\n  // ---!!! (Ø¬Ø¯ÙŠØ¯) Ø¯Ø§Ù„Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬ ÙƒØ¹Ø±Ø¶ ÙÙŠ Firestore !!!---\n  Future<void> _saveAsOffer(\n    ItemModel originalItem,\n    Map<String, dynamic> offerDetails,\n  ) async {\n    final String newOfferId = const Uuid().v4(); // ID Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¹Ø±Ø¶\n    final String? currentUserId = FirebaseAuth.instance.currentUser?.uid;\n    if (currentUserId == null) {\n      _showSnackbar('Ø®Ø·Ø£', 'Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.', Colors.red);\n      return;\n    }\n\n    try {\n      // Ø¨Ù†Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙŠØ¯\n      final OfferModel newOffer = OfferModel(\n        id: newOfferId, // ID Ø¬Ø¯ÙŠØ¯\n        name: originalItem.name, // Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø£ØµÙ„ÙŠ\n        description: originalItem.description,\n        imageUrl: originalItem.imageUrl,\n        manyImages: originalItem.manyImages,\n        videoUrl: originalItem.videoUrl,\n        appName: originalItem.appName,\n        uidAdd: currentUserId, // Ù…Ø¹Ø±Ù Ù…Ù† Ù‚Ø§Ù… Ø¨Ø§Ù„Ø¥Ø¶Ø§ÙØ©\n        // Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶\n        price: offerDetails['newPrice'], // Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯\n        oldPrice: offerDetails['oldPrice'],\n        rate: offerDetails['rate'],\n        // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø¥Ø°Ø§ Ø§Ø®ØªØ±Øª Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡\n        // expiryTimestamp: offerDetails['expiryDate'] != null ? Timestamp.fromDate(offerDetails['expiryDate']) : null,\n        // Ø±Ø¨Ø· Ø¨Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø£ØµÙ„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)\n        originalItemId: originalItem.id,\n      );\n\n      // Ø­ÙØ¸ Ø§Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶\n      await FirebaseFirestore.instance\n          .collection(\n            FirebaseX.offersCollection,\n          ) // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ø³Ù… Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„ØµØ­ÙŠØ­\n          .doc(newOfferId)\n          .set(newOffer.toMap());\n\n      _showSnackbar(\n        'Ù†Ø¬Ø§Ø­',\n        'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ \"${originalItem.name}\" ÙƒØ¹Ø±Ø¶ Ø¨Ù†Ø¬Ø§Ø­.',\n        Colors.green,\n      );\n    } catch (e) {\n      debugPrint(\"Error saving offer: $e\");\n      _showSnackbar('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¹Ø±Ø¶.', Colors.red);\n    }\n  }\n\n  // Ø¯Ø§Ù„Ø© Snackbar (Ø¶Ø¹Ù‡Ø§ Ù‡Ù†Ø§ Ø£Ùˆ ÙŠÙØ¶Ù„ ÙÙŠ Ø§Ù„Ù…ØªØ­ÙƒÙ…)\n  void _showSnackbar(String title, String message, Color backgroundColor) {\n    if (Get.isSnackbarOpen) {\n      Get.back();\n    }\n    Get.snackbar(\n      title,\n      message,\n      snackPosition: SnackPosition.BOTTOM,\n      backgroundColor: backgroundColor,\n      colorText: Colors.white,\n      margin: const EdgeInsets.all(10),\n      borderRadius: 8,\n    );\n  }\n\n  // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ÙˆÙ† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©\n  Color _getQualityColor(int? grade) {\n    if (grade == null)\n      return Colors.grey.shade400; // Ù„ÙˆÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¥Ø°Ø§ Ù„Ù… ØªØªÙˆÙØ± Ø§Ù„Ø¯Ø±Ø¬Ø©\n    if (grade >= 1 && grade <= 4) {\n      return Colors.green.shade600; // Ø£Ø®Ø¶Ø± Ù„Ù„Ø¯Ø±Ø¬Ø§Øª 1-4\n    } else if (grade >= 5 && grade <= 7) {\n      return Colors.amber.shade700; // Ø£ØµÙØ±/Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ù„Ù„Ø¯Ø±Ø¬Ø§Øª 5-7\n    } else {\n      return Colors.red.shade600; // Ø£Ø­Ù…Ø± Ù„Ù„Ø¯Ø±Ø¬Ø§Øª 8-10\n    }\n  }\n\n  // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø­Ù‚Ù„ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Øµ (ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ØŒ Ù„ÙƒÙ† ØªØ­ØªØ§Ø¬ Ù„ÙˆØ¶Ø¹Ù‡Ø§ Ø¯Ø§Ø®Ù„ Ù…Ø±Ø¨Ø¹ Ø­ÙˆØ§Ø± ØºØ§Ù„Ø¨Ø§Ù‹)\n  Widget _buildEditTextField(\n    TextEditingController controller,\n    String label,\n    TextInputType inputType,\n  ) {\n    return Padding(\n      padding: const EdgeInsets.symmetric(vertical: 8.0, horizontal: 16.0),\n      child: SizedBox(\n        width: 250, // Ø¹Ø±Ø¶ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø­ÙˆØ§Ø±\n        child: TextField(\n          controller: controller,\n          decoration: InputDecoration(\n            labelText: label,\n            border: OutlineInputBorder(borderRadius: BorderRadius.circular(8)),\n            isDense: true,\n            contentPadding: const EdgeInsets.symmetric(\n              horizontal: 10,\n              vertical: 12,\n            ),\n          ),\n          keyboardType: inputType,\n          autofocus: true, // ØªØ±ÙƒÙŠØ² ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¸Ù‡ÙˆØ±\n        ),\n      ),\n    );\n  }\n\n  // Ù…Ø±Ø¨Ø¹ Ø­ÙˆØ§Ø± Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù\n  void _showDeleteConfirmationDialog(BuildContext context, String itemId) {\n    final logic =\n        Get.find<GetStreamBuildBoxOfItemController>(); // Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØ­ÙƒÙ…\n\n    Get.defaultDialog(\n      title: \"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù\", // <<-- ØªØ¹Ø±ÙŠØ¨\n      titleStyle: TextStyle(\n        fontWeight: FontWeight.bold,\n        color: Colors.red[700],\n      ),\n      middleText:\n          \"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.\", // <<-- ØªØ¹Ø±ÙŠØ¨\n      middleTextStyle: const TextStyle(fontSize: 15),\n      confirm: ElevatedButton.icon(\n        icon: const Icon(Icons.delete_forever),\n        label: const Text(\"Ø­Ø°Ù\"), // <<-- ØªØ¹Ø±ÙŠØ¨\n        style: ElevatedButton.styleFrom(backgroundColor: Colors.red[600]),\n        onPressed: () async {\n          Get.back(); // Ø¥ØºÙ„Ø§Ù‚ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø­ÙˆØ§Ø± Ø£ÙˆÙ„Ø§Ù‹\n          try {\n            await FirebaseFirestore.instance\n                .collection(FirebaseX.itemsCollection)\n                .doc(itemId)\n                .delete();\n            logic.showSnackbar(\n              'Ù†Ø¬Ø§Ø­',\n              'ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­.',\n              Colors.green,\n            ); // <<-- ØªØ¹Ø±ÙŠØ¨\n          } catch (e) {\n            logic.showSnackbar(\n              'Ø®Ø·Ø£',\n              'ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬.',\n              Colors.red,\n            ); // <<-- ØªØ¹Ø±ÙŠØ¨\n            debugPrint(\"Delete Error: $e\");\n          }\n        },\n      ),\n      cancel: TextButton(\n        onPressed: () => Get.back(),\n        child: const Text(\"Ø¥Ù„ØºØ§Ø¡\"), // <<-- ØªØ¹Ø±ÙŠØ¨\n      ),\n      radius: 10.0,\n    );\n  }\n\n  // ... (Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ù€ ProductGridWidget ÙƒÙ…Ø§ Ù‡Ùˆ) ...\n  // ... _showAdminContextMenu, _buildEditTextField, _showDeleteConfirmationDialog ...\n  // ... build method ...\n  @override\n  Widget build(BuildContext context) {\n    return GetBuilder<EnhancedCategoryFilterController>(\n      init: EnhancedCategoryFilterController(),\n      builder: (controller) {\n        final hi = MediaQuery.of(context).size.height;\n        final wi = MediaQuery.of(context).size.width;\n        final GetStreamBuildBoxOfItemController logic = Get.put(\n          GetStreamBuildBoxOfItemController(),\n        );\n        Get.put(FavoriteController());\n\n        debugPrint(\n          \"ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ ProductGridWidget - Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù…Ø·Ø¨Ù‚: ${controller.getFilterKey()}\",\n        );\n\n        return StreamBuilder<QuerySnapshot<Map<String, dynamic>>>(\n          stream:\n              _buildProductStream(), // <-- Ø§Ù„Ø¯Ø§Ù„Ø© ØªØ³ØªØ®Ø¯Ù… Ø§Ù„ØªØ±ØªÙŠØ¨ Ù…Ù† Get.find Ø§Ù„Ø¢Ù†\n          builder: (context, snapshot) {\n            // ... (Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© loading, error, empty, grid building) ...\n            if (snapshot.hasError) {\n              debugPrint(\"âŒ Product Grid Error: ${snapshot.error}\");\n              debugPrint(\"âŒ Stack trace: ${snapshot.stackTrace}\");\n\n              // ØªØ­Ù„ÙŠÙ„ Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø£ ÙˆØ¥Ø¹Ø·Ø§Ø¡ Ø±Ø³Ø§Ù„Ø© Ù…Ù†Ø§Ø³Ø¨Ø©\n              String errorMessage = 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';\n              if (snapshot.error.toString().contains('requires an index')) {\n                errorMessage = 'Ø®Ø·Ø£ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - ÙŠØªÙ… Ø¥ØµÙ„Ø§Ø­Ù‡...';\n                debugPrint(\n                  \"ğŸ”§ Ø®Ø·Ø£ Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù…ÙƒØªØ´Ù - Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¯ÙˆÙ† ØªØ±ØªÙŠØ¨\",\n                );\n              } else if (snapshot.error.toString().contains('permission')) {\n                errorMessage = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª';\n              } else if (snapshot.error.toString().contains('network')) {\n                errorMessage = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©';\n              }\n\n              return Center(\n                child: Padding(\n                  padding: const EdgeInsets.all(20.0),\n                  child: Column(\n                    mainAxisSize: MainAxisSize.min,\n                    children: [\n                      Icon(\n                        Icons.error_outline,\n                        color: Colors.red.shade300,\n                        size: 60,\n                      ),\n                      const SizedBox(height: 15),\n                      Text(\n                        errorMessage,\n                        style: TextStyle(\n                          fontSize: 18,\n                          fontWeight: FontWeight.bold,\n                          color: Colors.red.shade700,\n                        ),\n                        textAlign: TextAlign.center,\n                      ),\n                      const SizedBox(height: 8),\n                      Text(\n                        'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰...',\n                        style: TextStyle(fontSize: 15, color: Colors.grey[600]),\n                        textAlign: TextAlign.center,\n                      ),\n                    ],\n                  ),\n                ),\n              );\n            }\n            if (snapshot.connectionState == ConnectionState.waiting) {\n              // return _buildLoadingGrid(context); // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù‡Ø°Ø§\n              return _buildShimmerLoadingGrid(\n                context,\n              ); // <-- Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Shimmer\n            }\n            final docs = snapshot.data?.docs ?? [];\n            debugPrint(\"ğŸ” Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©: ${docs.length}\");\n            if (docs.isNotEmpty) {\n              debugPrint(\"ğŸ” Ø£ÙˆÙ„ Ù…Ù†ØªØ¬: ${docs.first.data()}\");\n            }\n            if (docs.isEmpty) {\n              debugPrint(\"âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ\");\n\n              // Ø¥Ø¶Ø§ÙØ© ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase Ø¨ØµÙØ© Ø¹Ø§Ù…Ø©\n              FirebaseFirestore.instance\n                  .collection(FirebaseX.itemsCollection)\n                  .where('appName', isEqualTo: FirebaseX.appName)\n                  .limit(5)\n                  .get()\n                  .then((querySnapshot) {\n                    debugPrint(\n                      \"ğŸ” Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: ${querySnapshot.docs.length}\",\n                    );\n                    if (querySnapshot.docs.isNotEmpty) {\n                      final sampleItem = querySnapshot.docs.first.data();\n                      debugPrint(\"ğŸ” Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:\");\n                      debugPrint(\n                        \"   - mainCategoryId: ${sampleItem['mainCategoryId']}\",\n                      );\n                      debugPrint(\n                        \"   - subCategoryId: ${sampleItem['subCategoryId']}\",\n                      );\n                      debugPrint(\"   - typeItem: ${sampleItem['typeItem']}\");\n                      debugPrint(\n                        \"   - itemCondition: ${sampleItem['itemCondition']}\",\n                      );\n                    }\n                  });\n\n              return _buildEmptyStateWidget(\n                context,\n              ); // <-- Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±ØºØ© Ø§Ù„Ù…Ø­Ø³Ù†Ø©\n            }\n            // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø´Ø¨ÙƒØ©\n            return Padding(\n              padding: const EdgeInsets.symmetric(horizontal: 7),\n              child: GridView.builder(\n                // NeverScrollableScrollPhysics Ù„Ø£Ù† Ø§Ù„Ø´Ø¨ÙƒØ© Ø¯Ø§Ø®Ù„ ListView ØºØ§Ù„Ø¨Ø§Ù‹\n                physics: const NeverScrollableScrollPhysics(),\n                shrinkWrap:\n                    true, // Ù„ØªÙ†Ø§Ø³Ø¨ Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ ListView Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ\n                gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(\n                  crossAxisCount: 2, // Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©\n                  // ØªØ­Ø¯ÙŠØ« childAspectRatio Ø¨Ø¹Ø¯ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø³Ø¨Ø© 8%\n                  childAspectRatio:\n                      (wi * 0.5) /\n                      (hi * 0.31), // ØªÙ‚Ù„ÙŠÙ„ Ù…Ù† 0.338 Ù„ØªØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯\n                  crossAxisSpacing: 10, // Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©\n                  mainAxisSpacing: 10, // Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„ØµÙÙˆÙ\n                ),\n                itemCount: docs.length,\n                itemBuilder: (context, index) {\n                  try {\n                    // ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø®Ø·Ø£ Ø¥Ø°Ø§ ÙØ´Ù„ fromMap\n                    final item = ItemModel.fromMap(\n                      docs[index].data(),\n                      docs[index].id,\n                    );\n                    return _buildItemCard(context, item, wi, hi, logic);\n                  } catch (e, s) {\n                    debugPrint(\"Error parsing item at index $index: $e\\n$s\");\n                    // Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø®Ø·Ø£ ÙˆØ§Ø¶Ø­Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…\n                    return Card(\n                      color: Colors.red[50],\n                      child: Center(\n                        child: Padding(\n                          padding: const EdgeInsets.all(8.0),\n                          child: Column(\n                            mainAxisSize: MainAxisSize.min,\n                            children: [\n                              Icon(\n                                Icons.warning_amber_rounded,\n                                color: Colors.red[400],\n                                size: 30,\n                              ),\n                              SizedBox(height: 5),\n                              Text(\n                                'Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬',\n                                textAlign: TextAlign.center,\n                                style: TextStyle(color: Colors.red[700]),\n                              ), // <<-- ØªØ¹Ø±ÙŠØ¨\n                            ],\n                          ),\n                        ),\n                      ),\n                    );\n                  }\n                },\n              ),\n            );\n          },\n        );\n      },\n    );\n  }\n\n  // ---!!! (Ø¬Ø¯ÙŠØ¯) Ø¨Ù†Ø§Ø¡ Ù‡ÙŠÙƒÙ„ ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ø­Ø¯ Ø¨Ù€ Shimmer !!!---\n  Widget _buildProductSkeletonCard(BuildContext context) {\n    final wi = MediaQuery.of(context).size.width;\n    final cardWidth = wi * 0.5 - 12; // Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù…Ø¹ Ø§Ù„Ø£Ø®Ø° Ø¨Ø§Ù„ØªØ¨Ø§Ø¹Ø¯\n\n    return Card(\n      elevation: 2.0,\n      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),\n      clipBehavior: Clip.antiAlias,\n      child: Column(\n        crossAxisAlignment: CrossAxisAlignment.stretch,\n        children: [\n          // Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØµÙˆØ±Ø© - Ø­Ø¬Ù… Ø«Ø§Ø¨Øª Ù…Ù‚Ù„Ù„ Ø¨Ù†Ø³Ø¨Ø© 8%\n          SizedBox(\n            height: MediaQuery.of(context).size.height * 0.1656,\n            child: Container(color: Colors.white),\n          ),\n          // Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø±\n          Expanded(\n            child: Padding(\n              padding: const EdgeInsets.fromLTRB(8, 8, 8, 4),\n              child: Column(\n                crossAxisAlignment: CrossAxisAlignment.start,\n                mainAxisAlignment: MainAxisAlignment.spaceBetween,\n                children: [\n                  Container(\n                    width: cardWidth * 0.8,\n                    height: 12,\n                    color: Colors.white,\n                  ), // Ø´Ø±ÙŠØ· Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬\n                  SizedBox(height: 5),\n                  Container(\n                    width: cardWidth * 0.5,\n                    height: 10,\n                    color: Colors.white,\n                  ), // Ø´Ø±ÙŠØ· Ù„Ù„Ø³Ø¹Ø±/Ø£Ø²Ø±Ø§Ø±\n                ],\n              ),\n            ),\n          ),\n        ],\n      ),\n    );\n  }\n\n  // ---!!! (Ø¬Ø¯ÙŠØ¯) Ø¨Ù†Ø§Ø¡ Ø´Ø¨ÙƒØ© Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù€ Shimmer !!!---\n  Widget _buildShimmerLoadingGrid(BuildContext context) {\n    final wi = MediaQuery.of(context).size.width;\n    final hi = MediaQuery.of(context).size.height;\n\n    return Padding(\n      padding: const EdgeInsets.symmetric(horizontal: 7),\n      child: Shimmer.fromColors(\n        // <-- ØªØºÙ„ÙŠÙ Ø§Ù„Ø´Ø¨ÙƒØ© Ø¨Ø§Ù„Ø´ÙŠÙ…Ø±\n        baseColor: Colors.grey[300]!,\n        highlightColor: Colors.grey[100]!,\n        child: GridView.builder(\n          physics: const NeverScrollableScrollPhysics(),\n          shrinkWrap: true,\n          gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(\n            crossAxisCount: 2,\n            childAspectRatio:\n                (wi * 0.5) /\n                (hi * 0.31), // Ù†ÙØ³ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ø¨Ø¹Ø¯ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© 8%\n            crossAxisSpacing: 10,\n            mainAxisSpacing: 10,\n          ),\n          itemCount: 6, // Ø¹Ø±Ø¶ 6 Ù‡ÙŠØ§ÙƒÙ„ ØªØ­Ù…ÙŠÙ„\n          itemBuilder:\n              (context, index) =>\n                  _buildProductSkeletonCard(context), // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‡ÙŠÙƒÙ„\n        ),\n      ),\n    );\n  }\n\n  // ---!!! (Ø¬Ø¯ÙŠØ¯) Ø¨Ù†Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© \"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬\" Ø§Ù„Ù…Ø­Ø³Ù†Ø© !!!---\n  Widget _buildEmptyStateWidget(BuildContext context) {\n    // Ù…Ø¹Ø±ÙØ© Ù‡Ù„ ØªÙ… ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø£Ù… Ù„Ø§\n    bool isFiltered = false;\n    try {\n      final filterController = Get.find<EnhancedCategoryFilterController>();\n      isFiltered = filterController.hasActiveFilter.value;\n    } catch (e) {\n      isFiltered =\n          (widget.selectedSubtypeKey != null &&\n              widget.selectedSubtypeKey != allItemsFilterKey);\n    }\n\n    return Center(\n      child: Padding(\n        padding: const EdgeInsets.symmetric(vertical: 50.0, horizontal: 20.0),\n        child: Column(\n          mainAxisSize: MainAxisSize.min,\n          children: [\n            Icon(\n              isFiltered\n                  ? Icons.filter_alt_off_outlined\n                  : Icons.shelves, // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø®ØªÙ„ÙØ© Ù„Ù„ÙÙ„ØªØ±\n              size: 70,\n              color: Colors.grey[400],\n            ),\n            const SizedBox(height: 20),\n            Text(\n              isFiltered\n                  ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ù‡Ø°Ø§ Ø§Ù„ÙÙ„ØªØ±'\n                  : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯!', // <<-- ØªØ¹Ø±ÙŠØ¨\n              style: TextStyle(\n                fontSize: 18,\n                fontWeight: FontWeight.w500,\n                color: Colors.grey[700],\n              ),\n              textAlign: TextAlign.center,\n            ),\n            const SizedBox(height: 10),\n            Text(\n              isFiltered\n                  ? 'Ø¬Ø±Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø¢Ø®Ø± Ø£Ùˆ Ù‚Ù… Ø¨Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙÙ„ØªØ±.'\n                  : 'ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ±Ù‰ Ø¬Ø¯ÙŠØ¯Ù†Ø§!', // <<-- ØªØ¹Ø±ÙŠØ¨\n              style: TextStyle(fontSize: 15, color: Colors.grey[600]),\n              textAlign: TextAlign.center,\n            ),\n            // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ÙÙ„ØªØ± Ù…Ø·Ø¨Ù‚\n            if (isFiltered) ...[\n              const SizedBox(height: 25),\n              OutlinedButton.icon(\n                icon: const Icon(Icons.clear_all, size: 18),\n                label: const Text(\"Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª\"), // <<-- ØªØ¹Ø±ÙŠØ¨\n                style: OutlinedButton.styleFrom(\n                  side: BorderSide(\n                    color: Theme.of(context).colorScheme.primary,\n                  ),\n                  foregroundColor: Theme.of(context).colorScheme.primary,\n                  padding: EdgeInsets.symmetric(horizontal: 20, vertical: 10),\n                ),\n                onPressed: () {\n                  // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† ÙÙŠ Ù…ØªØ­ÙƒÙ… Ø§Ù„ÙÙ„ØªØ±\n                  try {\n                    final filterController =\n                        Get.find<EnhancedCategoryFilterController>();\n                    filterController.resetFilters();\n                  } catch (e) {\n                    debugPrint(\"Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ±: $e\");\n                  }\n                },\n              ),\n            ],\n          ],\n        ),\n      ),\n    );\n  }\n\n  // Ø¨Ù†Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„ÙØ±Ø¯ÙŠ\n\n  // Ø¨Ù†Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„ÙØ±Ø¯ÙŠ (Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©)\n  // --- Ø¨Ù†Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„ÙØ±Ø¯ÙŠ ---\n  Widget _buildItemCard(\n    BuildContext context,\n    ItemModel item,\n    double wi,\n    double hi,\n    GetStreamBuildBoxOfItemController controller,\n  ) {\n    final theme = Theme.of(context); // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø«ÙŠÙ… Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡\n    final FavoriteController favoriteCtrl =\n        Get.find<FavoriteController>(); // <-- Ù…Ù‡Ù… Ù‡Ù†Ø§\n\n    // --- 1. ØªØ­Ø¶ÙŠØ± Ù†Øµ Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ù„ÙˆÙ† ---\n    String conditionText = '';\n    if (item.itemCondition == 'original') {\n      conditionText = 'Ø¨Ø±Ø§Ù†Ø¯'; // ØªØºÙŠÙŠØ± Ù…Ù† \"Ø£ØµÙ„ÙŠ\" Ø¥Ù„Ù‰ \"Ø¨Ø±Ø§Ù†Ø¯\"\n    } else if (item.itemCondition == 'commercial') {\n      conditionText = 'ØªØ¬Ø§Ø±ÙŠ';\n    }\n    // ØªØ­Ø¶ÙŠØ± Ù†Øµ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¬ÙˆØ¯Ø© \"Ø¯.X\"\n    String qualityText =\n        item.qualityGrade != null ? 'Ø¯.${item.qualityGrade}' : '';\n    // Ø¯Ù…Ø¬ Ø§Ù„Ù†ØµÙŠÙ† Ø¨Ù…Ø³Ø§ÙØ© (Ø¨Ø¯ÙˆÙ† ÙØ§ØµÙ„ '|') ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† ÙƒÙ„Ø§Ù‡Ù…Ø§ Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§\n    String combinedStatusText = conditionText;\n    if (conditionText.isNotEmpty && qualityText.isNotEmpty) {\n      combinedStatusText += ' $qualityText'; // Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ†Ù‡Ù…Ø§\n    } else {\n      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø£ÙˆÙ„ ÙØ§Ø±ØºÙ‹Ø§ØŒ Ø£Ø¶Ù Ø§Ù„Ø«Ø§Ù†ÙŠ Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ (Ø£Ùˆ Ø§Ù„Ø¹ÙƒØ³)\n      combinedStatusText += qualityText;\n    }\n    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø¯Ø±Ø¬Ø©\n    Color qualityColor = _getQualityColor(\n      item.qualityGrade,\n    ); // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©\n    // -------------------------------------\n\n    // --- 2. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ---\n    return Card(\n      elevation: 2.5, // Ø²ÙŠØ§Ø¯Ø© Ø·ÙÙŠÙØ© Ù„Ù„Ø¸Ù„\n      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),\n      clipBehavior: Clip.antiAlias, // Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù€ Stack ÙˆØ§Ù„Ø­ÙˆØ§Ù Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØ©\n      child: InkWell(\n        onTap: () {\n          debugPrint(\"Navigating to details for ${item.name} (ID: ${item.id})\");\n          // Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø´Ø§Ø´Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„\n          Get.to(() => DetailsOfItemScreen(item: item));\n        },\n        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· (Ù„Ø£Ø³ÙÙ„ Ø£Ùˆ Ù…Ø·ÙˆÙ„Ø§Ù‹) Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ù…Ù†\n        onTapDown: (details) {\n          if (_isAdmin)\n            _showAdminContextMenu(context, details, item, controller);\n        },\n        onLongPress: () {\n          if (_isAdmin) {\n            final center = Offset(wi / 2, hi / 2);\n            _showAdminContextMenu(\n              context,\n              TapDownDetails(globalPosition: center),\n              item,\n              controller,\n            );\n          }\n        },\n        child: Column(\n          crossAxisAlignment:\n              CrossAxisAlignment.stretch, // Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙØ±Ø¹ÙŠØ© ØªÙ…Ù„Ø£ Ø§Ù„Ø¹Ø±Ø¶\n          children: [\n            // --- 3. Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¹Ù„ÙˆÙŠ: Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¹ Ø§Ù„Ø´Ø±ÙŠØ· ---\n            SizedBox(\n              height:\n                  hi *\n                  0.1656, // ØªØ­Ø¯ÙŠØ¯ Ø­Ø¬Ù… Ø«Ø§Ø¨Øª Ù„Ù„ØµÙˆØ±Ø© (ØªÙ‚Ù„ÙŠÙ„ 8% Ù…Ù† Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚)\n              child: Stack(\n                fit: StackFit.expand, // Ù„Ø¬Ø¹Ù„ Ø§Ù„ØµÙˆØ±Ø© ØªÙ…Ù„Ø£ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØªØ§Ø­Ø©\n                children: [\n                  // --- Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Hero Ùˆ CachedNetworkImage ---\n                  // Ø§Ù„ØµÙˆØ±Ø© Ø³ØªÙ…Ù„Ø£ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø§ Ø¨ÙØ¶Ù„ Positioned.fill Ø¶Ù…Ù†ÙŠØ§Ù‹\n                  _buildItemImage(item, wi, hi), // Ø¨Ù†Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø©\n                  // --- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹) ---\n                  if (item.videoUrl != null && item.videoUrl != 'noVideo')\n                    Positioned(\n                      top: 8,\n                      left: 8,\n                      child: Container(\n                        padding: const EdgeInsets.all(4),\n                        decoration: BoxDecoration(\n                          color: Colors.black.withOpacity(0.6),\n                          shape: BoxShape.circle,\n                        ),\n                        child: const Icon(\n                          Icons.play_circle_fill,\n                          size: 20,\n                          color: Colors.white,\n                        ),\n                      ),\n                    ),\n\n                  // --- Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ø¬ÙˆØ¯Ø© (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù†Øµ) ---\n                  if (combinedStatusText\n                      .trim()\n                      .isNotEmpty) // ØªØ­Ù‚Ù‚ Ø£Ù† Ø§Ù„Ù†Øµ ØºÙŠØ± ÙØ§Ø±Øº Ø¨Ø¹Ø¯ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª\n                    Positioned(\n                      top: 6, // Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ø­Ø§ÙØ© Ø§Ù„Ø¹Ù„ÙˆÙŠØ©\n                      right: 6, // Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ø­Ø§ÙØ© Ø§Ù„ÙŠÙ…Ù†Ù‰\n                      child: IgnorePointer(\n                        // Ù„Ù…Ù†Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ø´Ø±ÙŠØ· Ù…Ù† Ø§Ø¹ØªØ±Ø§Ø¶ Ù†Ù‚Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©\n                        child: Container(\n                          padding: const EdgeInsets.symmetric(\n                            horizontal: 7,\n                            vertical: 3,\n                          ), // ØªØ¨Ø§Ø¹Ø¯ Ø¯Ø§Ø®Ù„ÙŠ Ø­ÙˆÙ„ Ø§Ù„Ù†Øµ\n                          decoration: BoxDecoration(\n                            color: qualityColor.withOpacity(\n                              0.9,\n                            ), // Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù…Ø­Ø³ÙˆØ¨ Ù…Ø¹ Ø´ÙØ§ÙÙŠØ© Ø·ÙÙŠÙØ©\n                            borderRadius: BorderRadius.circular(\n                              6,\n                            ), // Ø­ÙˆØ§Ù Ø¯Ø§Ø¦Ø±ÙŠØ©\n                            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯ÙˆØ¯ Ø®ÙÙŠÙØ© Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)\n                            // border: Border.all(color: Colors.white.withOpacity(0.5), width: 0.5),\n                            boxShadow: [\n                              // Ø¸Ù„ Ø®ÙÙŠÙ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙˆØ¶ÙˆØ­ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)\n                              BoxShadow(\n                                color: Colors.black.withOpacity(0.25),\n                                blurRadius: 4,\n                                offset: Offset(0, 1),\n                              ),\n                            ],\n                          ),\n                          child: Text(\n                            combinedStatusText, // Ø§Ù„Ù†Øµ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (\"Ø£ØµÙ„ÙŠ Ø¯.1\", \"ØªØ¬Ø§Ø±ÙŠ\", \"Ø¯.8\", Ø¥Ù„Ø®.)\n                            style: TextStyle(\n                              color: Colors.white, // Ù„ÙˆÙ† Ù†Øµ Ø£Ø¨ÙŠØ¶\n                              fontSize: wi * 0.027, // Ø­Ø¬Ù… Ø®Ø· ØµØºÙŠØ± ÙˆÙ…Ù†Ø§Ø³Ø¨\n                              fontWeight: FontWeight.bold,\n                            ),\n                            maxLines: 1,\n                            overflow:\n                                TextOverflow\n                                    .ellipsis, // Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ø·ÙˆÙŠÙ„ Ø¬Ø¯Ù‹Ø§ (ØºÙŠØ± Ù…Ø­ØªÙ…Ù„ Ù‡Ù†Ø§)\n                          ),\n                        ),\n                      ),\n                    ),\n                  // ------------------------------------\n                  Positioned(\n                    top:\n                        combinedStatusText.trim().isNotEmpty\n                            ? 35\n                            : 6, // <--- Ø¶Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø´Ø±ÙŠØ·\n                    right: 6,\n                    // Ø§Ø³ØªØ®Ø¯Ø§Ù… StreamBuilder Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©\n                    child: StreamBuilder<bool>(\n                      stream: favoriteCtrl.isFavoriteStream(\n                        item.id,\n                      ), // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø­Ø§Ù„ÙŠ\n                      builder: (context, favSnapshot) {\n                        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø­Ø§Ù„Ø§Øª StreamBuilder (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)\n                        // if (favSnapshot.connectionState == ConnectionState.waiting) {\n                        //   return SizedBox(width: 30, height: 30, child: Padding(padding: EdgeInsets.all(8), child: CircularProgressIndicator(strokeWidth: 1.5)));\n                        // }\n                        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø³ØªØ±ÙŠÙ… (Ù†Ø§Ø¯Ø±Ø§Ù‹ Ù…Ø§ ÙŠØ­Ø¯Ø« Ù‡Ù†Ø§)\n                        // if (favSnapshot.hasError) {\n                        //    return Icon(Icons.error_outline, color: Colors.red[200]);\n                        // }\n                        // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø£Ùˆ Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ÙŠØ©\n                        final bool isFavorite =\n                            favSnapshot.data ?? false; // Ø§ÙØªØ±Ø§Ø¶ Ø£Ù†Ù‡ Ù„ÙŠØ³ Ù…ÙØ¶Ù„\n\n                        return Material(\n                          // Ø§Ø³ØªØ®Ø¯Ø§Ù… Material Ù„Ù€ InkWell/splash effect\n                          color: Colors.black.withOpacity(\n                            0.3,\n                          ), // Ø®Ù„ÙÙŠØ© Ø´Ø¨Ù‡ Ø´ÙØ§ÙØ©\n                          borderRadius: BorderRadius.circular(20),\n                          child: InkWell(\n                            borderRadius: BorderRadius.circular(20),\n                            onTap: () {\n                              // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙÙŠ Ø§Ù„Ù…ØªØ­ÙƒÙ…\n                              favoriteCtrl.toggleFavorite(item.id, isFavorite);\n                            },\n                            child: Padding(\n                              padding: const EdgeInsets.all(6.0), // ØªØ¨Ø§Ø¹Ø¯ Ø¯Ø§Ø®Ù„ÙŠ\n                              child: Icon(\n                                // Ø¹Ø±Ø¶ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ù…Ù„ÙˆØ¡Ø© Ø£Ùˆ ÙØ§Ø±ØºØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø©\n                                isFavorite\n                                    ? Icons.favorite_rounded\n                                    : Icons.favorite_border_rounded,\n                                color:\n                                    isFavorite\n                                        ? Colors.redAccent\n                                        : Colors.white, // Ø£Ù„ÙˆØ§Ù† Ù…Ù…ÙŠØ²Ø©\n                                size: wi * 0.055, // Ø­Ø¬Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©\n                              ),\n                            ),\n                          ),\n                        );\n                      },\n                    ),\n                  ),\n                ],\n              ),\n            ), // Ù†Ù‡Ø§ÙŠØ© Stack Ø§Ù„ØµÙˆØ±Ø©\n            // --- 4. Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³ÙÙ„ÙŠ: Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± ---\n            Expanded(\n              child: Padding(\n                padding: const EdgeInsets.only(\n                  left: 8,\n                  right: 8,\n                  top: 8,\n                  bottom: 4,\n                ), // Ø²ÙŠØ§Ø¯Ø© top padding Ù…Ù† 6 Ø¥Ù„Ù‰ 8\n                child: Column(\n                  crossAxisAlignment:\n                      CrossAxisAlignment.center, // ØªÙˆØ³ÙŠØ· Ø§Ù„Ù…Ø­ØªÙˆÙ‰\n                  mainAxisAlignment:\n                      MainAxisAlignment.spaceBetween, // Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø­Ø©\n                  children: [\n                    // Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ - Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ù…Ø¹ ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙˆØ¶ÙˆØ­ ÙˆØ§Ù„ØªÙ…ÙŠØ²\n                    Container(\n                      padding: EdgeInsets.symmetric(vertical: 4, horizontal: 6),\n                      decoration: BoxDecoration(\n                        color: Colors.white.withOpacity(0.9),\n                        borderRadius: BorderRadius.circular(8),\n                        boxShadow: [\n                          BoxShadow(\n                            color: Colors.black.withOpacity(0.05),\n                            blurRadius: 4,\n                            offset: Offset(0, 1),\n                          ),\n                        ],\n                      ),\n                      child: Text(\n                        item.name,\n                        style: theme.textTheme.titleSmall?.copyWith(\n                          fontWeight: FontWeight.w700, // Ø²ÙŠØ§Ø¯Ø© Ù…Ù† w600 Ø¥Ù„Ù‰ w700\n                          fontSize:\n                              wi *\n                              0.027, // ØªÙ‚Ù„ÙŠÙ„ Ù…Ù† 0.040 Ø¥Ù„Ù‰ 0.036 (ØªÙ‚Ù„ÙŠÙ„ 10%)\n                          height: 1, // Ø²ÙŠØ§Ø¯Ø© Ù‚Ù„ÙŠÙ„Ø© ÙÙŠ ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„Ø£Ø³Ø·Ø±\n                          color: theme.textTheme.titleMedium?.color\n                              ?.withOpacity(0.9),\n                          letterSpacing: 0.3, // Ø¥Ø¶Ø§ÙØ© ØªØ¨Ø§Ø¹Ø¯ Ø¨ÙŠÙ† Ø§Ù„Ø­Ø±ÙˆÙ Ù„Ù„ÙˆØ¶ÙˆØ­\n                        ),\n                        maxLines: 1, // Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ÙƒÙ…Ø§ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…\n                        overflow:\n                            TextOverflow.ellipsis, // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Øµ Ø§Ù„Ø²Ø§Ø¦Ø¯ Ø¨Ù€ ...\n                        textAlign: TextAlign.center, // ØªÙˆØ³ÙŠØ· Ø§Ù„Ù†Øµ\n                      ),\n                    ),\n                    // Ø§Ù„Ø³Ø¹Ø± ÙˆØ£Ø²Ø±Ø§Ø± +/-\n                    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø© (price ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† int)\n                    BoxAddAndRemove(\n                      uidItem: item.id,\n                      price: item.price, // <-- ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø³Ø¹Ø± (int)\n                      name: item.name, // <-- ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø§Ø³Ù…\n                      isOffer: false,\n                      uidAdd: item.uidAdd, // Ù„ÙŠØ³ Ø¹Ø±Ø¶Ù‹Ø§ Ù‡Ù†Ø§\n                    ),\n                  ],\n                ),\n              ),\n            ), // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³ÙÙ„ÙŠ\n          ],\n        ),\n      ),\n    );\n  }\n\n  // --- (Ø¬Ø¯ÙŠØ¯) Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ù…Ø±Ø¨Ø¹ Ø­ÙˆØ§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ø§Ø³Ù… Ø£Ùˆ Ø³Ø¹Ø±) ---\n  void _showEditDialog(\n    BuildContext context,\n    GetStreamBuildBoxOfItemController controller,\n    ItemModel item, {\n    required bool isEditingName,\n  }) {\n    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ØªØ­ÙƒÙ… Ø§Ù„Ù†ØµÙŠ Ø¨Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©\n    final editController = TextEditingController(\n      text: isEditingName ? item.name : item.price.toString(),\n    );\n    final String title =\n        isEditingName ? \"ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬\" : \"ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬\";\n    final String label = isEditingName ? \"Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯\" : \"Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯\";\n    final TextInputType keyboardType =\n        isEditingName\n            ? TextInputType.text\n            : TextInputType.numberWithOptions(\n              decimal: false,\n            ); // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„ÙˆØ­Ø© Ø£Ø±Ù‚Ø§Ù… Ù„Ù„Ø³Ø¹Ø±\n\n    Get.defaultDialog(\n      title: title,\n      titlePadding: const EdgeInsets.only(top: 20, bottom: 10),\n      titleStyle: TextStyle(fontWeight: FontWeight.bold, fontSize: 18),\n      contentPadding: const EdgeInsets.symmetric(horizontal: 20),\n      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Form Ù„Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø­ØªÙ…Ù„\n      content: Form(\n        // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© GlobalKey<FormState> Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ø§Ø­ØªØ¬Øª Ù„Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø¹Ù‚Ø¯\n        child: _buildEditTextField(\n          editController,\n          label,\n          keyboardType,\n        ), // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ø¨Ù†Ø§Ø¡ Ø­Ù‚Ù„ Ø§Ù„Ù†Øµ\n      ),\n      confirm: ElevatedButton(\n        onPressed: () async {\n          // ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…ØªØ­ÙƒÙ… Ø§Ù„Ø°ÙŠ ÙŠØªÙˆÙ„Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙÙŠ Firestore\n          final controllerToUpdate =\n              Get.find<\n                GetStreamBuildBoxOfItemController\n              >(); // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØ­ÙƒÙ… Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ù„Ù„ØªØ£ÙƒØ¯\n          // Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ù…ØªØ­ÙƒÙ… Ø§Ù„Ù†ØµÙŠ Ø§Ù„Ù…Ø¤Ù‚Øª Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª (Ù„ÙŠØ³ Ø¶Ø±ÙˆØ±ÙŠÙ‹Ø§ Ù‡Ù†Ø§)\n          if (isEditingName) {\n            controllerToUpdate.nameEditController.text =\n                editController.text; // ØªØ­Ø¯ÙŠØ« Ù…ØªØ­ÙƒÙ… Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ\n            controllerToUpdate.isEditingName.value =\n                true; // ØªØ­Ø¯ÙŠØ¯ Ø£Ù†Ù†Ø§ Ù†Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³Ù…\n            controllerToUpdate.isEditingPrice.value = false;\n          } else {\n            controllerToUpdate.priceEditController.text =\n                editController.text; // ØªØ­Ø¯ÙŠØ« Ù…ØªØ­ÙƒÙ… Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ\n            controllerToUpdate.isEditingPrice.value =\n                true; // ØªØ­Ø¯ÙŠØ¯ Ø£Ù†Ù†Ø§ Ù†Ø¹Ø¯Ù„ Ø§Ù„Ø³Ø¹Ø±\n            controllerToUpdate.isEditingName.value = false;\n          }\n          Get.back(); // Ø£ØºÙ„Ù‚ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø­ÙˆØ§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ\n          await controllerToUpdate.confirmEdit(\n            item.id,\n          ); // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ ÙÙŠ Ø§Ù„Ù…ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ\n        },\n        child: const Text(\"Ø­ÙØ¸\"), // <<-- ØªØ¹Ø±ÙŠØ¨\n      ),\n      cancel: TextButton(\n        onPressed: () {\n          // Ù…Ø³Ø­ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø°Ø§ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)\n          controller.cancelEditing();\n          Get.back();\n        },\n        child: const Text(\"Ø¥Ù„ØºØ§Ø¡\"), // <<-- ØªØ¹Ø±ÙŠØ¨\n      ),\n      radius: 15.0,\n    );\n  }\n\n  Widget _buildItemImage(ItemModel item, double wi, double hi) {\n    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Hero Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„Ø³Ù„Ø³ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªÙØ§ØµÙŠÙ„\n    return Hero(\n      // Tag ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ±ÙŠØ¯Ù‹Ø§ Ù„ÙƒÙ„ Ø¹Ù†ØµØ± ÙˆÙŠØ±ØªØ¨Ø· Ø¨Ù†ÙØ³ Ø§Ù„Ù€ Tag ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„\n      tag: 'item_image_${item.id}',\n      child: CachedNetworkImage(\n        imageUrl: item.imageUrl ?? '', // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· ÙØ§Ø±Øº Ø¢Ù…Ù†\n        placeholder: (context, url) => Container(color: Colors.grey[200]),\n        errorWidget:\n            (context, url, error) => Container(\n              color: Colors.grey[100],\n              child: const Icon(Icons.broken_image_outlined),\n            ),\n        fit: BoxFit.cover, // ØªØºØ·ÙŠØ© Ø§Ù„Ù…Ø³Ø§Ø­Ø©\n      ),\n    );\n  }\n\n  // Ø¯Ø§Ù„Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø³Ø¹Ø± Ù…Ø¹ ÙØ§ØµÙ„Ø© Ù„Ù„Ø¢Ù„Ø§Ù ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£ØµÙØ§Ø± ØºÙŠØ± Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ©\n  String formatPrice(double price) {\n    String priceString;\n    if (price == price.toInt()) {\n      priceString = price.toInt().toString();\n    } else {\n      priceString = price.toStringAsFixed(2).replaceAll(RegExp(r'\\.?0+$'), '');\n    }\n\n    // Ø¥Ø¶Ø§ÙØ© ÙØ§ØµÙ„Ø© Ù„Ù„Ø¢Ù„Ø§Ù\n    final parts = priceString.split('.');\n    String integerPart = parts[0];\n    String decimalPart = parts.length > 1 ? '.${parts[1]}' : '';\n\n    // Ø¥Ø¶Ø§ÙØ© ÙØ§ØµÙ„Ø© ÙƒÙ„ Ø«Ù„Ø§Ø« Ø®Ø§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ†\n    String formattedInteger = '';\n    for (int i = integerPart.length - 1; i >= 0; i--) {\n      formattedInteger = integerPart[i] + formattedInteger;\n      if ((integerPart.length - i) % 3 == 0 && i != 0) {\n        formattedInteger = ',' + formattedInteger;\n      }\n    }\n\n    return formattedInteger + decimalPart;\n  }\n}\n"
        }
    ]
}