{
    "sourceFile": "lib/الكود الخاص بتطبيق العميل /HomePage/widgets/barcode_search_widget.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1752919676713,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752922212101,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,16 +27,19 @@\n         children: [\n           // عنوان القسم\n           _buildSectionTitle(),\n           SizedBox(height: 16.h),\n-          \n+\n           // التبديل بين زر المسح والكاميرا\n-          Obx(() => controller.isScanning.value \n-              ? _buildCameraScanner()\n-              : _buildScanBarcodeButton()),\n-          \n+          Obx(\n+            () =>\n+                controller.isScanning.value\n+                    ? _buildCameraScanner()\n+                    : _buildScanBarcodeButton(),\n+          ),\n+\n           SizedBox(height: 20.h),\n-          \n+\n           // عرض نتائج البحث أو رسائل الخطأ\n           Obx(() => _buildResultsSection()),\n         ],\n       ),\n@@ -74,9 +77,10 @@\n \n   /// زر مسح الباركود بالكاميرا\n   Widget _buildScanBarcodeButton() {\n     return SizedBox(\n-      width: double.infinity * 1.625, // زيادة العرض بنسبة 62.5% (25% + 30% إضافية)\n+      width:\n+          double.infinity * 1.625, // زيادة العرض بنسبة 62.5% (25% + 30% إضافية)\n       child: Material(\n         elevation: 6.r,\n         borderRadius: BorderRadius.circular(16.r),\n         child: InkWell(\n@@ -101,13 +105,9 @@\n             ),\n             child: Row(\n               mainAxisAlignment: MainAxisAlignment.center,\n               children: [\n-                Icon(\n-                  Icons.qr_code_scanner,\n-                  color: Colors.white,\n-                  size: 32.sp,\n-                ),\n+                Icon(Icons.qr_code_scanner, color: Colors.white, size: 32.sp),\n                 SizedBox(width: 12.w),\n                 Text(\n                   'مسح الباركود',\n                   style: TextStyle(\n@@ -126,9 +126,10 @@\n \n   /// كاميرا المسح في نفس المكان\n   Widget _buildCameraScanner() {\n     return Container(\n-      width: double.infinity * 1.625, // زيادة العرض بنسبة 62.5% (25% + 30% إضافية)\n+      width:\n+          double.infinity * 1.625, // زيادة العرض بنسبة 62.5% (25% + 30% إضافية)\n       height: 120.h, // تقليل الارتفاع بنسبة 40% من 200 إلى 120\n       decoration: BoxDecoration(\n         borderRadius: BorderRadius.circular(16.r),\n         border: Border.all(color: theme.primaryColor, width: 2.w),\n@@ -145,49 +146,46 @@\n           // منطقة الكاميرا\n           Positioned.fill(\n             child: ClipRRect(\n               borderRadius: BorderRadius.circular(14.r),\n-              child: controller.hasPermission.value\n-                  ? MobileScanner(\n-                      controller: controller.scannerController,\n-                      onDetect: controller.onBarcodeDetected,\n-                    )\n-                  : Container(\n-                      color: Colors.grey.shade200,\n-                      child: Center(\n-                        child: Column(\n-                          mainAxisAlignment: MainAxisAlignment.center,\n-                          children: [\n-                            Icon(\n-                              Icons.camera_alt_outlined,\n-                              size: 48.sp,\n-                              color: Colors.grey,\n-                            ),\n-                            SizedBox(height: 8.h),\n-                            Text(\n-                              'لا يمكن الوصول للكاميرا',\n-                              style: TextStyle(\n-                                color: Colors.grey.shade600,\n-                                fontSize: 14.sp,\n+              child:\n+                  controller.hasPermission.value\n+                      ? MobileScanner(\n+                        controller: controller.scannerController,\n+                        onDetect: controller.onBarcodeDetected,\n+                      )\n+                      : Container(\n+                        color: Colors.grey.shade200,\n+                        child: Center(\n+                          child: Column(\n+                            mainAxisAlignment: MainAxisAlignment.center,\n+                            children: [\n+                              Icon(\n+                                Icons.camera_alt_outlined,\n+                                size: 48.sp,\n+                                color: Colors.grey,\n                               ),\n-                            ),\n-                          ],\n+                              SizedBox(height: 8.h),\n+                              Text(\n+                                'لا يمكن الوصول للكاميرا',\n+                                style: TextStyle(\n+                                  color: Colors.grey.shade600,\n+                                  fontSize: 14.sp,\n+                                ),\n+                              ),\n+                            ],\n+                          ),\n                         ),\n                       ),\n-                    ),\n             ),\n           ),\n \n           // زر الإغلاق فقط\n           Positioned(\n             top: 8.h,\n             left: 8.w,\n             child: _buildControlButton(\n-              icon: Icon(\n-                Icons.close,\n-                color: Colors.white,\n-                size: 20.sp,\n-              ),\n+              icon: Icon(Icons.close, color: Colors.white, size: 20.sp),\n               onTap: controller.stopCameraScanning,\n               backgroundColor: Colors.red,\n             ),\n           ),\n@@ -198,12 +196,9 @@\n               child: Container(\n                 width: 200.w,\n                 height: 100.h,\n                 decoration: BoxDecoration(\n-                  border: Border.all(\n-                    color: Colors.white,\n-                    width: 2.w,\n-                  ),\n+                  border: Border.all(color: Colors.white, width: 2.w),\n                   borderRadius: BorderRadius.circular(8.r),\n                 ),\n                 child: Stack(\n                   children: [\n@@ -211,8 +206,23 @@\n                     _buildScannerCorner(Alignment.topLeft),\n                     _buildScannerCorner(Alignment.topRight),\n                     _buildScannerCorner(Alignment.bottomLeft),\n                     _buildScannerCorner(Alignment.bottomRight),\n+                    \n+                    // زر إغلاق إضافي فوق مربع الحافة\n+                    Positioned(\n+                      top: -35.h,\n+                      right: 0,\n+                      child: _buildControlButton(\n+                        icon: Icon(\n+                          Icons.close_rounded,\n+                          color: Colors.white,\n+                          size: 18.sp,\n+                        ),\n+                        onTap: controller.stopCameraScanning,\n+                        backgroundColor: Colors.red.withValues(alpha: 0.8),\n+                      ),\n+                    ),\n                   ],\n                 ),\n               ),\n             ),\n@@ -281,12 +291,24 @@\n         width: 20.w,\n         height: 20.h,\n         decoration: BoxDecoration(\n           border: Border(\n-            top: alignment.y < 0 ? BorderSide(color: theme.primaryColor, width: 3.w) : BorderSide.none,\n-            bottom: alignment.y > 0 ? BorderSide(color: theme.primaryColor, width: 3.w) : BorderSide.none,\n-            left: alignment.x < 0 ? BorderSide(color: theme.primaryColor, width: 3.w) : BorderSide.none,\n-            right: alignment.x > 0 ? BorderSide(color: theme.primaryColor, width: 3.w) : BorderSide.none,\n+            top:\n+                alignment.y < 0\n+                    ? BorderSide(color: theme.primaryColor, width: 3.w)\n+                    : BorderSide.none,\n+            bottom:\n+                alignment.y > 0\n+                    ? BorderSide(color: theme.primaryColor, width: 3.w)\n+                    : BorderSide.none,\n+            left:\n+                alignment.x < 0\n+                    ? BorderSide(color: theme.primaryColor, width: 3.w)\n+                    : BorderSide.none,\n+            right:\n+                alignment.x > 0\n+                    ? BorderSide(color: theme.primaryColor, width: 3.w)\n+                    : BorderSide.none,\n           ),\n         ),\n       ),\n     );\n@@ -297,19 +319,19 @@\n     // عرض رسالة المنتج غير موجود\n     if (controller.showProductNotFound.value) {\n       return _buildProductNotFoundMessage();\n     }\n-    \n+\n     // عرض نتائج البحث\n     if (controller.searchResults.isNotEmpty) {\n       return _buildSearchResults();\n     }\n-    \n+\n     // عرض معلومات المنتج الموجود\n     if (controller.foundProduct.value != null) {\n       return _buildProductDetails();\n     }\n-    \n+\n     return const SizedBox.shrink();\n   }\n \n   /// رسالة عدم وجود المنتج\n@@ -323,13 +345,9 @@\n         border: Border.all(color: Colors.orange.shade200),\n       ),\n       child: Column(\n         children: [\n-          Icon(\n-            Icons.search_off,\n-            color: Colors.orange.shade600,\n-            size: 48.sp,\n-          ),\n+          Icon(Icons.search_off, color: Colors.orange.shade600, size: 48.sp),\n           SizedBox(height: 8.h),\n           Text(\n             'المنتج غير متوفر',\n             style: TextStyle(\n@@ -340,12 +358,9 @@\n           ),\n           SizedBox(height: 4.h),\n           Text(\n             'لم يتم العثور على منتج بالباركود الممسوح',\n-            style: TextStyle(\n-              fontSize: 12.sp,\n-              color: Colors.orange.shade600,\n-            ),\n+            style: TextStyle(fontSize: 12.sp, color: Colors.orange.shade600),\n             textAlign: TextAlign.center,\n           ),\n           SizedBox(height: 12.h),\n           Row(\n@@ -360,12 +375,9 @@\n                     shape: RoundedRectangleBorder(\n                       borderRadius: BorderRadius.circular(8.r),\n                     ),\n                   ),\n-                  child: Text(\n-                    'إغلاق',\n-                    style: TextStyle(fontSize: 12.sp),\n-                  ),\n+                  child: Text('إغلاق', style: TextStyle(fontSize: 12.sp)),\n                 ),\n               ),\n               SizedBox(width: 8.w),\n               Expanded(\n@@ -394,9 +406,9 @@\n \n   /// تفاصيل المنتج الموجود\n   Widget _buildProductDetails() {\n     final product = controller.foundProduct.value!;\n-    \n+\n     return Container(\n       width: double.infinity,\n       padding: EdgeInsets.all(16.r),\n       decoration: BoxDecoration(\n@@ -463,10 +475,8 @@\n       ),\n     );\n   }\n \n-\n-\n   /// عرض نتائج البحث\n   Widget _buildSearchResults() {\n     return Column(\n       crossAxisAlignment: CrossAxisAlignment.start,\n@@ -489,30 +499,34 @@\n               decoration: BoxDecoration(\n                 color: theme.primaryColor.withOpacity(0.1),\n                 borderRadius: BorderRadius.circular(12),\n               ),\n-              child: Obx(() => Text(\n-                '${controller.searchResults.length} منتج',\n-                style: TextStyle(\n-                  color: theme.primaryColor,\n-                  fontSize: 12,\n-                  fontWeight: FontWeight.bold,\n+              child: Obx(\n+                () => Text(\n+                  '${controller.searchResults.length} منتج',\n+                  style: TextStyle(\n+                    color: theme.primaryColor,\n+                    fontSize: 12,\n+                    fontWeight: FontWeight.bold,\n+                  ),\n                 ),\n-              )),\n+              ),\n             ),\n           ],\n         ),\n         const SizedBox(height: 12),\n         Container(\n           constraints: const BoxConstraints(maxHeight: 300),\n-          child: Obx(() => ListView.builder(\n-            shrinkWrap: true,\n-            itemCount: controller.searchResults.length,\n-            itemBuilder: (context, index) {\n-              final product = controller.searchResults[index];\n-              return _buildProductCard(product);\n-            },\n-          )),\n+          child: Obx(\n+            () => ListView.builder(\n+              shrinkWrap: true,\n+              itemCount: controller.searchResults.length,\n+              itemBuilder: (context, index) {\n+                final product = controller.searchResults[index];\n+                return _buildProductCard(product);\n+              },\n+            ),\n+          ),\n         ),\n       ],\n     );\n   }\n@@ -521,11 +535,9 @@\n   Widget _buildProductCard(product) {\n     return Card(\n       margin: const EdgeInsets.only(bottom: 12),\n       elevation: 3,\n-      shape: RoundedRectangleBorder(\n-        borderRadius: BorderRadius.circular(12),\n-      ),\n+      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),\n       child: InkWell(\n         onTap: () {\n           HapticFeedback.lightImpact();\n           // يمكن إضافة منطق للانتقال لصفحة تفاصيل المنتج\n@@ -550,24 +562,33 @@\n                       offset: const Offset(0, 2),\n                     ),\n                   ],\n                 ),\n-                child: product.imageUrl != null && product.imageUrl!.isNotEmpty\n-                    ? ClipRRect(\n-                        borderRadius: BorderRadius.circular(10),\n-                        child: CachedNetworkImage(\n-                          imageUrl: product.imageUrl!,\n-                          fit: BoxFit.cover,\n-                          placeholder: (context, url) => \n-                              Center(child: CircularProgressIndicator(strokeWidth: 2)),\n-                          errorWidget: (context, url, error) => \n-                              Icon(Icons.inventory_2, color: Colors.grey, size: 30),\n-                        ),\n-                      )\n-                    : Icon(Icons.inventory_2, color: Colors.grey, size: 30),\n+                child:\n+                    product.imageUrl != null && product.imageUrl!.isNotEmpty\n+                        ? ClipRRect(\n+                          borderRadius: BorderRadius.circular(10),\n+                          child: CachedNetworkImage(\n+                            imageUrl: product.imageUrl!,\n+                            fit: BoxFit.cover,\n+                            placeholder:\n+                                (context, url) => Center(\n+                                  child: CircularProgressIndicator(\n+                                    strokeWidth: 2,\n+                                  ),\n+                                ),\n+                            errorWidget:\n+                                (context, url, error) => Icon(\n+                                  Icons.inventory_2,\n+                                  color: Colors.grey,\n+                                  size: 30,\n+                                ),\n+                          ),\n+                        )\n+                        : Icon(Icons.inventory_2, color: Colors.grey, size: 30),\n               ),\n               const SizedBox(width: 12),\n-              \n+\n               // معلومات المنتج\n               Expanded(\n                 child: Column(\n                   crossAxisAlignment: CrossAxisAlignment.start,\n@@ -582,29 +603,37 @@\n                       maxLines: 1,\n                       overflow: TextOverflow.ellipsis,\n                     ),\n                     const SizedBox(height: 4),\n-                                          Row(\n-                        children: [\n-                          Icon(Icons.qr_code, size: 14, color: Colors.grey.shade600),\n-                          const SizedBox(width: 4),\n-                          Flexible(\n-                            child: Text(\n-                              'الباركود: ${product.productBarcode ?? 'غير متوفر'}',\n-                              style: TextStyle(\n-                                color: Colors.grey.shade600,\n-                                fontSize: 12,\n-                              ),\n-                              overflow: TextOverflow.ellipsis,\n+                    Row(\n+                      children: [\n+                        Icon(\n+                          Icons.qr_code,\n+                          size: 14,\n+                          color: Colors.grey.shade600,\n+                        ),\n+                        const SizedBox(width: 4),\n+                        Flexible(\n+                          child: Text(\n+                            'الباركود: ${product.productBarcode ?? 'غير متوفر'}',\n+                            style: TextStyle(\n+                              color: Colors.grey.shade600,\n+                              fontSize: 12,\n                             ),\n+                            overflow: TextOverflow.ellipsis,\n                           ),\n-                        ],\n-                      ),\n+                        ),\n+                      ],\n+                    ),\n                     const SizedBox(height: 4),\n                     if (product.price != null) ...[\n                       Row(\n                         children: [\n-                          Icon(Icons.attach_money, size: 14, color: Colors.green),\n+                          Icon(\n+                            Icons.attach_money,\n+                            size: 14,\n+                            color: Colors.green,\n+                          ),\n                           Text(\n                             '${product.price} ر.س',\n                             style: TextStyle(\n                               color: Colors.green,\n@@ -617,9 +646,9 @@\n                     ],\n                   ],\n                 ),\n               ),\n-              \n+\n               // سهم للتفاصيل\n               Icon(\n                 Icons.arrow_forward_ios,\n                 color: theme.primaryColor,\n@@ -630,5 +659,5 @@\n         ),\n       ),\n     );\n   }\n-} \n\\ No newline at end of file\n+}\n"
                }
            ],
            "date": 1752919676713,
            "name": "Commit-0",
            "content": "import 'package:flutter/material.dart';\nimport 'package:flutter/services.dart';\nimport 'package:flutter_screenutil/flutter_screenutil.dart';\nimport 'package:get/get.dart';\nimport 'package:cached_network_image/cached_network_image.dart';\nimport 'package:mobile_scanner/mobile_scanner.dart';\n\nimport '../controllers/barcode_filter_controller.dart';\nimport 'product_details_dialog.dart';\n\nclass BarcodeSearchWidget extends StatelessWidget {\n  final BarcodeFilterController controller;\n  final ThemeData theme;\n\n  const BarcodeSearchWidget({\n    super.key,\n    required this.controller,\n    required this.theme,\n  });\n\n  @override\n  Widget build(BuildContext context) {\n    return Container(\n      padding: EdgeInsets.all(16.r),\n      child: Column(\n        crossAxisAlignment: CrossAxisAlignment.start,\n        children: [\n          // عنوان القسم\n          _buildSectionTitle(),\n          SizedBox(height: 16.h),\n          \n          // التبديل بين زر المسح والكاميرا\n          Obx(() => controller.isScanning.value \n              ? _buildCameraScanner()\n              : _buildScanBarcodeButton()),\n          \n          SizedBox(height: 20.h),\n          \n          // عرض نتائج البحث أو رسائل الخطأ\n          Obx(() => _buildResultsSection()),\n        ],\n      ),\n    );\n  }\n\n  /// عنوان القسم\n  Widget _buildSectionTitle() {\n    return Row(\n      children: [\n        Container(\n          padding: const EdgeInsets.all(8),\n          decoration: BoxDecoration(\n            color: theme.primaryColor.withOpacity(0.1),\n            borderRadius: BorderRadius.circular(8),\n          ),\n          child: Icon(\n            Icons.qr_code_scanner,\n            color: theme.primaryColor,\n            size: 20,\n          ),\n        ),\n        const SizedBox(width: 12),\n        Text(\n          'البحث بالباركود',\n          style: TextStyle(\n            fontSize: 18,\n            fontWeight: FontWeight.bold,\n            color: theme.primaryColor,\n          ),\n        ),\n      ],\n    );\n  }\n\n  /// زر مسح الباركود بالكاميرا\n  Widget _buildScanBarcodeButton() {\n    return SizedBox(\n      width: double.infinity * 1.625, // زيادة العرض بنسبة 62.5% (25% + 30% إضافية)\n      child: Material(\n        elevation: 6.r,\n        borderRadius: BorderRadius.circular(16.r),\n        child: InkWell(\n          onTap: () {\n            HapticFeedback.mediumImpact();\n            controller.startCameraScanning();\n          },\n          borderRadius: BorderRadius.circular(16.r),\n          child: Container(\n            height: 90.h, // تقليل الارتفاع بنسبة 25% من 120 إلى 90\n            padding: EdgeInsets.all(16.r),\n            decoration: BoxDecoration(\n              borderRadius: BorderRadius.circular(16.r),\n              gradient: LinearGradient(\n                colors: [\n                  theme.primaryColor,\n                  theme.primaryColor.withValues(alpha: 0.8),\n                ],\n                begin: Alignment.topLeft,\n                end: Alignment.bottomRight,\n              ),\n            ),\n            child: Row(\n              mainAxisAlignment: MainAxisAlignment.center,\n              children: [\n                Icon(\n                  Icons.qr_code_scanner,\n                  color: Colors.white,\n                  size: 32.sp,\n                ),\n                SizedBox(width: 12.w),\n                Text(\n                  'مسح الباركود',\n                  style: TextStyle(\n                    color: Colors.white,\n                    fontSize: 18.sp,\n                    fontWeight: FontWeight.bold,\n                  ),\n                ),\n              ],\n            ),\n          ),\n        ),\n      ),\n    );\n  }\n\n  /// كاميرا المسح في نفس المكان\n  Widget _buildCameraScanner() {\n    return Container(\n      width: double.infinity * 1.625, // زيادة العرض بنسبة 62.5% (25% + 30% إضافية)\n      height: 120.h, // تقليل الارتفاع بنسبة 40% من 200 إلى 120\n      decoration: BoxDecoration(\n        borderRadius: BorderRadius.circular(16.r),\n        border: Border.all(color: theme.primaryColor, width: 2.w),\n        boxShadow: [\n          BoxShadow(\n            color: theme.primaryColor.withValues(alpha: 0.3),\n            blurRadius: 10.r,\n            offset: Offset(0, 5.h),\n          ),\n        ],\n      ),\n      child: Stack(\n        children: [\n          // منطقة الكاميرا\n          Positioned.fill(\n            child: ClipRRect(\n              borderRadius: BorderRadius.circular(14.r),\n              child: controller.hasPermission.value\n                  ? MobileScanner(\n                      controller: controller.scannerController,\n                      onDetect: controller.onBarcodeDetected,\n                    )\n                  : Container(\n                      color: Colors.grey.shade200,\n                      child: Center(\n                        child: Column(\n                          mainAxisAlignment: MainAxisAlignment.center,\n                          children: [\n                            Icon(\n                              Icons.camera_alt_outlined,\n                              size: 48.sp,\n                              color: Colors.grey,\n                            ),\n                            SizedBox(height: 8.h),\n                            Text(\n                              'لا يمكن الوصول للكاميرا',\n                              style: TextStyle(\n                                color: Colors.grey.shade600,\n                                fontSize: 14.sp,\n                              ),\n                            ),\n                          ],\n                        ),\n                      ),\n                    ),\n            ),\n          ),\n\n          // زر الإغلاق فقط\n          Positioned(\n            top: 8.h,\n            left: 8.w,\n            child: _buildControlButton(\n              icon: Icon(\n                Icons.close,\n                color: Colors.white,\n                size: 20.sp,\n              ),\n              onTap: controller.stopCameraScanning,\n              backgroundColor: Colors.red,\n            ),\n          ),\n\n          // إطار المسح المتحرك\n          Positioned.fill(\n            child: Center(\n              child: Container(\n                width: 200.w,\n                height: 100.h,\n                decoration: BoxDecoration(\n                  border: Border.all(\n                    color: Colors.white,\n                    width: 2.w,\n                  ),\n                  borderRadius: BorderRadius.circular(8.r),\n                ),\n                child: Stack(\n                  children: [\n                    // زوايا الإطار\n                    _buildScannerCorner(Alignment.topLeft),\n                    _buildScannerCorner(Alignment.topRight),\n                    _buildScannerCorner(Alignment.bottomLeft),\n                    _buildScannerCorner(Alignment.bottomRight),\n                  ],\n                ),\n              ),\n            ),\n          ),\n\n          // تعليمات المسح\n          Positioned(\n            bottom: 8.h,\n            left: 0,\n            right: 0,\n            child: Container(\n              padding: EdgeInsets.symmetric(horizontal: 16.w, vertical: 8.h),\n              child: Text(\n                'ضع الباركود داخل الإطار للمسح',\n                style: TextStyle(\n                  color: Colors.white,\n                  fontSize: 12.sp,\n                  fontWeight: FontWeight.bold,\n                  shadows: [\n                    Shadow(\n                      color: Colors.black.withValues(alpha: 0.7),\n                      blurRadius: 4.r,\n                    ),\n                  ],\n                ),\n                textAlign: TextAlign.center,\n              ),\n            ),\n          ),\n        ],\n      ),\n    );\n  }\n\n  /// زر تحكم مخصص\n  Widget _buildControlButton({\n    required Widget icon,\n    required VoidCallback onTap,\n    Color? backgroundColor,\n  }) {\n    return GestureDetector(\n      onTap: () {\n        HapticFeedback.lightImpact();\n        onTap();\n      },\n      child: Container(\n        padding: EdgeInsets.all(8.r),\n        decoration: BoxDecoration(\n          color: backgroundColor ?? Colors.black.withValues(alpha: 0.6),\n          borderRadius: BorderRadius.circular(8.r),\n          border: Border.all(\n            color: Colors.white.withValues(alpha: 0.3),\n            width: 1.w,\n          ),\n        ),\n        child: icon,\n      ),\n    );\n  }\n\n  /// زاوية إطار المسح\n  Widget _buildScannerCorner(Alignment alignment) {\n    return Align(\n      alignment: alignment,\n      child: Container(\n        width: 20.w,\n        height: 20.h,\n        decoration: BoxDecoration(\n          border: Border(\n            top: alignment.y < 0 ? BorderSide(color: theme.primaryColor, width: 3.w) : BorderSide.none,\n            bottom: alignment.y > 0 ? BorderSide(color: theme.primaryColor, width: 3.w) : BorderSide.none,\n            left: alignment.x < 0 ? BorderSide(color: theme.primaryColor, width: 3.w) : BorderSide.none,\n            right: alignment.x > 0 ? BorderSide(color: theme.primaryColor, width: 3.w) : BorderSide.none,\n          ),\n        ),\n      ),\n    );\n  }\n\n  /// قسم النتائج والرسائل\n  Widget _buildResultsSection() {\n    // عرض رسالة المنتج غير موجود\n    if (controller.showProductNotFound.value) {\n      return _buildProductNotFoundMessage();\n    }\n    \n    // عرض نتائج البحث\n    if (controller.searchResults.isNotEmpty) {\n      return _buildSearchResults();\n    }\n    \n    // عرض معلومات المنتج الموجود\n    if (controller.foundProduct.value != null) {\n      return _buildProductDetails();\n    }\n    \n    return const SizedBox.shrink();\n  }\n\n  /// رسالة عدم وجود المنتج\n  Widget _buildProductNotFoundMessage() {\n    return Container(\n      width: double.infinity,\n      padding: EdgeInsets.all(16.r),\n      decoration: BoxDecoration(\n        color: Colors.orange.shade50,\n        borderRadius: BorderRadius.circular(12.r),\n        border: Border.all(color: Colors.orange.shade200),\n      ),\n      child: Column(\n        children: [\n          Icon(\n            Icons.search_off,\n            color: Colors.orange.shade600,\n            size: 48.sp,\n          ),\n          SizedBox(height: 8.h),\n          Text(\n            'المنتج غير متوفر',\n            style: TextStyle(\n              fontSize: 16.sp,\n              fontWeight: FontWeight.bold,\n              color: Colors.orange.shade800,\n            ),\n          ),\n          SizedBox(height: 4.h),\n          Text(\n            'لم يتم العثور على منتج بالباركود الممسوح',\n            style: TextStyle(\n              fontSize: 12.sp,\n              color: Colors.orange.shade600,\n            ),\n            textAlign: TextAlign.center,\n          ),\n          SizedBox(height: 12.h),\n          Row(\n            children: [\n              Expanded(\n                child: ElevatedButton(\n                  onPressed: controller.clearNotFoundMessage,\n                  style: ElevatedButton.styleFrom(\n                    backgroundColor: Colors.orange.shade100,\n                    foregroundColor: Colors.orange.shade800,\n                    elevation: 0,\n                    shape: RoundedRectangleBorder(\n                      borderRadius: BorderRadius.circular(8.r),\n                    ),\n                  ),\n                  child: Text(\n                    'إغلاق',\n                    style: TextStyle(fontSize: 12.sp),\n                  ),\n                ),\n              ),\n              SizedBox(width: 8.w),\n              Expanded(\n                child: ElevatedButton(\n                  onPressed: controller.startCameraScanning,\n                  style: ElevatedButton.styleFrom(\n                    backgroundColor: Colors.orange,\n                    foregroundColor: Colors.white,\n                    elevation: 0,\n                    shape: RoundedRectangleBorder(\n                      borderRadius: BorderRadius.circular(8.r),\n                    ),\n                  ),\n                  child: Text(\n                    'مسح مرة أخرى',\n                    style: TextStyle(fontSize: 12.sp),\n                  ),\n                ),\n              ),\n            ],\n          ),\n        ],\n      ),\n    );\n  }\n\n  /// تفاصيل المنتج الموجود\n  Widget _buildProductDetails() {\n    final product = controller.foundProduct.value!;\n    \n    return Container(\n      width: double.infinity,\n      padding: EdgeInsets.all(16.r),\n      decoration: BoxDecoration(\n        color: Colors.green.shade50,\n        borderRadius: BorderRadius.circular(12.r),\n        border: Border.all(color: Colors.green.shade200),\n      ),\n      child: Column(\n        crossAxisAlignment: CrossAxisAlignment.start,\n        children: [\n          Row(\n            children: [\n              Icon(\n                Icons.check_circle,\n                color: Colors.green.shade600,\n                size: 24.sp,\n              ),\n              SizedBox(width: 8.w),\n              Text(\n                'تم العثور على المنتج!',\n                style: TextStyle(\n                  fontSize: 16.sp,\n                  fontWeight: FontWeight.bold,\n                  color: Colors.green.shade800,\n                ),\n              ),\n            ],\n          ),\n          SizedBox(height: 12.h),\n          _buildProductCard(product),\n          SizedBox(height: 12.h),\n          SizedBox(\n            width: double.infinity,\n            child: ElevatedButton(\n              onPressed: () {\n                HapticFeedback.mediumImpact();\n                ProductDetailsDialog.show(product);\n              },\n              style: ElevatedButton.styleFrom(\n                backgroundColor: Colors.green,\n                foregroundColor: Colors.white,\n                padding: EdgeInsets.symmetric(vertical: 12.h),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(10.r),\n                ),\n              ),\n              child: Row(\n                mainAxisAlignment: MainAxisAlignment.center,\n                children: [\n                  Icon(Icons.visibility, size: 18.sp),\n                  SizedBox(width: 8.w),\n                  Text(\n                    'عرض التفاصيل الكاملة',\n                    style: TextStyle(\n                      fontSize: 14.sp,\n                      fontWeight: FontWeight.bold,\n                    ),\n                  ),\n                ],\n              ),\n            ),\n          ),\n        ],\n      ),\n    );\n  }\n\n\n\n  /// عرض نتائج البحث\n  Widget _buildSearchResults() {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.start,\n      children: [\n        Row(\n          children: [\n            Icon(Icons.search, color: theme.primaryColor, size: 20),\n            const SizedBox(width: 8),\n            Text(\n              'نتائج البحث:',\n              style: TextStyle(\n                fontSize: 16,\n                fontWeight: FontWeight.bold,\n                color: theme.primaryColor,\n              ),\n            ),\n            const Spacer(),\n            Container(\n              padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 4),\n              decoration: BoxDecoration(\n                color: theme.primaryColor.withOpacity(0.1),\n                borderRadius: BorderRadius.circular(12),\n              ),\n              child: Obx(() => Text(\n                '${controller.searchResults.length} منتج',\n                style: TextStyle(\n                  color: theme.primaryColor,\n                  fontSize: 12,\n                  fontWeight: FontWeight.bold,\n                ),\n              )),\n            ),\n          ],\n        ),\n        const SizedBox(height: 12),\n        Container(\n          constraints: const BoxConstraints(maxHeight: 300),\n          child: Obx(() => ListView.builder(\n            shrinkWrap: true,\n            itemCount: controller.searchResults.length,\n            itemBuilder: (context, index) {\n              final product = controller.searchResults[index];\n              return _buildProductCard(product);\n            },\n          )),\n        ),\n      ],\n    );\n  }\n\n  /// بطاقة المنتج\n  Widget _buildProductCard(product) {\n    return Card(\n      margin: const EdgeInsets.only(bottom: 12),\n      elevation: 3,\n      shape: RoundedRectangleBorder(\n        borderRadius: BorderRadius.circular(12),\n      ),\n      child: InkWell(\n        onTap: () {\n          HapticFeedback.lightImpact();\n          // يمكن إضافة منطق للانتقال لصفحة تفاصيل المنتج\n          debugPrint('تم اختيار المنتج: ${product.name}');\n        },\n        borderRadius: BorderRadius.circular(12),\n        child: Padding(\n          padding: const EdgeInsets.all(12),\n          child: Row(\n            children: [\n              // صورة المنتج\n              Container(\n                width: 60,\n                height: 60,\n                decoration: BoxDecoration(\n                  borderRadius: BorderRadius.circular(10),\n                  color: Colors.grey.shade100,\n                  boxShadow: [\n                    BoxShadow(\n                      color: Colors.black.withOpacity(0.1),\n                      blurRadius: 4,\n                      offset: const Offset(0, 2),\n                    ),\n                  ],\n                ),\n                child: product.imageUrl != null && product.imageUrl!.isNotEmpty\n                    ? ClipRRect(\n                        borderRadius: BorderRadius.circular(10),\n                        child: CachedNetworkImage(\n                          imageUrl: product.imageUrl!,\n                          fit: BoxFit.cover,\n                          placeholder: (context, url) => \n                              Center(child: CircularProgressIndicator(strokeWidth: 2)),\n                          errorWidget: (context, url, error) => \n                              Icon(Icons.inventory_2, color: Colors.grey, size: 30),\n                        ),\n                      )\n                    : Icon(Icons.inventory_2, color: Colors.grey, size: 30),\n              ),\n              const SizedBox(width: 12),\n              \n              // معلومات المنتج\n              Expanded(\n                child: Column(\n                  crossAxisAlignment: CrossAxisAlignment.start,\n                  children: [\n                    Text(\n                      product.name ?? 'غير محدد',\n                      style: TextStyle(\n                        fontWeight: FontWeight.bold,\n                        color: theme.primaryColor,\n                        fontSize: 16,\n                      ),\n                      maxLines: 1,\n                      overflow: TextOverflow.ellipsis,\n                    ),\n                    const SizedBox(height: 4),\n                                          Row(\n                        children: [\n                          Icon(Icons.qr_code, size: 14, color: Colors.grey.shade600),\n                          const SizedBox(width: 4),\n                          Flexible(\n                            child: Text(\n                              'الباركود: ${product.productBarcode ?? 'غير متوفر'}',\n                              style: TextStyle(\n                                color: Colors.grey.shade600,\n                                fontSize: 12,\n                              ),\n                              overflow: TextOverflow.ellipsis,\n                            ),\n                          ),\n                        ],\n                      ),\n                    const SizedBox(height: 4),\n                    if (product.price != null) ...[\n                      Row(\n                        children: [\n                          Icon(Icons.attach_money, size: 14, color: Colors.green),\n                          Text(\n                            '${product.price} ر.س',\n                            style: TextStyle(\n                              color: Colors.green,\n                              fontSize: 12,\n                              fontWeight: FontWeight.bold,\n                            ),\n                          ),\n                        ],\n                      ),\n                    ],\n                  ],\n                ),\n              ),\n              \n              // سهم للتفاصيل\n              Icon(\n                Icons.arrow_forward_ios,\n                color: theme.primaryColor,\n                size: 16,\n              ),\n            ],\n          ),\n        ),\n      ),\n    );\n  }\n} "
        }
    ]
}