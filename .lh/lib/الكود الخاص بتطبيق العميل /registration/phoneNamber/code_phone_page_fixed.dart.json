{
    "sourceFile": "lib/الكود الخاص بتطبيق العميل /registration/phoneNamber/code_phone_page_fixed.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1752768338516,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1752768338516,
            "name": "Commit-0",
            "content": "import 'package:flutter/material.dart';\nimport 'package:flutter/services.dart';\nimport 'package:get/get.dart';\n\nimport 'controllers/code_phone_controller.dart';\nimport 'widgets/code_input_field.dart';\n\n/// صفحة إدخال رمز التحقق المحسنة والمبسطة\nclass CodePhonePage extends StatelessWidget {\n  final String phoneNumber;\n  final Uint8List userImage;\n  final String name;\n  final String email;\n  final String password;\n  final bool hasPassword;\n\n  const CodePhonePage({\n    super.key,\n    required this.phoneNumber,\n    required this.userImage,\n    required this.name,\n    required this.email,\n    required this.password,\n    required this.hasPassword,\n  });\n\n  @override\n  Widget build(BuildContext context) {\n    final controller = Get.put(\n      CodePhoneController(\n        phoneNumber: phoneNumber,\n        userImage: userImage,\n        name: name,\n        email: email,\n        password: password,\n        hasPassword: hasPassword,\n      ),\n    );\n\n    return Scaffold(\n      backgroundColor: Colors.transparent,\n      extendBodyBehindAppBar: true,\n      appBar: AppBar(\n        backgroundColor: Colors.transparent,\n        elevation: 0,\n        leading: Container(\n          margin: const EdgeInsets.all(8),\n          decoration: BoxDecoration(\n            color: Colors.white.withOpacity(0.9),\n            borderRadius: BorderRadius.circular(12),\n            boxShadow: [\n              BoxShadow(\n                color: Colors.black.withOpacity(0.1),\n                blurRadius: 10,\n                offset: const Offset(0, 2),\n              ),\n            ],\n          ),\n          child: IconButton(\n            icon: const Icon(Icons.arrow_back_ios, color: Colors.black87),\n            onPressed: () => Get.back(),\n          ),\n        ),\n        title: Container(\n          padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),\n          decoration: BoxDecoration(\n            color: Colors.white.withOpacity(0.9),\n            borderRadius: BorderRadius.circular(20),\n            boxShadow: [\n              BoxShadow(\n                color: Colors.black.withOpacity(0.1),\n                blurRadius: 10,\n                offset: const Offset(0, 2),\n              ),\n            ],\n          ),\n          child: const Text(\n            'تأكيد رقم الهاتف',\n            style: TextStyle(\n              color: Colors.black87,\n              fontWeight: FontWeight.bold,\n              fontSize: 18,\n            ),\n          ),\n        ),\n        centerTitle: true,\n      ),\n      body: Container(\n        decoration: const BoxDecoration(\n          image: DecorationImage(\n            image: AssetImage('assets/logo.png'),\n            fit: BoxFit.cover,\n            opacity: 0.1,\n          ),\n          gradient: LinearGradient(\n            begin: Alignment.topLeft,\n            end: Alignment.bottomRight,\n            colors: [Color(0xFFF8FBFF), Color(0xFFE3F2FD), Color(0xFFF1F8FF)],\n          ),\n        ),\n        child: SafeArea(\n          child: Padding(\n            padding: const EdgeInsets.all(20.0),\n            child: Column(\n              children: [\n                const SizedBox(height: 20),\n                // Header Section\n                Expanded(\n                  flex: 2,\n                  child: _buildHeader(),\n                ),\n                // Code Input Section\n                Expanded(\n                  flex: 2,\n                  child: _buildCodeInputSection(controller),\n                ),\n                // Resend Section\n                Expanded(\n                  flex: 1,\n                  child: _buildResendSection(controller),\n                ),\n                // Status Section\n                _buildStatusSection(controller),\n                const SizedBox(height: 20),\n              ],\n            ),\n          ),\n        ),\n      ),\n    );\n  }\n\n  /// قسم العنوان المحسن\n  Widget _buildHeader() {\n    return Container(\n      padding: const EdgeInsets.all(20),\n      decoration: BoxDecoration(\n        color: Colors.white.withOpacity(0.95),\n        borderRadius: BorderRadius.circular(20),\n        boxShadow: [\n          BoxShadow(\n            color: Colors.blue.withOpacity(0.1),\n            blurRadius: 15,\n            offset: const Offset(0, 5),\n          ),\n        ],\n      ),\n      child: Column(\n        mainAxisAlignment: MainAxisAlignment.center,\n        children: [\n          Container(\n            width: 70,\n            height: 70,\n            decoration: BoxDecoration(\n              gradient: LinearGradient(\n                colors: [Colors.blue.shade400, Colors.blue.shade600],\n              ),\n              shape: BoxShape.circle,\n              boxShadow: [\n                BoxShadow(\n                  color: Colors.blue.withOpacity(0.3),\n                  blurRadius: 10,\n                  offset: const Offset(0, 3),\n                ),\n              ],\n            ),\n            child: const Icon(\n              Icons.verified_user,\n              size: 35,\n              color: Colors.white,\n            ),\n          ),\n          const SizedBox(height: 16),\n          const Text(\n            'أدخل رمز التأكيد',\n            style: TextStyle(\n              fontSize: 24,\n              fontWeight: FontWeight.bold,\n              color: Colors.black87,\n            ),\n          ),\n          const SizedBox(height: 8),\n          Text(\n            'تم إرسال رمز مكون من 6 أرقام إلى',\n            style: TextStyle(fontSize: 14, color: Colors.grey.shade600),\n          ),\n          const SizedBox(height: 8),\n          Container(\n            padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),\n            decoration: BoxDecoration(\n              color: Colors.blue.shade50,\n              borderRadius: BorderRadius.circular(20),\n              border: Border.all(color: Colors.blue.shade200),\n            ),\n            child: Row(\n              mainAxisSize: MainAxisSize.min,\n              children: [\n                Icon(\n                  Icons.phone_android,\n                  color: Colors.blue.shade700,\n                  size: 16,\n                ),\n                const SizedBox(width: 6),\n                Directionality(\n                  textDirection: TextDirection.ltr,\n                  child: Text(\n                    phoneNumber,\n                    style: TextStyle(\n                      fontSize: 16,\n                      fontWeight: FontWeight.bold,\n                      color: Colors.blue.shade700,\n                    ),\n                  ),\n                ),\n              ],\n            ),\n          ),\n        ],\n      ),\n    );\n  }\n\n  /// قسم إدخال الرمز\n  Widget _buildCodeInputSection(CodePhoneController controller) {\n    return Container(\n      padding: const EdgeInsets.all(20),\n      decoration: BoxDecoration(\n        color: Colors.white.withOpacity(0.95),\n        borderRadius: BorderRadius.circular(16),\n        boxShadow: [\n          BoxShadow(\n            color: Colors.black.withOpacity(0.05),\n            blurRadius: 10,\n            offset: const Offset(0, 3),\n          ),\n        ],\n      ),\n      child: Column(\n        mainAxisAlignment: MainAxisAlignment.center,\n        children: [\n          Text(\n            'أدخل الرمز المرسل',\n            style: TextStyle(\n              fontSize: 16,\n              fontWeight: FontWeight.w600,\n              color: Colors.grey.shade700,\n            ),\n          ),\n          const SizedBox(height: 20),\n          Obx(() => Row(\n            mainAxisAlignment: MainAxisAlignment.spaceEvenly,\n            children: List.generate(\n              6,\n              (index) => CodeInputField(\n                controller: controller.codeControllers[index],\n                focusNode: controller.focusNodes[index],\n                isValid: controller.isCodeValid.value,\n                onComplete: () => controller.checkCodeOnComplete(),\n              ),\n            ),\n          )),\n          Obx(() => !controller.isCodeValid.value \n            ? Padding(\n                padding: const EdgeInsets.only(top: 12),\n                child: _buildErrorMessage('الرمز غير صحيح، يرجى المحاولة مرة أخرى'),\n              )\n            : const SizedBox.shrink(),\n          ),\n        ],\n      ),\n    );\n  }\n\n  /// رسالة خطأ محسنة\n  Widget _buildErrorMessage(String message) {\n    return Container(\n      padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 8),\n      decoration: BoxDecoration(\n        color: Colors.red.shade50,\n        borderRadius: BorderRadius.circular(8),\n        border: Border.all(color: Colors.red.shade200),\n      ),\n      child: Row(\n        children: [\n          Icon(\n            Icons.error_outline,\n            color: Colors.red.shade600,\n            size: 16,\n          ),\n          const SizedBox(width: 8),\n          Expanded(\n            child: Text(\n              message,\n              style: TextStyle(\n                color: Colors.red.shade700,\n                fontSize: 12,\n                fontWeight: FontWeight.w500,\n              ),\n            ),\n          ),\n        ],\n      ),\n    );\n  }\n\n  /// قسم إعادة الإرسال\n  Widget _buildResendSection(CodePhoneController controller) {\n    return Container(\n      padding: const EdgeInsets.all(16),\n      decoration: BoxDecoration(\n        color: Colors.white.withOpacity(0.95),\n        borderRadius: BorderRadius.circular(12),\n        boxShadow: [\n          BoxShadow(\n            color: Colors.black.withOpacity(0.05),\n            blurRadius: 8,\n            offset: const Offset(0, 2),\n          ),\n        ],\n      ),\n      child: Column(\n        mainAxisAlignment: MainAxisAlignment.center,\n        children: [\n          Text(\n            'لم تتلق الرمز؟',\n            style: TextStyle(\n              fontSize: 14,\n              color: Colors.grey.shade600,\n              fontWeight: FontWeight.w500,\n            ),\n          ),\n          const SizedBox(height: 12),\n          Obx(() => controller.canResend.value\n            ? _buildResendButton(controller)\n            : _buildResendTimer(controller),\n          ),\n        ],\n      ),\n    );\n  }\n\n  /// زر إعادة الإرسال\n  Widget _buildResendButton(CodePhoneController controller) {\n    return ElevatedButton.icon(\n      onPressed: () => controller.resendCode(),\n      icon: const Icon(Icons.refresh, size: 18, color: Colors.white),\n      label: const Text(\n        'إعادة إرسال الرمز',\n        style: TextStyle(\n          fontSize: 14,\n          fontWeight: FontWeight.bold,\n          color: Colors.white,\n        ),\n      ),\n      style: ElevatedButton.styleFrom(\n        backgroundColor: Colors.blue.shade600,\n        padding: const EdgeInsets.symmetric(horizontal: 20, vertical: 10),\n        shape: RoundedRectangleBorder(\n          borderRadius: BorderRadius.circular(20),\n        ),\n      ),\n    );\n  }\n\n  /// مؤقت إعادة الإرسال\n  Widget _buildResendTimer(CodePhoneController controller) {\n    return Container(\n      padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 10),\n      decoration: BoxDecoration(\n        color: Colors.orange.shade100,\n        borderRadius: BorderRadius.circular(16),\n        border: Border.all(color: Colors.orange.shade200),\n      ),\n      child: Row(\n        mainAxisSize: MainAxisSize.min,\n        children: [\n          Icon(Icons.timer, color: Colors.orange.shade600, size: 16),\n          const SizedBox(width: 8),\n          Obx(() => Text(\n            'إعادة الإرسال خلال ${controller.resendCounter.value} ثانية',\n            style: TextStyle(\n              color: Colors.orange.shade800,\n              fontSize: 12,\n              fontWeight: FontWeight.w600,\n            ),\n          )),\n        ],\n      ),\n    );\n  }\n\n  /// قسم حالة العملية\n  Widget _buildStatusSection(CodePhoneController controller) {\n    return Obx(() {\n      if (!controller.isLoading.value &&\n          controller.statusMessage.value.isEmpty) {\n        return const SizedBox.shrink();\n      }\n\n      return Container(\n        padding: const EdgeInsets.all(16),\n        decoration: BoxDecoration(\n          color: Colors.white.withOpacity(0.95),\n          borderRadius: BorderRadius.circular(12),\n          boxShadow: [\n            BoxShadow(\n              color: Colors.blue.withOpacity(0.1),\n              blurRadius: 8,\n              offset: const Offset(0, 2),\n            ),\n          ],\n        ),\n        child: Column(\n          children: [\n            if (controller.isLoading.value) ...[\n              Container(\n                width: 40,\n                height: 40,\n                decoration: BoxDecoration(\n                  gradient: LinearGradient(\n                    colors: [Colors.blue.shade400, Colors.blue.shade600],\n                  ),\n                  shape: BoxShape.circle,\n                ),\n                child: const Center(\n                  child: CircularProgressIndicator(\n                    valueColor: AlwaysStoppedAnimation<Color>(Colors.white),\n                    strokeWidth: 2,\n                  ),\n                ),\n              ),\n              const SizedBox(height: 12),\n              if (controller.statusMessage.value.isNotEmpty)\n                Text(\n                  controller.statusMessage.value,\n                  style: TextStyle(\n                    color: Colors.blue.shade700,\n                    fontSize: 14,\n                    fontWeight: FontWeight.w600,\n                  ),\n                  textAlign: TextAlign.center,\n                ),\n            ],\n          ],\n        ),\n      );\n    });\n  }\n}\n"
        }
    ]
}