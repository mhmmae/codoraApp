
import 'package:firebase_messaging/firebase_messaging.dart';
import 'package:flutter/material.dart';
import 'package:get/get.dart';

import '../../bottonBar/botonBar.dart';
import '../../controler/local-notification-onroller.dart';

class GetSearchController extends GetxController{
  late PageController pageController;
  int corintPage = 0;

  @override
  void onInit() {
    // TODO: implement onInit
    pageController = PageController(
      initialPage: corintPage,
    );


    if(!localNotification.streamController2.hasListener){
      localNotification.streamController2.stream.listen((notificatin) {
        if (notificatin.id == 6) {
          Get.to(bottonBar(theIndex: 2,));
        }
        // ====================================================================================================================================================================
        // ====================================================================================================================================================================
        // ====================================================================================================================================================================


        if (notificatin.id == 2) {
          Get.to(bottonBar(theIndex: 0,));
        }
        // ====================================================================================================================================================================
        // ====================================================================================================================================================================
        // ====================================================================================================================================================================



        if (notificatin.id == 3) {
          Get.to(bottonBar(theIndex: 0,));
        }
        // ====================================================================================================================================================================
        // ====================================================================================================================================================================
        // ====================================================================================================================================================================


        if (notificatin.id == 4) {
          Get.to(bottonBar(theIndex: 3,));
        }
        // ====================================================================================================================================================================
        // ====================================================================================================================================================================
        // ====================================================================================================================================================================


        if (notificatin.id == 5) {
          Get.to(bottonBar(theIndex: 0,));
        }
        // ====================================================================================================================================================================
        // ====================================================================================================================================================================
        // ====================================================================================================================================================================

        else {
          print('eeeeeee');
        }
      });
      print('1111111qqqqqqqaaaaaaaaaaaaa');

    }




    // streamNotification();
    FirebaseMessaging.onMessageOpenedApp.listen((RemoteMessage message)async{

      if (message.data['type'] == 'message') {
        await localNotification.showNotoficationMsseage(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid'],);
      }
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================


      if (message.data['type'] == 'audio') {
        await localNotification.showNotoficationMsseage(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid']);
      }
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================

      // if (message.data['type'] == 'order') {
      //   await localNotification.showNotofication(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid'], message.data['image']);
      // }
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================

      if (message.data['type'] == 'AcceptTheRequest') {
        await localNotification.showNotoficationAcceptTheRequest(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid']);
      }
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================

      if (message.data['type'] == 'RequestRejected') {
        await localNotification.showNotoficationRequestRejected(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid'], );
      }
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================

      if (message.data['type'] == 'ScanerBarCode') {
        await localNotification.showNotoficationScanerBarCode(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid']);
      }

      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================

      if (message.data['type'] == 'Done') {
        await localNotification.showNotoficationDone(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid'], );
      }

      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================

      if (message.data['type'] == 'image') {
        await localNotification.showNotoficationMsseage(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid'],);
      }
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================

      if (message.data['type'] == 'video') {
        await localNotification.showNotoficationMsseage(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid']);
      }
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================


    });


    FirebaseMessaging.onMessage.listen((RemoteMessage message)async{


      // localNotification.showNotoficationMsseage( message.notification!.title.toString(), message.notification!.body.toString(), 'xnaCHi4xfRe6zLCcdrFMZP6VgQ22',
      //     'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQqGK3diR3Zi-mnOXEaj-3ewmFyRYVxGzVzZw&s');

      // await localNotification.showNotofication('body', 'body', 'payload', 'https://letsenhance.io/static/8f5e523ee6b2479e26ecc91b9c25261e/1015f/MainAfter.jpg');


      if (message.data['type'] == 'message') {
       await localNotification.showNotoficationMsseage(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid'], );
      }
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================


      if (message.data['type'] == 'audio') {
       await localNotification.showNotoficationMsseage(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid'], );
      }
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================

      // if (message.data['type'] == 'order') {
      //  await localNotification.showNotofication(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid'], message.data['image']);
      // }
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================

      if (message.data['type'] == 'AcceptTheRequest') {
        await localNotification.showNotoficationAcceptTheRequest(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid'],);
      }
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================

      if (message.data['type'] == 'RequestRejected') {
        await localNotification.showNotoficationRequestRejected(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid'], );
      }
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================

      if (message.data['type'] == 'ScanerBarCode') {
        await localNotification.showNotoficationScanerBarCode(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid'], );
      }

      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================

      if (message.data['type'] == 'Done') {
        await localNotification.showNotoficationDone(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid'], );
      }

      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================

      if (message.data['type'] == 'image') {
        await localNotification.showNotoficationMsseage(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid'],);
      }
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================

      if (message.data['type'] == 'video') {
        await localNotification.showNotoficationMsseage(message.notification!.title.toString(), message.notification!.body.toString(), message.data['uid'], );
      }
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================
      // ====================================================================================================================================================================

    });



    super.onInit();
  }


  @override
  void dispose() {
    // TODO: implement dispose
    pageController.dispose();


    // localNotification.streamController2.close();
    // localNotification.streamController2.onCancel;
    // localNotification.streamController2.done;

    super.dispose();
  }

  @override
  void onClose() {



    // TODO: implement onClose
    super.onClose();
  }
  // Future<void> streamNotification() async{
  //  await localNotification.streamController2.stream.listen((notificatin) async{
  //     if (notificatin.id == 1) {
  //       print(notificatin.payload.toString());
  //       print(notificatin.id.toString());
  //       print(notificatin.input.toString());
  //       print(notificatin.actionId.toString());
  //
  //
  //
  //      await Get.to(Orderofuser(uid:notificatin.payload.toString(),));
  //
  //     } else {
  //       print('eeeeeee');
  //     }
  //   });
  // }

}